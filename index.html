<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HalloGenius!!! ‚Äì Abenteuer Lernen!</title>
  <!-- Font Awesome f√ºr Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    /* ===== PALETA ===== */
    :root {
      --blue:     #0052CC;
      --amber:    #F2A738;
      --coral:    #D45A56;
      --sky:      #87CEFA;
      --grass:    #7FC97F;
      --white:    #FFFFFF;
      --text:     #222222;
      --shadow:   rgba(0,0,0,0.2);
      --anim-time: 4s;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(180deg, var(--sky) 0%, #FFF5CC 80%);
      color: var(--text);
      overflow-x: hidden;
    }
    /* ===== HEADER ===== */
    header {
      position: sticky; top: 0;
      display: flex; align-items: center; justify-content: space-between;
      background: linear-gradient(135deg, var(--blue), var(--coral));
      color: var(--white);
      padding: 1rem 2rem;
      box-shadow: 0 4px 12px var(--shadow);
      z-index: 100;
      overflow: hidden;
    }
    header::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.15), transparent 60%);
      animation: glow 6s infinite alternate;
    }
    @keyframes glow {
      from { opacity: 0.3; }
      to   { opacity: 0.6; }
    }
    header .logo {
      display: flex; align-items: center; gap: .5rem;
      z-index: 1;
      animation: logoBounce 2s infinite;
    }
    @keyframes logoBounce {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
    header .logo img { height: 40px; }
    header .logo span {
      font-size: 1.6rem; font-weight: 700;
      text-shadow: 1px 1px 4px var(--shadow);
    }
    nav {
      display: flex; align-items: center; gap: 1.2rem;
      z-index: 1;
    }
    nav a {
      position: relative;
      text-decoration: none;
      color: var(--white);
      font-weight: 600;
      padding: .5rem;
      transition: color .3s;
      cursor: pointer;
    }
    nav a::after {
      content: '';
      position: absolute; left: 0; bottom: -4px;
      width: 0; height: 3px;
      background: var(--amber);
      transition: width .3s;
    }
    nav a:hover {
      color: var(--amber);
    }
    nav a:hover::after {
      width: 100%;
    }
    /* ===== HEADER SHAPES ===== */
    .shape-circle {
      position: absolute;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      animation: floatSlow 10s infinite;
    }
    .shape-circle.one { width: 80px; height: 80px; top: -20px; right: 100px; }
    .shape-circle.two { width: 50px; height: 50px; bottom: 10px; left: 150px; animation-delay: 2s; }
    @keyframes floatSlow {
      0% { transform: translateY(0); }
      50% { transform: translateY(10px); }
      100% { transform: translateY(0); }
    }
    /* ===== HERO ===== */
    .hero {
      position: relative;
      height: 60vh;
      display: flex; align-items: center; justify-content: center;
      text-align: center;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute; inset: 0;
      background: url('fondo.png') center/cover no-repeat;
      filter: brightness(0.8);
    }
    .cloud {
      position: absolute;
      background: url('https://svgshare.com/i/XnN.svg') no-repeat center/contain;
      width: 200px; height: 80px;
      opacity: .7;
      animation: float  var(--anim-time) ease-in-out infinite;
    }
    .cloud:nth-child(1) { top: 20%; left: -10%; animation-delay: 0s; }
    .cloud:nth-child(2) { top: 40%; left: -15%; animation-delay: 1.5s; width: 150px; height: 60px; }
    .cloud:nth-child(3) { top: 10%; left: 100%; animation-delay: 3s; }
    @keyframes float {
      0%   { transform: translateX(0) translateY(0); }
      50%  { transform: translateX(120vw) translateY(10px); }
      100% { transform: translateX(0) translateY(0); }
    }
    .hero-content {
      position: relative; z-index: 10;
      color: var(--white);
      max-width: 800px; padding: 0 1rem;
      animation: fadeInUp 1s ease-out both;
    }
    .hero-content h1 {
      font-size: 3rem; margin-bottom: .5rem;
      text-shadow: 2px 2px 10px var(--shadow);
    }
    .hero-content p {
      font-size: 1.2rem; opacity: .9;
      animation: fadeInUp 1s ease-out .3s both;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    /* ===== MODULE CARDS ===== */
    main { padding: 4rem 1rem; max-width: 1200px; margin: 0 auto 4rem; }
    .modules { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap: 2.5rem; }
    .card {
      position: relative; background: var(--white);
      border-radius: 20px; padding: 2rem 1rem 3rem;
      box-shadow: 0 8px 24px var(--shadow); overflow: hidden;
      transition: transform .3s, box-shadow .3s; cursor:pointer;
    }
    .card:hover { transform: translateY(-8px) scale(1.02); box-shadow:0 12px 32px var(--shadow);}    
    .card::before,.card::after { content:''; position:absolute; border-radius:50%; opacity:.15; }
    .card::before { width:200px;height:200px;top:-50px;right:-50px;background:var(--blue);transform:rotate(45deg);}    
    .card::after  { width:150px;height:150px;bottom:-40px;left:-60px;background:var(--grass);}    
    .card.vocab { background: var(--blue); color: var(--white);}    
    .card.grammar{ background: var(--amber); color: var(--text);}    
    .card.test   { background: var(--coral); color: var(--white);}    
    .card.sim    { background: var(--blue); color: var(--white);}
    .card.lesen { background: var(--grass); color: var(--white);}
    .card.redemittel { background: var(--coral); color: var(--white);}
    .card.quiz { background: var(--amber); color: var(--text);}
    .card .icon  { font-size:3.5rem;margin-bottom:1rem;transition:transform .3s;}    
    .card:hover .icon { transform:rotate(20deg) scale(1.1);}    
    .card h3     { font-size:1.6rem;margin-bottom:.6rem;text-shadow:1px 1px 4px var(--shadow);}    
    .card p      { font-size:1rem;margin-bottom:1.5rem;line-height:1.5; }    
    .card .btn   { display:inline-flex;align-items:center;gap:.5rem;background:var(--grass);color:var(--text);padding:.6rem 1.2rem;border:none;border-radius:12px;font-weight:700;box-shadow:0 4px 12px var(--shadow);transition:transform .3s,background .3s;}    
    .card .btn:hover { transform:translateY(-2px);background:var(--coral);color:var(--white);}    
    .card .btn .fa-arrow-right { transition:transform .3s; }    
    .card .btn:hover .fa-arrow-right { transform:translateX(4px);}    

    /* ===== HIDDEN SECTIONS ===== */
    .contenido-oculto { display: none; padding: 2rem; max-width: 900px; margin: 0 auto; }
    .contenido-oculto h2 { margin-bottom: 1rem; color: var(--blue); }
    .back-btn {
      margin-top: 2rem;
      display: inline-block;
      padding: .6rem 1.2rem;
      background: var(--coral);
      color: var(--white);
      border-radius: 10px;
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
    }
    .back-btn:hover { background: var(--blue); }

    /* ===== FLASHCARDS ===== */
    .flashcard-container {
      display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center;
    }
    .flashcard {
      background: var(--white); border: 2px solid var(--blue);
      border-radius: 10px; width: 120px; height: 120px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; position: relative; 
      transition: transform .3s;
    }
    .flashcard:hover { transform: scale(1.05); }
    .flashcard .word {
      position: absolute; bottom: 10px;
      font-size: 0.9rem; font-weight: bold;
      color: var(--text);
      display: none;
    }
    .flashcard.show .word { display: block; }
    .flashcard i {
      font-size: 2.5rem; color: var(--blue);
    }
    /* ===== DRAG & DROP ===== */
    .dnd-container { display: flex; flex-direction: column; align-items: center; gap: 1rem; }
    .dnd-zone, .dnd-source {
      display: flex; gap: 0.5rem; padding: 1rem;
    }
    .dnd-zone { min-height: 40px; border: 2px dashed var(--blue); padding: 1rem; width: 100%; }
    .dnd-zone.empty { opacity: 0.3; }
    .dnd-source .dnd-item, .dnd-zone .dnd-item {
      background: var(--white); border: 2px solid var(--coral);
      padding: 0.5rem 1rem; border-radius: 8px;
      cursor: grab;
    }

    /* ===== QUIZ ===== */
    .quiz-question { margin-bottom: 1rem; }
    .quiz-question p { margin-bottom: 0.5rem; }
    .quiz-options { list-style: none; padding: 0; }
    .quiz-options li { margin: 0.5rem 0; }
    .quiz-options li label { cursor: pointer; }
    .btn-submit {
      margin-top: 1rem; padding: 0.5rem 1rem;
      background: var(--blue); color: var(--white);
      border: none; border-radius: 8px; font-weight: 600; cursor: pointer;
    }
    .btn-submit:hover { background: var(--coral); }
    /* ===== EXAM ===== */
    .exam-section { margin-bottom: 2rem; }
    .exam-section h3 { font-size: 1.2rem; margin-bottom: 0.5rem; }
    .result { font-size: 1.2rem; font-weight: bold; margin-top: 1rem; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <div class="shape-circle one"></div>
    <div class="shape-circle two"></div>
    <div class="logo">
      <img src="header.png" alt="üá©üá™" />
      <span>HalloGenios</span>
    </div>
    <nav>
      <a onclick="mostrarSeccion('home')">Startseite</a>
      <a onclick="mostrarSeccion('vokabeln')">Vokabeln</a>
      <a onclick="mostrarSeccion('grammatik')">Grammatik</a>
      <a onclick="mostrarSeccion('lesen')">Leseverstehen</a>
      <a onclick="mostrarSeccion('redemittel')">Redemittel</a>
      <a onclick="mostrarSeccion('quiz')">Quiz-Modus</a>
      <a onclick="mostrarSeccion('simulation')">Simulationspr√ºfung</a>
    </nav>
  </header>

<!-- HOME (MEJORADO PRO) -->
<section id="home">
  <style>
    /* ====== Estilos espec√≠ficos de HOME + mejoras del header para m√≥viles ====== */
    /* Header responsive y sin solapes */
    header{ position: sticky; top: 0; }
    header.shrink{ padding:.6rem 1.2rem!important; transition: padding .25s ease; }
    header .menu-toggle{ display:none; cursor:pointer; }
    header .menu-toggle span{ border-radius:2px; }
    header nav{ display:flex; gap:1.2rem; align-items:center; }

    /* Drawer m√≥vil + backdrop para evitar solapes y permitir scroll lock */
    @media (max-width: 900px){
      header .menu-toggle{ display:block; z-index:1001; }
      header nav{
        position: fixed; top:0; right:0; height:100vh; width:min(78vw, 320px);
        flex-direction:column; background:linear-gradient(135deg,var(--blue),var(--coral));
        padding: 80px 1rem 1rem; transform: translateX(100%); transition: transform .3s ease;
        box-shadow: -8px 0 24px var(--shadow); z-index:1002;
      }
      header nav.open{ transform: translateX(0); }
      header nav a{ padding:.8rem 0; font-size:1.05rem; width:100%; text-align:left; }
      .nav-backdrop{
        position: fixed; inset:0; background: rgba(0,0,0,.35); backdrop-filter: blur(2px);
        opacity:0; pointer-events:none; transition: opacity .25s ease; z-index:1000;
      }
      .nav-backdrop.show{ opacity:1; pointer-events:auto; }
      body.noscroll{ overflow:hidden; }
    }

    /* ====== HERO mejorado (sin solapes en m√≥vil) ====== */
    #home .hero{
      position:relative; min-height: clamp(58vh, 70vh, 82vh);
      display:grid; place-items:center; padding: 2.4rem 1rem 3.2rem; isolation:isolate;
    }
    #home .hero::before{
      content:''; position:absolute; inset:0;
      background: url('fondo.png') center/cover no-repeat; filter: brightness(.9);
      z-index:-3;
    }
    #home .hero::after{
      content:''; position:absolute; inset:0;
      background: linear-gradient(180deg, rgba(0,0,0,.2) 0%, rgba(0,0,0,.05) 40%, rgba(0,0,0,.2) 100%);
      z-index:-2;
    }
    /* Nubes al fondo en m√≥vil para evitar solapes */
    .cloud{ z-index:-1; opacity:.5; pointer-events:none; }
    @media (max-width:600px){
      .cloud{ transform: scale(.8); opacity:.35; }
    }

    .hero-wrap{
      width:min(1100px,96%); display:grid; grid-template-columns: 1.1fr .9fr; gap: clamp(1rem, 2.2vw, 2rem);
      align-items:center;
    }
    @media (max-width: 900px){
      .hero-wrap{ grid-template-columns:1fr; text-align:center; gap: 1.2rem; }
    }
    .hero-copy h1{
      color:#fff; text-shadow:0 3px 14px rgba(0,0,0,.35);
      font-size: clamp(2rem, 4.2vw, 3.2rem); line-height:1.1; margin-bottom:.65rem;
    }
    .hero-copy p{
      color:#fff; opacity:.97; font-size: clamp(1rem, 1.6vw, 1.2rem);
      background: rgba(0,0,0,.28); display:inline-block; padding:.7rem .9rem; border-radius:14px;
      max-width: 48ch;
    }
    @media (max-width: 900px){ .hero-copy p{ max-width: 100%; } }
    .cta-row{ display:flex; gap:.7rem; flex-wrap:wrap; margin-top:1.1rem; }
    .btn-cta{
      display:inline-flex; align-items:center; gap:.5rem; border:none; cursor:pointer;
      background: var(--amber); color:#000; font-weight:800; padding:.8rem 1.1rem; border-radius: 12px;
      box-shadow:0 8px 24px var(--shadow);
    }
    .btn-ghost-white{
      display:inline-flex; align-items:center; gap:.5rem; border:2px solid #fff; color:#fff; background:transparent;
      font-weight:800; padding:.7rem 1.05rem; border-radius:12px; backdrop-filter: blur(2px);
    }
    .hero-media{
      display:grid; gap:.8rem; grid-template-columns: repeat(2,1fr); align-content:start;
    }
    @media (max-width:600px){ .hero-media{ grid-template-columns: 1fr; } }
    .h-card{
      background: rgba(255,255,255,.95); border-radius:16px; padding: .95rem; box-shadow:0 8px 24px var(--shadow);
      display:flex; flex-direction:column; gap:.35rem; min-height: 120px;
    }
    .h-card i{ font-size:1.7rem; color:var(--coral); }
    .h-card .kpi{ font-size:1.45rem; font-weight:900; color:var(--blue); }
    .h-img{
      grid-column: span 2; border-radius:16px; overflow:hidden; box-shadow:0 8px 24px var(--shadow);
    }
    .h-img img{ width:100%; height: 230px; object-fit:cover; display:block; }
    @media (max-width:900px){ .h-img{ grid-column:auto; } .h-img img{ height: 190px; } }

    /* ====== M√≥dulos destacados (tarjetas grandes) ====== */
    .modules-wrap{ margin:2.2rem auto 0; width:min(1200px,96%); position:relative; z-index:2; }
    .modules-grid{ display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); }
    .mcard{
      position:relative; border-radius:18px; padding: 1.1rem 1rem 1.2rem; overflow:hidden;
      background:#fff; box-shadow:0 10px 28px var(--shadow); border:2px solid rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease; cursor:pointer;
      display:flex; flex-direction:column; justify-content:space-between;
      min-height: 184px;
    }
    .mcard:hover{ transform: translateY(-4px); box-shadow:0 16px 32px var(--shadow); }
    .mcard .top{ display:flex; align-items:center; gap:.7rem; margin-bottom:.35rem; }
    .mcard .top i{ font-size:1.6rem; }
    .mcard h3{ margin:0; }
    .mcard p{ margin:.3rem 0 .7rem; min-height:48px; }
    .pillset{ display:flex; gap:.35rem; flex-wrap:wrap; margin:.15rem 0 .6rem; }
    .pill{ background:#f2f7ff; color:#17438c; border:1px solid #cfe0ff; padding:.15rem .5rem; font-size:.8rem; border-radius:999px; }
    .mcard .go{ align-self:flex-start; display:inline-flex; align-items:center; gap:.45rem; font-weight:800; background:var(--grass); border:none; padding:.5rem .8rem; border-radius:12px; }
    .ribbon{
      position:absolute; top:10px; right:-36px; transform: rotate(20deg);
      background: var(--amber); color:#000; font-weight:900; padding:.25rem 1.1rem; box-shadow:0 6px 20px var(--shadow);
    }

    /* ====== Secci√≥n: Ruta de aprendizaje ====== */
    .section-title{ width:min(1100px,96%); margin: 1.8rem auto .8rem; display:flex; align-items:center; gap:.5rem; }
    .section-title i{ color:var(--blue); }
    .roadmap{ width:min(1100px,96%); margin: .6rem auto 0; display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); }
    .stage{
      background:#fff; border-radius:16px; border:2px solid rgba(0,0,0,.06); box-shadow:0 8px 24px var(--shadow);
      padding:1rem; display:flex; flex-direction:column; gap:.35rem;
    }
    .stage .hdr{ display:flex; align-items:center; gap:.6rem; }
    .stage .hdr i{ color:var(--blue); }
    .stage ul{ margin:.3rem 0 0 1rem; padding:0; }
    .stage li{ margin:.2rem 0; }

    /* ====== C√≥mo funciona (imagen p√∫blica corregida) ====== */
    .how{ width:min(1100px,96%); margin: 2.2rem auto 0; display:grid; gap:1rem; grid-template-columns: 1fr 1fr; }
    @media (max-width: 900px){ .how{ grid-template-columns: 1fr; } }
    .how .panel{ background:#fff; border-radius:16px; padding:1rem; box-shadow:0 8px 24px var(--shadow); border:2px solid rgba(0,0,0,.06); }
    .steps{ display:grid; gap:.7rem; }
    .step{ display:grid; grid-template-columns: 44px 1fr; gap:.6rem; align-items:start; background:#f7fbff; border:1px dashed var(--blue); padding:.6rem .7rem; border-radius:12px; }
    .step i{ font-size:1.3rem; color:var(--blue); display:grid; place-items:center; height:44px; width:44px; background:#fff; border-radius:10px; }
    .how img{ width:100%; border-radius:14px; object-fit:cover; height:260px; display:block; }

    /* ====== Beneficios / Metriken ====== */
    .benefits{ width:min(1100px,96%); margin: 2rem auto 0; display:grid; gap:1rem; grid-template-columns: repeat(auto-fit, minmax(210px,1fr)); }
    .benefit{ background:#fff; border-radius:14px; padding:.95rem; box-shadow:0 8px 24px var(--shadow); border:2px solid rgba(0,0,0,.05); }
    .benefit i{ font-size:1.6rem; color:var(--coral); }

    .metrics{ width:min(1100px,96%); margin:1rem auto 0; display:grid; gap:.8rem; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
    .metric{ background:#fff; border:2px solid rgba(0,0,0,.06); border-radius:12px; box-shadow:0 6px 18px var(--shadow); padding:.9rem; text-align:center; }
    .metric .num{ font-weight:900; font-size:1.6rem; color:var(--blue); }

    /* ====== Testimonios (scroll-snap sin solapes) ====== */
    .testimonials{ width:min(1100px,96%); margin: 1.6rem auto 0; overflow:auto; display:flex; gap:.8rem; scroll-snap-type: x mandatory; padding-bottom:.6rem; }
    .tcard{
      min-width: clamp(260px, 48%, 520px); background:#fff; border-radius:16px; border:2px solid rgba(0,0,0,.06);
      box-shadow:0 10px 26px var(--shadow); padding:1rem; scroll-snap-align:center;
      display:flex; gap:.7rem;
    }
    .tcard i{ font-size:2rem; color:var(--amber); flex:0 0 auto; }
    .tcard p{ margin:0; }

    /* ====== Para profes y familias ====== */
    .for-all{ width:min(1100px,96%); margin: 2rem auto 0; display:grid; gap:1rem; grid-template-columns: 1fr 1fr; }
    @media (max-width: 900px){ .for-all{ grid-template-columns:1fr; } }
    .callout{
      background:#fff; border-radius:16px; padding:1rem; border:2px solid rgba(0,0,0,.06); box-shadow:0 8px 24px var(--shadow);
    }
    .callout h4{ margin:.2rem 0 .5rem; display:flex; gap:.5rem; align-items:center; }
    .callout ul{ margin:.3rem 0 0 1rem; }

    /* ====== FAQ / Footer ====== */
    .faq{ width:min(900px,96%); margin: 2rem auto; }
    .faq details{ background:#fff; border-radius:12px; padding:.75rem .9rem; box-shadow: 0 6px 16px var(--shadow); border:2px solid rgba(0,0,0,.06); margin:.6rem 0; }
    .faq summary{ cursor:pointer; font-weight:800; display:flex; align-items:center; gap:.5rem; }
    .faq summary i{ color:var(--blue); }

    .site-footer{ margin-top: 2rem; background: linear-gradient(135deg, var(--blue), var(--coral)); color:#fff; padding: 1.2rem 1rem; }
    .foot-wrap{ width:min(1100px,96%); margin: 0 auto; display:grid; gap:1rem; grid-template-columns: 1.2fr .8fr .8fr; }
    .foot-col h4{ margin:0 0 .4rem; }
    .foot-col a{ color:#fff; opacity:.95; text-decoration:none; }
    .foot-social{ display:flex; gap:.6rem; margin-top:.4rem; }
    .foot-social i{ font-size:1.3rem; }
    @media (max-width: 900px){ .foot-wrap{ grid-template-columns:1fr; text-align:center; } .foot-social{ justify-content:center; } }

    /* Utilidades locales */
    .kicker{ display:inline-flex; align-items:center; gap:.4rem; background:rgba(255,255,255,.92); color:#000; padding:.35rem .6rem; border-radius: 999px; font-weight:800; }
  </style>

  <!-- HERO -->
  <div class="hero">
    <!-- nubes (se reubican detr√°s en m√≥vil) -->
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>

    <div class="hero-wrap">
      <div class="hero-copy">
        <span class="kicker"><i class="fa-solid fa-graduation-cap"></i> HalloGenios ¬∑ A2</span>
        <h1>¬°Aprende alem√°n jugando y <em>aprueba</em> tu examen A2!</h1>
        <p>Plataforma pensada para ni√±os de 12 a√±os en Colombia: vocabulario con √≠conos, gram√°tica simple, lectura y <strong>simulacro</strong> con guardado local.</p>
        <div class="cta-row">
          <button class="btn-cta" onclick="mostrarSeccion('vokabeln')"><i class="fa-solid fa-language"></i> Empezar con Vocabulario</button>
          <button class="btn-ghost-white" onclick="mostrarSeccion('simulation')"><i class="fa-solid fa-clipboard-check"></i> Simulacro directo</button>
        </div>
      </div>

      <div class="hero-media">
        <div class="h-card">
          <i class="fa-solid fa-layer-group"></i>
          <div class="kpi" id="kpi-words">200+</div>
          <small>palabras b√°sicas con √≠conos</small>
        </div>
            </div>
    </div>
  </div>

  <!-- M√ìDULOS DESTACADOS con explicaci√≥n m√°s detallada -->
  <div class="modules-wrap">
    <div class="modules-grid">
      <div class="mcard" onclick="mostrarSeccion('vokabeln')">
        <div class="ribbon">A2 Fokus</div>
        <div class="top"><i class="fa-solid fa-language"></i><h3>Vokabeln lernen</h3></div>
        <p>Tarjetas con <strong>√≠conos</strong>, art√≠culo y plural. <br>Incluye palabras clave para el simulacro.</p>
        <div class="pillset">
          <span class="pill"><i class="fa-solid fa-tag"></i> Casa</span>
          <span class="pill"><i class="fa-solid fa-tag"></i> Escuela</span>
          <span class="pill"><i class="fa-solid fa-tag"></i> Transporte</span>
        </div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>

      <div class="mcard" onclick="mostrarSeccion('grammatik')">
        <div class="top"><i class="fa-solid fa-book-open"></i><h3>Grammatik interaktiv</h3></div>
        <p>Arrastra palabras, elige art√≠culos y completa huecos. <br>Reglas b√°sicas que usan en el examen.</p>
        <div class="pillset">
          <span class="pill">Presente</span><span class="pill">Pasado</span><span class="pill">Preposiciones</span>
        </div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>

      <div class="mcard" onclick="mostrarSeccion('lesen')">
        <div class="top"><i class="fa-solid fa-book"></i><h3>Leseverstehen</h3></div>
        <p>Mensajes, avisos y notas reales. <br>Preguntas de 3 opciones y V/F.</p>
        <div class="pillset"><span class="pill">Mini-textos</span><span class="pill">Carteles</span></div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>

      <div class="mcard" onclick="mostrarSeccion('redemittel')">
        <div class="top"><i class="fa-solid fa-comment-dots"></i><h3>Redemittel</h3></div>
        <p>Frases √∫tiles para compras, transporte, salud y escuela. <br>Completa di√°logos simples.</p>
        <div class="pillset"><span class="pill">Di√°logos</span><span class="pill">Frases clave</span></div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>

      <div class="mcard" onclick="mostrarSeccion('quiz')">
        <div class="top"><i class="fa-solid fa-gamepad"></i><h3>Quiz-Modus</h3></div>
        <p>Trivia con tiempo, V/F y eliminaci√≥n progresiva. <br>¬°Aprende jugando!</p>
        <div class="pillset"><span class="pill">Reto</span><span class="pill">Puntuaci√≥n</span></div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>

      <div class="mcard" onclick="mostrarSeccion('simulation')">
        <div class="top"><i class="fa-solid fa-clipboard-list"></i><h3>Simulationspr√ºfung</h3></div>
        <p>Simulacro integral A2. <br>Guarda progreso local e historial de puntajes.</p>
        <div class="pillset"><span class="pill">Wortschatz</span><span class="pill">Grammatik</span><span class="pill">Lesen</span></div>
        <button class="go">Los geht‚Äôs <i class="fa-solid fa-arrow-right"></i></button>
      </div>
    </div>
  </div>

  <!-- NUEVO: Ruta de aprendizaje -->
  <div class="section-title"><i class="fa-solid fa-route"></i><h3>Ruta de aprendizaje</h3></div>
  <div class="roadmap">
    <div class="stage">
      <div class="hdr"><i class="fa-solid fa-lightbulb"></i><strong>1 ¬∑ Fundamentos</strong></div>
      <ul>
        <li>Vocabulario b√°sico por temas (casa, escuela, ciudad).</li>
        <li>Art√≠culos y plurales con ejemplos sencillos.</li>
      </ul>
    </div>
    <div class="stage">
      <div class="hdr"><i class="fa-solid fa-sitemap"></i><strong>2 ¬∑ Gram√°tica esencial</strong></div>
      <ul>
        <li>Presente y pasado simple.</li>
        <li>Preposiciones m√°s comunes (in, auf, an...).</li>
      </ul>
    </div>
    <div class="stage">
      <div class="hdr"><i class="fa-solid fa-book-open-reader"></i><strong>3 ¬∑ Lectura y frases</strong></div>
      <ul>
        <li>Textos cortos tipo A2 (avisos, correos).</li>
        <li>Redemittel para situaciones reales.</li>
      </ul>
    </div>
    <div class="stage">
      <div class="hdr"><i class="fa-solid fa-check-double"></i><strong>4 ¬∑ Simulacro A2</strong></div>
      <ul>
        <li>Examen integrado con puntaje.</li>
        <li>Historial y guardado local.</li>
      </ul>
    </div>
  </div>

  <!-- C√ìMO FUNCIONA -->
  <div class="section-title"><i class="fa-solid fa-wand-magic-sparkles"></i><h3>¬øC√≥mo funciona?</h3></div>
  <div class="how">
    <div class="panel">
      <div class="steps">
        <div class="step">
          <i class="fa-solid fa-1"></i>
          <div>
            <strong>Vocabulario por temas</strong>
            <p>Aprende 200 palabras con <em>√≠conos</em> y traducci√≥n. Prepara la base para el examen.</p>
          </div>
        </div>
        <div class="step">
          <i class="fa-solid fa-2"></i>
          <div>
            <strong>Practica con gram√°tica y lectura</strong>
            <p>Ejercicios cortos y objetivos, como en las pruebas reales A2.</p>
          </div>
        </div>
        <div class="step">
          <i class="fa-solid fa-3"></i>
          <div>
            <strong>Haz el simulacro final</strong>
            <p>Integra todo lo aprendido y obt√©n tu <b>puntaje</b>. Se guarda tu progreso localmente.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <!-- Imagen p√∫blica (reemplazo funcional de la anterior) -->
      <img src="https://images.unsplash.com/photo-1529078155058-5d716f45d604?auto=format&fit=crop&w=1200&q=60" alt="Actividades educativas visuales">
    </div>
  </div>

  <!-- BENEFICIOS -->
  <div class="section-title"><i class="fa-solid fa-star"></i><h3>Beneficios</h3></div>
  <div class="benefits">
    <div class="benefit"><i class="fa-solid fa-mobile-screen-button"></i> <strong>100% responsive</strong><br><small>Funciona perfecto en celular, tablet y laptop.</small></div>
    <div class="benefit"><i class="fa-solid fa-icons"></i> <strong>Visual e intuitivo</strong><br><small>√çconos claros y textos cortos.</small></div>
    <div class="benefit"><i class="fa-solid fa-bolt"></i> <strong>R√°pido</strong><br><small>Sin audios ni descargas pesadas.</small></div>
    <div class="benefit"><i class="fa-solid fa-floppy-disk"></i> <strong>Guardado local</strong><br><small>Retoma tu simulacro cuando quieras.</small></div>
  </div>

  <!-- M√©tricas en vivo (ligeras) -->
  <div class="metrics">
    <div class="metric"><div class="num" id="m-sets">6</div><small>secciones principales</small></div>
    <div class="metric"><div class="num" id="m-items">100+</div><small>√≠tems de pr√°ctica</small></div>
    <div class="metric"><div class="num" id="m-sessions">15‚Äì20 min</div><small>sesiones sugeridas</small></div>
  </div>

  <!-- Testimonios -->
  <div class="section-title"><i class="fa-solid fa-quote-left"></i><h3>Testimonios</h3></div>
  <div class="testimonials">
    <div class="tcard">
      <i class="fa-solid fa-user"></i>
      <p><strong>Camila (12):</strong> ‚ÄúMe encantaron las tarjetas con √≠conos. El simulacro fue como el examen real.‚Äù</p>
    </div>
    <div class="tcard">
      <i class="fa-solid fa-user-graduate"></i>
      <p><strong>Profe Laura:</strong> ‚ÄúEstructura clara y ejercicios objetivos para A2. Perfecto para clase y casa.‚Äù</p>
    </div>
    <div class="tcard">
      <i class="fa-solid fa-user-shield"></i>
      <p><strong>Mam√° de Juan:</strong> ‚ÄúPuede estudiar en el celular sin distraerse ni salir de la p√°gina.‚Äù</p>
    </div>
  </div>

  <!-- Para profes y familias -->
  <div class="section-title"><i class="fa-solid fa-people-group"></i><h3>Para profes y familias</h3></div>
  <div class="for-all">
    <div class="callout">
      <h4><i class="fa-solid fa-chalkboard-user"></i> Docentes</h4>
      <ul>
        <li>Secuencias listas por temas y nivel A2.</li>
        <li>Ejercicios autoevaluables con retroalimentaci√≥n inmediata.</li>
        <li>Simulacro con avance local (sin registro).</li>
      </ul>
    </div>
    <div class="callout">
      <h4><i class="fa-solid fa-children"></i> Familias</h4>
      <ul>
        <li>Explicaciones en espa√±ol y actividades cortas.</li>
        <li>Compatible con dispositivos m√≥viles de gama media.</li>
        <li>Sin enlaces externos ni publicidad.</li>
      </ul>
    </div>
  </div>

  <!-- FAQ -->
  <div class="section-title"><i class="fa-solid fa-circle-question"></i><h3>Preguntas frecuentes</h3></div>
  <div class="faq">
    <details>
      <summary><i class="fa-solid fa-shield-heart"></i> ¬øNecesito registrarme?</summary>
      <p>No. Tu progreso del simulacro se guarda <strong>solo en este dispositivo</strong> (localStorage).</p>
    </details>
    <details>
      <summary><i class="fa-solid fa-book-bookmark"></i> ¬øEl nivel es A2?</summary>
      <p>S√≠. Todo el contenido est√° orientado a <strong>A1/A2</strong> con foco en A2 para aprobar pruebas estandarizadas.</p>
    </details>
    <details>
      <summary><i class="fa-solid fa-brain"></i> ¬øHay contenido de pr√°ctica variado?</summary>
      <p>Incluye <em>vocabulario</em>, <em>gram√°tica</em>, <em>lectura</em>, <em>expresiones</em> y un <strong>simulacro</strong> por √≠tems.</p>
    </details>
  </div>

  <!-- FOOTER dentro de HOME (visible en inicio) -->
  <footer class="site-footer">
    <div class="foot-wrap">
      <div class="foot-col">
        <h4>HalloGenios</h4>
        <p>Aprender alem√°n puede ser <strong>divertido</strong> y efectivo. Dise√±ado para ni√±os de 12 a√±os en Colombia.</p>
        <div class="foot-social">
          <a href="#" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
          <a href="#" aria-label="Instagram"><i class="fa-brands fa-instagram"></i></a>
          <a href="#" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
        </div>
      </div>
      <div class="foot-col">
        <h4>Explora</h4>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('vokabeln')">Vocabulario</a></p>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('grammatik')">Gram√°tica</a></p>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('lesen')">Lectura</a></p>
      </div>
      <div class="foot-col">
        <h4>Pr√°ctica</h4>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('redemittel')">Redemittel</a></p>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('quiz')">Quiz</a></p>
        <p><a href="javascript:void(0)" onclick="mostrarSeccion('simulation')">Simulacro</a></p>
      </div>
    </div>
  </footer>

  <script>
    // ====== Header: men√∫ m√≥vil con backdrop (sin solapes) ======
    (function(){
      const toggle = document.querySelector('header .menu-toggle');
      const nav = document.querySelector('header nav');
      const header = document.querySelector('header');
      // Crear backdrop una vez
      let backdrop = document.querySelector('.nav-backdrop');
      if(!backdrop){ 
        backdrop = document.createElement('div');
        backdrop.className = 'nav-backdrop';
        document.body.appendChild(backdrop);
      }
      function openNav(){
        nav.classList.add('open');
        backdrop.classList.add('show');
        document.body.classList.add('noscroll');
        toggle?.setAttribute('aria-expanded','true');
      }
      function closeNav(){
        nav.classList.remove('open');
        backdrop.classList.remove('show');
        document.body.classList.remove('noscroll');
        toggle?.setAttribute('aria-expanded','false');
      }
      if(toggle && nav){
        toggle.setAttribute('role','button');
        toggle.setAttribute('aria-controls','mainnav');
        nav.id = 'mainnav';
        toggle.addEventListener('click', ()=> nav.classList.contains('open') ? closeNav() : openNav());
        // Cerrar al seleccionar una opci√≥n
        nav.querySelectorAll('a').forEach(a=> a.addEventListener('click', closeNav));
        // Cerrar al tocar backdrop
        backdrop.addEventListener('click', closeNav);
      }
      // Encoger header al hacer scroll
      let last = 0;
      window.addEventListener('scroll', ()=>{
        const y = window.scrollY || 0;
        if(!header) return;
        if(y > 10 && last <= 10) header.classList.add('shrink');
        if(y <= 10 && last > 10) header.classList.remove('shrink');
        last = y;
      });
    })();

    // ====== Contadores suaves en KPI ======
    (function(){
      const elWords = document.getElementById('kpi-words');
      const elEx = document.getElementById('kpi-ex');
      if(!elWords || !elEx) return;
      const animate = (el, to)=>{
        const start = 0; const dur = 900; const t0 = performance.now();
        const step = t=>{
          const p = Math.min(1, (t - t0)/dur);
          el.textContent = Math.round(start + p*to) + '+';
          if(p<1) requestAnimationFrame(step);
        };
        requestAnimationFrame(step);
      };
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            animate(elWords, 200);
            animate(elEx, 80);
            io.disconnect();
          }
        });
      }, {threshold:.6});
      io.observe(elWords);
    })();

    // ====== M√©tricas din√°micas simples (opcional) ======
    (function(){
      const mSets = document.getElementById('m-sets');
      if(!mSets) return;
      // Solo ejemplo de incremento visual (no persistente)
      let bumped = false;
      const io2 = new IntersectionObserver((es)=>{
        es.forEach(e=>{
          if(e.isIntersecting && !bumped){
            bumped = true;
            // Peque√±a animaci√≥n
            mSets.animate([{transform:'scale(1)'},{transform:'scale(1.1)'},{transform:'scale(1)'}],{duration:600});
          }
        });
      },{threshold:.7});
      io2.observe(mSets);
    })();
  </script>
</section>


<!-- VOCABULARY FLASHCARDS (EXTENDIDO) -->
<section id="vokabeln" class="contenido-oculto">
  <style>
    /* ===== Estilos locales Vocabulario ===== */
    .hint {
      background: rgba(255,255,255,.9);
      border-left: 5px solid var(--blue);
      padding: .9rem 1rem; border-radius: 10px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .v-controls {
      display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; margin:.6rem 0 1rem;
    }
    .pillbar { display:flex; gap:.5rem; overflow:auto; padding-bottom:.2rem; }
    .pillbar::-webkit-scrollbar { height:8px; }
    .pill {
      white-space:nowrap; border:2px solid var(--blue); background:#fff; color:var(--text);
      padding:.45rem .8rem; border-radius:999px; cursor:pointer; font-weight:700; display:flex; align-items:center; gap:.45rem;
    }
    .pill.active { background:var(--blue); color:#fff; }
    .badge { background:var(--amber); color:#000; border-radius:999px; padding:.05rem .45rem; font-size:.8rem; font-weight:800; }

    .v-actions { display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; margin-top:.4rem; }
    .v-search { flex:1; min-width:200px; display:flex; align-items:center; gap:.4rem; border:2px solid var(--grass); background:#fff; border-radius:10px; padding:.4rem .6rem; }
    .v-search input { border:none; outline:none; width:100%; font-size:1rem; }
    .btn-ghost { border:2px solid var(--coral); background:#fff; color:var(--text); padding:.45rem .8rem; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn-ghost:active { transform:scale(.98); }

    .grid {
      display:grid; gap:.8rem;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    }

    .vcard {
      position:relative; background:#fff; border-radius:14px; min-height:150px;
      display:flex; align-items:center; justify-content:center; text-align:center; cursor:pointer;
      box-shadow:0 6px 18px var(--shadow); border:2px solid rgba(0,0,0,.05);
      transition: transform .12s ease-in, box-shadow .12s ease-in;
      padding: .6rem;
    }
    .vcard:focus { outline: 3px solid var(--amber); }
    .vcard:active { transform:scale(.98); }
    .vface { width:100%; }
    .icon-face i { font-size:2.5rem; color:var(--coral); }
    .text-face { display:none; line-height:1.35; }
    .vcard.show .icon-face { display:none; }
    .vcard.show .text-face { display:block; }

    .de { font-weight:800; color:var(--blue); }
    .de .article { opacity:.9; }
    .term.gloss { border-bottom:2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }
    .es { margin-top:.25rem; }
    .pl { font-size:.9rem; opacity:.85; margin-top:.15rem; }

    .footer-row { display:flex; justify-content:space-between; align-items:center; margin-top:.6rem; font-weight:700; }
    .muted { opacity:.8; }

    /* Modal glosario exclusivo de esta secci√≥n */
    .modal-vocab { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.45); z-index:9999; }
    .modal-vocab.hidden { display:none; }
    .modal-box {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; width:min(520px, calc(100% - 2rem));
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .modal-box h4 { margin:0 0 .3rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    @media (max-width:600px){
      .grid { grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); }
      .vcard { min-height:140px; }
    }
  </style>

  <h2>Vokabeln lernen ‚Äì Flashcards</h2>
  <p class="hint">
    üéØ Objetivo: aprender <strong>200 palabras b√°sicas</strong> de uso cotidiano (nivel A2), organizadas por temas.  
    ‚úîÔ∏è Funcionamiento: cada tarjeta muestra solo el <strong>√≠cono</strong>. Toca/clic para <strong>revelar</strong> el art√≠culo + palabra en alem√°n, su <em>traducci√≥n al espa√±ol</em> y <strong>plural</strong>.  
    üß† Consejo: repasa por tema o usa el buscador. Todo funciona en celular, tablet y computador.
  </p>

  <!-- Filtros y acciones -->
  <div class="v-controls">
    <div class="pillbar" id="cat-bar" role="tablist" aria-label="Temas de vocabulario"></div>
    <div class="v-actions" style="width:100%;">
      <div class="v-search">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input id="v-search-input" type="search" placeholder="Buscar (alem√°n o espa√±ol)‚Ä¶">
      </div>
      <button class="btn-ghost" id="v-shuffle"><i class="fa-solid fa-shuffle"></i> Aleatorio</button>
      <button class="btn-ghost" id="v-hide-es"><i class="fa-solid fa-language"></i> Mostrar/Ocultar espa√±ol</button>
      <button class="btn-ghost" id="v-reset"><i class="fa-solid fa-rotate-left"></i> Reiniciar vista</button>
    </div>
  </div>

  <!-- Contenedor de tarjetas -->
  <div id="v-grid" class="grid" aria-live="polite"></div>
  <div class="footer-row">
    <span id="v-count" class="muted">0 resultados</span>
    <span id="v-progress" class="muted">Vistas: 0 / 20</span>
  </div>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <!-- Modal de glosario (√∫nico para esta secci√≥n) -->
  <div id="gloss-modal-vocab" class="modal-vocab hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term-vocab" aria-describedby="gloss-def-vocab">
    <div class="modal-box">
      <button id="gloss-close-vocab" class="modal-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term-vocab">T√©rmino</h4>
      <p id="gloss-def-vocab">Definici√≥n en espa√±ol</p>
    </div>
  </div>

  <script>
  (function(){
    const byId = id => document.getElementById(id);

    /* ===== Glosario (palabras algo m√°s dif√≠ciles) ===== */
    const GLOSS = {
      "die Versicherungskarte":"tarjeta del seguro m√©dico.",
      "der Ausweis":"documento de identidad.",
      "der Fahrplan":"horario oficial (buses/trenes).",
      "die Fahrkarte":"billete de transporte.",
      "das Gleis":"and√©n/v√≠a del tren.",
      "die Abfahrt":"salida de un tren/bus.",
      "die Ankunft":"llegada.",
      "die Versp√§tung":"retraso/demora.",
      "das Rathaus":"ayuntamiento/edificio municipal.",
      "das Schwimmbad":"piscina p√∫blica.",
      "der Spielplatz":"parque infantil.",
      "das Krankenhaus":"hospital.",
      "die Metzgerei":"carnicer√≠a.",
      "der Friseur":"peluquero / peluquer√≠a.",
      "die Feuerwehr":"cuerpo de bomberos.",
      "die Landschaft":"paisaje.",
      "die Jahreszeit":"estaci√≥n del a√±o.",
      "die Erk√§ltung":"resfriado.",
      "der Verband":"vendaje.",
      "das Pflaster":"tirita/curita.",
      "die Krankenversicherung":"seguro m√©dico.",
      "die Verabredung":"cita / quedada con alguien.",
      "der Bildschirm":"pantalla.",
      "die Tastatur":"teclado.",
      "das Ladeger√§t":"cargador.",
      "das Passwort":"contrase√±a.",
      "die Webseite":"p√°gina web.",
      "die Postfiliale":"oficina de correos.",
      "der Kassenbon":"ticket fiscal de compra.",
      "der Rucksack":"mochila (de espalda)."
    };

    function glossWrap(de){
      // Si el t√©rmino tiene glosario, lo hacemos clicable
      return GLOSS[de] ? de.replace(/(.+)/, '<span class="term gloss" data-term="$1">$1</span>') : de;
    }
    function attachGlossHandlers(scope){
      scope.querySelectorAll('.gloss').forEach(el=>{
        el.addEventListener('click', ()=>{
          const term = el.dataset.term;
          byId('gloss-term-vocab').textContent = term;
          byId('gloss-def-vocab').textContent = GLOSS[term] || 'Sin definici√≥n registrada.';
          byId('gloss-modal-vocab').classList.remove('hidden');
        });
      });
    }
    byId('gloss-close-vocab').addEventListener('click', ()=> byId('gloss-modal-vocab').classList.add('hidden'));

    /* ===== Banco de 200 palabras por categor√≠as ===== */
    const CATS = [
      { id:"hogar",  name:"Casa y hogar", icon:"fa-house", items: [
        ["fa-house","das Haus","la casa","n.","H√§user"],
        ["fa-building","die Wohnung","la vivienda","f.","Wohnungen"],
        ["fa-door-closed","das Zimmer","la habitaci√≥n","n.","Zimmer"],
        ["fa-door-open","die T√ºr","la puerta","f.","T√ºren"],
        ["fa-window-maximize","das Fenster","la ventana","n.","Fenster"],
        ["fa-bed","das Bett","la cama","n.","Betten"],
        ["fa-table","der Tisch","la mesa","m.","Tische"],
        ["fa-chair","der Stuhl","la silla","m.","St√ºhle"],
        ["fa-box-archive","der Schrank","el armario","m.","Schr√§nke"],
        ["fa-lightbulb","die Lampe","la l√°mpara","f.","Lampen"],
        ["fa-key","der Schl√ºssel","la llave","m.","Schl√ºssel"],
        ["fa-mirror","der Spiegel","el espejo","m.","Spiegel"],
        ["fa-square","der Teppich","la alfombra","m.","Teppiche"],
        ["fa-utensils","die K√ºche","la cocina","f.","K√ºchen"],
        ["fa-bath","das Bad","el ba√±o","n.","B√§der"],
        ["fa-shower","die Dusche","la ducha","f.","Duschen"],
        ["fa-toilet","die Toilette","el inodoro","f.","Toiletten"],
        ["fa-stairs","die Treppe","la escalera","f.","Treppen"],
        ["fa-house-chimney","der Balkon","el balc√≥n","m.","Balkone"],
        ["fa-seedling","der Garten","el jard√≠n","m.","G√§rten"],
      ]},
      { id:"escuela", name:"Escuela y estudio", icon:"fa-school", items:[
        ["fa-school","die Schule","la escuela","f.","Schulen"],
        ["fa-chalkboard","der Klassenraum","el aula","m.","Klassenr√§ume"],
        ["fa-users","die Klasse","la clase (grupo)","f.","Klassen"],
        ["fa-chalkboard-user","der Lehrer","el profesor","m.","Lehrer"],
        ["fa-chalkboard-user","die Lehrerin","la profesora","f.","Lehrerinnen"],
        ["fa-child","der Sch√ºler","el alumno","m.","Sch√ºler"],
        ["fa-child","die Sch√ºlerin","la alumna","f.","Sch√ºlerinnen"],
        ["fa-book","das Buch","el libro","n.","B√ºcher"],
        ["fa-book-open","das Heft","el cuaderno","n.","Hefte"],
        ["fa-pen","der Kuli","el bol√≠grafo","m.","Kulis"],
        ["fa-pencil","der Bleistift","el l√°piz","m.","Bleistifte"],
        ["fa-eraser","der Radiergummi","la goma","m.","Radiergummis"],
        ["fa-ruler","das Lineal","la regla","n.","Lineale"],
        ["fa-suitcase","der Rucksack","la mochila","m.","Rucks√§cke"],
        ["fa-file-lines","die Hausaufgabe","la tarea","f.","Hausaufgaben"],
        ["fa-clipboard-check","die Pr√ºfung","el examen","f.","Pr√ºfungen"],
        ["fa-clipboard-list","die Note","la nota","f.","Noten"],
        ["fa-table","der Stundenplan","el horario","m.","Stundenpl√§ne"],
        ["fa-file","das Zeugnis","el certificado","n.","Zeugnisse"],
        ["fa-book","die Bibliothek","la biblioteca","f.","Bibliotheken"],
      ]},
      { id:"comida", name:"Comida y bebidas", icon:"fa-bread-slice", items:[
        ["fa-bread-slice","das Brot","el pan","n.","Brote"],
        ["fa-bread-slice","das Br√∂tchen","el panecillo","n.","Br√∂tchen"],
        ["fa-cow","die Milch","la leche","f.","(ohne Pl.)"],
        ["fa-glass-water","das Wasser","el agua","n.","(ohne Pl.)"],
        ["fa-wine-glass","der Saft","el jugo","m.","S√§fte"],
        ["fa-mug-saucer","der Tee","el t√©","m.","Tees"],
        ["fa-mug-saucer","der Kaffee","el caf√©","m.","Kaffees"],
        ["fa-carrot","das Gem√ºse","la verdura","n.","(ohne Pl.)"],
        ["fa-apple-whole","das Obst","la fruta","n.","(ohne Pl.)"],
        ["fa-apple-whole","der Apfel","la manzana","m.","√Ñpfel"],
        ["fa-lemon","die Banane","el pl√°tano","f.","Bananen"],
        ["fa-lemon","die Orange","la naranja","f.","Orangen"],
        ["fa-seedling","die Tomate","el tomate","f.","Tomaten"],
        ["fa-seedling","die Kartoffel","la papa","f.","Kartoffeln"],
        ["fa-bowl-food","die Suppe","la sopa","f.","Suppen"],
        ["fa-bowl-food","der Salat","la ensalada","m.","Salate"],
        ["fa-pizza-slice","die Pizza","la pizza","f.","Pizzen"],
        ["fa-cheese","der K√§se","el queso","m.","(ohne Pl.)"],
        ["fa-egg","das Ei","el huevo","n.","Eier"],
        ["fa-fish","der Fisch","el pescado","m.","Fische"],
      ]},
      { id:"compras", name:"Compras y servicios", icon:"fa-basket-shopping", items:[
        ["fa-basket-shopping","der Supermarkt","el supermercado","m.","Superm√§rkte"],
        ["fa-store","der Markt","el mercado","m.","M√§rkte"],
        ["fa-store","der Laden","la tienda","m.","L√§den"],
        ["fa-credit-card","die Kasse","la caja","f.","Kassen"],
        ["fa-tags","der Preis","el precio","m.","Preise"],
        ["fa-percent","der Rabatt","el descuento","m.","Rabatte"],
        ["fa-receipt","die Quittung","el recibo","f.","Quittungen"],
        ["fa-receipt","der Kassenbon","el ticket","m.","Kassenbons"],
        ["fa-bag-shopping","die T√ºte","la bolsa","f.","T√ºten"],
        ["fa-cart-shopping","der Einkaufswagen","el carrito","m.","Einkaufswagen"],
        ["fa-mortar-pestle","die Apotheke","la farmacia","f.","Apotheken"],
        ["fa-envelope","die Postfiliale","la oficina de correos","f.","Postfilialen"],
        ["fa-box","das Paket","el paquete","n.","Pakete"],
        ["fa-envelope","der Brief","la carta","m.","Briefe"],
        ["fa-stamp","die Briefmarke","el sello","f.","Briefmarken"],
        ["fa-person","der Schalter","la ventanilla","m.","Schalter"],
        ["fa-file-lines","das Formular","el formulario","n.","Formulare"],
        ["fa-id-card","der Ausweis","el documento (ID)","m.","Ausweise"],
        ["fa-id-card","die Versicherungskarte","la tarjeta de seguro","f.","Versicherungskarten"],
        ["fa-file-lines","die Rechnung","la factura","f.","Rechnungen"],
      ]},
      { id:"transporte", name:"Transporte y viaje", icon:"fa-bus", items:[
        ["fa-bus","der Bus","el bus","m.","Busse"],
        ["fa-train","der Zug","el tren","m.","Z√ºge"],
        ["fa-train-subway","die U-Bahn","el metro","f.","U-Bahnen"],
        ["fa-taxi","das Taxi","el taxi","n.","Taxis"],
        ["fa-car","das Auto","el coche","n.","Autos"],
        ["fa-bicycle","das Fahrrad","la bicicleta","n.","Fahrr√§der"],
        ["fa-train","der Bahnhof","la estaci√≥n","m.","Bahnh√∂fe"],
        ["fa-location-dot","die Haltestelle","la parada","f.","Haltestellen"],
        ["fa-road","das Gleis","el and√©n/v√≠a","n.","Gleise"],
        ["fa-table-list","der Fahrplan","el horario","m.","Fahrpl√§ne"],
        ["fa-ticket","die Fahrkarte","el billete","f.","Fahrkarten"],
        ["fa-chair","der Sitzplatz","el asiento","m.","Sitzpl√§tze"],
        ["fa-suitcase","der Koffer","la maleta","m.","Koffer"],
        ["fa-bag-shopping","die Tasche","la bolsa","f.","Taschen"],
        ["fa-plane-departure","der Flughafen","el aeropuerto","m.","Flugh√§fen"],
        ["fa-clock","die Versp√§tung","el retraso","f.","Versp√§tungen"],
        ["fa-plane-arrival","die Ankunft","la llegada","f.","Ank√ºnfte"],
        ["fa-arrow-right","die Abfahrt","la salida","f.","Abfahrten"],
        ["fa-ticket","das Ticket","el ticket","n.","Tickets"],
        ["fa-passport","der Reisepass","el pasaporte","m.","Reisep√§sse"],
      ]},
      { id:"ciudad", name:"Ciudad y lugares", icon:"fa-city", items:[
        ["fa-city","die Stadt","la ciudad","f.","St√§dte"],
        ["fa-house","das Dorf","el pueblo","n.","D√∂rfer"],
        ["fa-tree","der Park","el parque","m.","Parks"],
        ["fa-road","die Stra√üe","la calle","f.","Stra√üen"],
        ["fa-square","der Platz","la plaza","m.","Pl√§tze"],
        ["fa-landmark","das Rathaus","el ayuntamiento","n.","Rath√§user"],
        ["fa-book","die Bibliothek","la biblioteca","f.","Bibliotheken"],
        ["fa-film","das Kino","el cine","n.","Kinos"],
        ["fa-masks-theater","das Theater","el teatro","n.","Theater"],
        ["fa-building","das Museum","el museo","n.","Museen"],
        ["fa-person-swimming","das Schwimmbad","la piscina","n.","Schwimmb√§der"],
        ["fa-child","der Spielplatz","el parque infantil","m.","Spielpl√§tze"],
        ["fa-church","die Kirche","la iglesia","f.","Kirchen"],
        ["fa-hospital","das Krankenhaus","el hospital","n.","Krankenh√§user"],
        ["fa-bread-slice","die B√§ckerei","la panader√≠a","f.","B√§ckereien"],
        ["fa-shop","die Metzgerei","la carnicer√≠a","f.","Metzgereien"],
        ["fa-scissors","der Friseur","la peluquer√≠a/el peluquero","m.","Friseure"],
        ["fa-building-columns","die Bank","el banco","f.","Banken"],
        ["fa-shield","die Polizei","la polic√≠a","f.","(ohne Pl.)"],
        ["fa-fire-extinguisher","die Feuerwehr","los bomberos","f.","Feuerwehren"],
      ]},
      { id:"naturaleza", name:"Naturaleza y clima", icon:"fa-sun", items:[
        ["fa-sun","die Sonne","el sol","f.","Sonnen"],
        ["fa-cloud","die Wolke","la nube","f.","Wolken"],
        ["fa-cloud-rain","der Regen","la lluvia","m.","(ohne Pl.)"],
        ["fa-snowflake","der Schnee","la nieve","m.","(ohne Pl.)"],
        ["fa-wind","der Wind","el viento","m.","Winde"],
        ["fa-smog","der Nebel","la niebla","m.","Nebel"],
        ["fa-cloud-bolt","das Gewitter","la tormenta","n.","Gewitter"],
        ["fa-cloud-bolt","der Sturm","la tempestad","m.","St√ºrme"],
        ["fa-tree","der Baum","el √°rbol","m.","B√§ume"],
        ["fa-seedling","die Blume","la flor","f.","Blumen"],
        ["fa-leaf","das Blatt","la hoja","n.","Bl√§tter"],
        ["fa-mountain","der Berg","la monta√±a","m.","Berge"],
        ["fa-water","der See","el lago","m.","Seen"],
        ["fa-water","der Fluss","el r√≠o","m.","Fl√ºsse"],
        ["fa-water","das Meer","el mar","n.","Meere"],
        ["fa-umbrella-beach","der Strand","la playa","m.","Str√§nde"],
        ["fa-image","die Landschaft","el paisaje","f.","Landschaften"],
        ["fa-calendar","die Jahreszeit","la estaci√≥n (a√±o)","f.","Jahreszeiten"],
        ["fa-cloud-rain","der Regenmantel","el impermeable","m.","Regenm√§ntel"],
        ["fa-umbrella","der Regenschirm","el paraguas","m.","Regenschirme"],
      ]},
      { id:"salud", name:"Cuerpo y salud", icon:"fa-user-doctor", items:[
        ["fa-user","der Kopf","la cabeza","m.","K√∂pfe"],
        ["fa-hand","die Hand","la mano","f.","H√§nde"],
        ["fa-shoe-prints","der Fu√ü","el pie","m.","F√º√üe"],
        ["fa-tooth","der Zahn","el diente","m.","Z√§hne"],
        ["fa-eye","das Auge","el ojo","n.","Augen"],
        ["fa-user-doctor","der Arzt","el m√©dico","m.","√Ñrzte"],
        ["fa-user-doctor","die √Ñrztin","la m√©dica","f.","√Ñrztinnen"],
        ["fa-house-medical","die Praxis","la consulta","f.","Praxen"],
        ["fa-calendar-check","der Termin","la cita","m.","Termine"],
        ["fa-tablets","die Tablette","la pastilla","f.","Tabletten"],
        ["fa-file-prescription","das Rezept","la receta m√©dica","n.","Rezepte"],
        ["fa-bandage","der Verband","el vendaje","m.","Verb√§nde"],
        ["fa-bandage","das Pflaster","la tirita","n.","Pflaster"],
        ["fa-temperature-high","das Fieber","la fiebre","n.","(ohne Pl.)"],
        ["fa-head-side-cough","die Erk√§ltung","el resfriado","f.","Erk√§ltungen"],
        ["fa-head-side-cough","der Husten","la tos","m.","(ohne Pl.)"],
        ["fa-syringe","die Spritze","la jeringa","f.","Spritzen"],
        ["fa-temperature-half","das Thermometer","el term√≥metro","n.","Thermometer"],
        ["fa-mask","die Maske","la mascarilla","f.","Masken"],
        ["fa-shield","die Krankenversicherung","el seguro m√©dico","f.","Krankenversicherungen"],
      ]},
      { id:"tiempo", name:"Tiempo y calendario", icon:"fa-calendar-days", items:[
        ["fa-calendar-day","der Tag","el d√≠a","m.","Tage"],
        ["fa-calendar-week","die Woche","la semana","f.","Wochen"],
        ["fa-calendar","der Monat","el mes","m.","Monate"],
        ["fa-calendar","das Jahr","el a√±o","n.","Jahre"],
        ["fa-calendar","das Wochenende","el fin de semana","n.","Wochenenden"],
        ["fa-sun","der Morgen","la ma√±ana","m.","Morgen"],
        ["fa-sun","der Mittag","el mediod√≠a","m.","Mittage"],
        ["fa-sun","der Nachmittag","la tarde","m.","Nachmittage"],
        ["fa-cloud-moon","der Abend","la noche (tarde-noche)","m.","Abende"],
        ["fa-moon","die Nacht","la noche","f.","N√§chte"],
        ["fa-clock","die Uhr","la hora / reloj","f.","Uhren"],
        ["fa-clock","die Stunde","la hora (60 min)","f.","Stunden"],
        ["fa-clock","die Minute","el minuto","f.","Minuten"],
        ["fa-circle-pause","die Pause","la pausa","f.","Pausen"],
        ["fa-umbrella-beach","die Ferien","las vacaciones","Pl.","(nur Pl.)"],
        ["fa-star","der Feiertag","el festivo","m.","Feiertage"],
        ["fa-envelope-open-text","die Einladung","la invitaci√≥n","f.","Einladungen"],
        ["fa-cake-candles","der Geburtstag","el cumplea√±os","m.","Geburtstage"],
        ["fa-calendar-days","der Kalender","el calendario","m.","Kalender"],
        ["fa-calendar-check","die Verabredung","la cita/quedada","f.","Verabredungen"],
      ]},
      { id:"tecnologia", name:"Tecnolog√≠a y medios", icon:"fa-mobile-screen-button", items:[
        ["fa-mobile-screen-button","das Handy","el m√≥vil","n.","Handys"],
        ["fa-phone","das Telefon","el tel√©fono","n.","Telefone"],
        ["fa-desktop","der Computer","el ordenador","m.","Computer"],
        ["fa-laptop","der Laptop","el port√°til","m.","Laptops"],
        ["fa-tablet-screen-button","das Tablet","la tablet","n.","Tablets"],
        ["fa-computer-mouse","die Maus","el rat√≥n","f.","M√§use"],
        ["fa-keyboard","die Tastatur","el teclado","f.","Tastaturen"],
        ["fa-display","der Bildschirm","la pantalla","m.","Bildschirme"],
        ["fa-globe","das Internet","internet","n.","(ohne Pl.)"],
        ["fa-envelope","die E-Mail","el correo electr√≥nico","f.","E-Mails"],
        ["fa-message","die Nachricht","el mensaje","f.","Nachrichten"],
        ["fa-camera","das Foto","la foto","n.","Fotos"],
        ["fa-camera","die Kamera","la c√°mara","f.","Kameras"],
        ["fa-plug","das Ladeger√§t","el cargador","n.","Ladeger√§te"],
        ["fa-headphones","der Kopfh√∂rer","los auriculares","m.","Kopfh√∂rer"],
        ["fa-print","der Drucker","la impresora","m.","Drucker"],
        ["fa-lock","das Passwort","la contrase√±a","n.","Passw√∂rter"],
        ["fa-mobile","die App","la aplicaci√≥n","f.","Apps"],
        ["fa-window-maximize","die Webseite","la p√°gina web","f.","Webseiten"],
        ["fa-link","der Link","el enlace","m.","Links"],
      ]},
    ];

    /* ===== Render categor√≠as (p√≠ldoras) ===== */
    const catBar = byId('cat-bar');
    CATS.forEach((c, i)=>{
      const btn = document.createElement('button');
      btn.className = 'pill' + (i===0?' active':'');
      btn.id = 'cat-'+c.id;
      btn.innerHTML = `<i class="fa-solid ${c.icon}"></i> ${c.name} <span class="badge">20</span>`;
      btn.addEventListener('click', ()=> setCategory(c.id));
      catBar.appendChild(btn);
    });

    /* ===== Estado y render de tarjetas ===== */
    const grid = byId('v-grid');
    const countEl = byId('v-count');
    const progEl = byId('v-progress');
    const searchInput = byId('v-search-input');
    const btnShuffle = byId('v-shuffle');
    const btnToggleEs = byId('v-hide-es');
    const btnReset = byId('v-reset');

    let currentCat = CATS[0].id;
    let showSpanish = true;
    let revealed = new Set(); // ids de tarjetas vistas (para progreso)
    let order = [...Array(20).keys()]; // √≠ndice 0..19 por categor√≠a

    function setCategory(id){
      currentCat = id;
      document.querySelectorAll('.pill').forEach(p=>p.classList.remove('active'));
      byId('cat-'+id).classList.add('active');
      order = [...Array(20).keys()];
      searchInput.value='';
      renderGrid();
      window.scrollTo({top: grid.getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'});
    }

    function renderGrid(){
      const cat = CATS.find(c=>c.id===currentCat);
      let items = order.map(i => ({i, data: cat.items[i]}));
      const q = searchInput.value.trim().toLowerCase();
      if (q){
        items = items.filter(o=>{
          const [icon,de,es] = [o.data[0], o.data[1], o.data[2]];
          return de.toLowerCase().includes(q) || es.toLowerCase().includes(q);
        });
      }
      grid.innerHTML = items.map(o=>{
        const [icon, de, es, gen, pl] = o.data;
        const id = currentCat+'__'+o.i;
        const deHtml = glossWrap(de);
        return `
          <div class="vcard" role="button" tabindex="0" data-id="${id}" data-de="${de}" data-es="${es}">
            <div class="vface icon-face"><i class="fa-solid ${icon}"></i></div>
            <div class="vface text-face">
              <div class="de"><span class="article">${gen}</span> ${deHtml}</div>
              <div class="es" style="${showSpanish?'':'display:none;'}"><i class="fa-solid fa-language"></i> ${es}</div>
              <div class="pl"><i class="fa-solid fa-users"></i> Plural: ${pl}</div>
            </div>
          </div>`;
      }).join('');
      // handlers: flip + accesibilidad + glosario
      grid.querySelectorAll('.vcard').forEach(card=>{
        const toggle = ()=> {
          card.classList.toggle('show');
          if (card.classList.contains('show')) revealed.add(card.dataset.id);
          updateProgress();
        };
        card.addEventListener('click', toggle);
        card.addEventListener('keydown', (e)=>{ if (e.key==='Enter'||e.key===' ') { e.preventDefault(); toggle(); } });
      });
      attachGlossHandlers(grid);
      countEl.textContent = `${items.length} resultado${items.length!==1?'s':''}`;
      updateProgress();
    }

    function updateProgress(){
      // progreso por categor√≠a: cu√°ntas tarjetas de esa categor√≠a han sido vistas al menos una vez
      const cat = CATS.find(c=>c.id===currentCat);
      const total = cat.items.length;
      const seen = [...revealed].filter(id=> id.startsWith(currentCat+'__')).length;
      progEl.textContent = `Vistas: ${seen} / ${total}`;
    }

    // Acciones
    btnShuffle.addEventListener('click', ()=>{
      order = order.map(i=>[Math.random(), i]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]);
      renderGrid();
    });
    btnToggleEs.addEventListener('click', ()=>{
      showSpanish = !showSpanish;
      grid.querySelectorAll('.text-face .es').forEach(el=>{
        el.style.display = showSpanish ? '' : 'none';
      });
    });
    btnReset.addEventListener('click', ()=>{
      revealed.clear();
      order = [...Array(20).keys()];
      searchInput.value='';
      renderGrid();
    });
    searchInput.addEventListener('input', renderGrid);

    // Inicial
    renderGrid();
  })();
  </script>
</section>


<!-- GRAMMATIK √úBEN (EXTENDIDO) -->
<section id="grammatik" class="contenido-oculto">
  <style>
    /* ===== Estilos locales para esta secci√≥n ===== */
    .hint {
      background: rgba(255,255,255,.8);
      border-left: 5px solid var(--blue);
      padding: .8rem 1rem; border-radius: 8px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .exo { margin: 1.2rem 0 2rem; }
    .exo h3 { display: flex; align-items: center; gap: .6rem; }
    .exo h3 i { opacity: .8; }

    /* DnD / Tap-to-build */
    .dnd-app { display:flex; flex-direction:column; gap: .75rem; }
    .dnd-status { display:flex; justify-content:space-between; align-items:center; gap:.5rem; font-size:.95rem; }
    .dnd-target, .dnd-source {
      display:flex; flex-wrap:wrap; gap:.5rem; padding: .8rem;
      min-height: 52px; border:2px dashed var(--blue); border-radius: 10px; background: rgba(255,255,255,.7);
    }
    .dnd-target { border-style: solid; }
    .chip {
      display:inline-flex; align-items:center; gap:.35rem;
      padding:.5rem .7rem; border-radius: 999px;
      background: var(--white); border:2px solid var(--coral);
      font-weight:600; cursor: pointer; user-select:none;
      transition: transform .12s ease-in-out;
    }
    .chip:active { transform: scale(.96); }
    .chip[draggable="true"] { cursor: grab; }
    .dnd-controls { display:flex; flex-wrap:wrap; gap:.6rem; }
    .btn-ghost {
      padding:.45rem .8rem; border-radius: 8px; border:2px solid var(--blue);
      background: transparent; font-weight:600; cursor:pointer;
    }
    .ok { color:#1a7f37; }
    .bad { color:#b1002e; }

    /* Multiple choice */
    .mc-card { background: rgba(255,255,255,.8); border-radius:12px; padding: .9rem; margin:.7rem 0; box-shadow:0 2px 8px var(--shadow); }
    .mc-q { margin-bottom:.4rem; }
    .mc-opts { list-style:none; padding:0; margin:0; }
    .mc-opts li { margin:.35rem 0; }
    .mc-controls { display:flex; align-items:center; gap:.8rem; flex-wrap:wrap; margin-top:.6rem; }

    /* Fill-in + Nube de palabras */
    .fill-item { background: rgba(255,255,255,.85); padding:.9rem; border-radius:12px; box-shadow:0 2px 8px var(--shadow); margin:.6rem 0; }
    .fill-item input {
      min-width: 120px; max-width: 160px; padding:.45rem .6rem; border-radius: 8px;
      border:2px solid var(--blue); outline:none; font-weight:700; text-align:center;
    }
    .word-bank { display:flex; flex-wrap:wrap; gap:.45rem; margin-top:.8rem; }
    .bank-chip { background:#fff; border:2px solid var(--grass); border-radius:999px; padding:.35rem .6rem; font-weight:700; cursor:pointer; }

    /* Modal de glosario */
    .modal { position: fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,.45); z-index:9999; }
    .modal.hidden { display:none; }
    .modal-content {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; max-width: 420px; width: calc(100% - 2rem);
      box-shadow:0 10px 30px rgba(0,0,0,.25);
    }
    .modal-content h4 { margin-bottom:.4rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    /* Palabras dif√≠ciles (clic para ver significado) */
    .gloss { border-bottom: 2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }

    /* M√≥vil */
    @media (max-width: 600px){
      .dnd-target, .dnd-source { min-height: 64px; }
      .chip { padding:.6rem .8rem; }
      .fill-item input { min-width: 90px; max-width: 120px; }
    }
  </style>

  <h2>Gram√°tica interactiva</h2>
  <p class="hint">
    üëã Bienvenido/a. Aqu√≠ reforzar√°s estructuras b√°sicas de alem√°n (<strong>A1/A2</strong>) usando ejercicios cortos y visuales.
    Todo est√° pensado para celular, tablet y computador. Si <em>arrastrar y soltar</em> no funciona en tu m√≥vil,
    simplemente <strong>toca</strong> las palabras para construir la frase. Las <span class="gloss" data-term="palabras dif√≠ciles">palabras dif√≠ciles</span>
    aparecen subrayadas: t√≥calas para ver su significado en espa√±ol.
  </p>

  <!-- 1) DnD / Tap-to-build -->
  <article class="exo exo-dnd">
    <h3><i class="fa-solid fa-hand-pointer"></i> 1. Ordena la frase (Drag & Drop o toque)</h3>
    <p>Forma la oraci√≥n en alem√°n a partir de las palabras desordenadas. Consejo: observa la posici√≥n del verbo y los elementos del tiempo/lugar.</p>

    <div id="dnd-app" class="dnd-app" aria-live="polite">
      <div class="dnd-status">
        <span id="dnd-progress">1 / 20</span>
        <div>
          <button id="dnd-reset" class="btn-ghost" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
          <button id="dnd-solution" class="btn-ghost" type="button"><i class="fa-solid fa-lightbulb"></i> Ver soluci√≥n</button>
        </div>
      </div>
      <div class="dnd-target" id="dnd-target" aria-label="Tu frase" role="list"></div>
      <div class="dnd-source" id="dnd-source" aria-label="Palabras disponibles" role="list"></div>
      <div class="dnd-controls">
        <button id="dnd-check" class="btn-submit" type="button">Comprobar</button>
        <button id="dnd-prev" class="btn-ghost" type="button">‚üµ Anterior</button>
        <button id="dnd-next" class="btn-ghost" type="button">Siguiente ‚ü∂</button>
      </div>
      <p id="dnd-feedback"></p>
    </div>
  </article>

  <!-- 2) Multiple choice -->
  <article class="exo exo-mc">
    <h3><i class="fa-solid fa-list-check"></i> 2. Opci√≥n m√∫ltiple (elige la forma correcta)</h3>
    <p>Selecciona la opci√≥n correcta para completar la frase. Enf√≥cate en <strong>art√≠culos</strong>, <strong>casos</strong> y <strong>formas verbales</strong>.</p>

    <div id="mc-app">
      <div id="mc-questions"></div>
      <div class="mc-controls">
        <button id="mc-check" class="btn-submit" type="button">Comprobar todo</button>
        <button id="mc-reset" class="btn-ghost" type="button">Reiniciar</button>
        <p id="mc-score" class="result"></p>
      </div>
    </div>
  </article>

  <!-- 3) Llenado de huecos + Nube de palabras -->
  <article class="exo exo-fill">
    <h3><i class="fa-solid fa-pen-to-square"></i> 3. Llenado de huecos (con banco de palabras)</h3>
    <p>Completa las oraciones con la opci√≥n correcta. Puedes escribir directamente o tocar una palabra del <strong>banco</strong> para insertarla.</p>
    <div id="fill-app">
      <div id="fill-questions"></div>
      <div>
        <h4 style="margin-top:.8rem;">Banco de palabras</h4>
        <div class="word-bank" id="word-bank"></div>
      </div>
      <div class="mc-controls">
        <button id="fill-check" class="btn-submit" type="button">Comprobar todo</button>
        <button id="fill-reset" class="btn-ghost" type="button">Reiniciar</button>
        <p id="fill-score" class="result"></p>
      </div>
    </div>
  </article>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <!-- Modal Glosario -->
  <div id="gloss-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term" aria-describedby="gloss-def">
    <div class="modal-content">
      <button class="modal-close" id="gloss-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term">T√©rmino</h4>
      <p id="gloss-def">Definici√≥n en espa√±ol.</p>
    </div>
  </div>

  <script>
  (function(){
    /* ======== Datos (Banco de ejercicios) ======== */
    const DND_ITEMS = [
      { parts:["ich","fr√ºh","auf","stehe"], answer:"Ich stehe fr√ºh auf." },
      { parts:["wir","mit dem Bus","zur Schule","fahren"], answer:"Wir fahren mit dem Bus zur Schule." },
      { parts:["meine Schwester","gern","liest","B√ºcher"], answer:"Meine Schwester liest gern B√ºcher." },
      { parts:["wann","triffst","du","Freunde"], answer:"Wann triffst du Freunde?" },
      { parts:["er","jeden Tag","kocht","das Abendessen"], answer:"Er kocht jeden Tag das Abendessen." },
      { parts:["spielen","die Kinder","im Park"], answer:"Die Kinder spielen im Park." },
      { parts:["ich","einkaufen","im Supermarkt","gehe"], answer:"Ich gehe im Supermarkt einkaufen." },
      { parts:["wir","heute Abend","bestellen","eine Pizza"], answer:"Wir bestellen heute Abend eine Pizza." },
      { parts:["wann","kommt","der Zug"], answer:"Wann kommt der Zug?" },
      { parts:["meine Eltern","im Krankenhaus","arbeiten","beide"], answer:"Meine Eltern arbeiten beide im Krankenhaus." },
      { parts:["wie lange","lernst","du","Deutsch"], answer:"Wie lange lernst du Deutsch?" },
      { parts:["sie","auf dem Land","wohnt"], answer:"Sie wohnt auf dem Land." },
      { parts:["wir","morgen","keine Schule","haben"], answer:"Wir haben morgen keine Schule." },
      { parts:["machst","du","nach dem Essen","die Hausaufgaben"], answer:"Machst du nach dem Essen die Hausaufgaben?" },
      { parts:["er","mit dem Fahrrad","zur Arbeit","f√§hrt"], answer:"Er f√§hrt mit dem Fahrrad zur Arbeit." },
      { parts:["die Lehrerin","erkl√§rt","die Aufgabe","langsam"], answer:"Die Lehrerin erkl√§rt die Aufgabe langsam." },
      { parts:["wen","besuchen","wir","am Sonntag"], answer:"Wen besuchen wir am Sonntag?" },
      { parts:["ich","ein Ticket","am Schalter","kaufe"], answer:"Ich kaufe ein Ticket am Schalter." },
      { parts:["die Bahn","heute","hat","Versp√§tung"], answer:"Die Bahn hat heute Versp√§tung." },
      { parts:["h√∂rst","du","nach der Schule","Musik"], answer:"H√∂rst du nach der Schule Musik?" }
    ];

    const MC_ITEMS = [
      { q:"Ich ___ ein Buch.", opts:["lesen","lese","liest"], ans:1 },
      { q:"Wir ___ gestern keine Zeit.", opts:["hatten","hat","haben"], ans:0 },
      { q:"___ Bruder studiert in Berlin.", opts:["Mein","Meine","Meinen"], ans:0 },
      { q:"Ich fahre morgen ___ Bus zur Schule.", opts:["mit dem","mit den","mit der"], ans:0 },
      { q:"Sie ___ sehr m√ºde.", opts:["ist","sind","seid"], ans:0 },
      { q:"Gestern ___ es sehr kalt.", opts:["war","ist","waren"], ans:0 },
      { q:"Ich nehme ___ Apfel.", opts:["der","den","dem"], ans:1 },
      { q:"Wir treffen ___ Freunde im Park.", opts:["unsere","unseren","unserem"], ans:0 },
      { q:"Er hat ___ Hausaufgaben gemacht.", opts:["sein","seine","seinen"], ans:1 },
      { q:"Ich gehe heute ___ Stadt.", opts:["in die","in der","in den"], ans:0 },
      { q:"Das ist die Tasche ___ Schwester.", opts:["meines","meiner","meinem"], ans:1 },
      { q:"Ich wohne seit zwei Jahren ___ K√∂ln.", opts:["in","nach","zu"], ans:0 },
      { q:"K√∂nnen Sie mir ___ helfen?", opts:["bitte","bittet","gebeten"], ans:0 },
      { q:"Er ___ gestern krank.", opts:["ist","war","hatte"], ans:1 },
      { q:"Ich habe heute keine ___.", opts:["Zeit","Zeite","Zeiten"], ans:0 },
      { q:"Wie sp√§t ___ es?", opts:["sind","ist","war"], ans:1 },
      { q:"Wir warten ___ den Bus.", opts:["auf","an","mit"], ans:0 },
      { q:"Ich trinke lieber ___ Wasser als Cola.", opts:["ein","√ò","der"], ans:1 },
      { q:"Sie hat ___ neue Schuhe gekauft.", opts:["ein","eine","√ò"], ans:1 },
      { q:"Der Zug ___ um 7:30 Uhr ab.", opts:["f√§hrt","fahrt","fuhr"], ans:0 }
    ];

    const FILL_ITEMS = [
      { q:"Ich ___ 12 Jahre alt.", ans:"bin" },
      { q:"Wir ___ am Samstag frei.", ans:"haben" },
      { q:"Gestern ___ ich krank.", ans:"war" },
      { q:"Meine Mutter ___ im Krankenhaus.", ans:"arbeitet" },
      { q:"Ich ___ jeden Morgen Kaffee.", ans:"trinke" },
      { q:"Er ___ mit dem Fahrrad zur Schule.", ans:"f√§hrt" },
      { q:"Wir ___ die Gro√üeltern am Sonntag.", ans:"besuchen" },
      { q:"Ich ___ kein Geld dabei.", ans:"habe" },
      { q:"Wo ___ du? In K√∂ln.", ans:"wohnst" },
      { q:"Sie ___ sehr gut Deutsch.", ans:"spricht" },
      { q:"Im Sommer ___ wir oft im See.", ans:"baden" },
      { q:"Gestern ___ wir keine Hausaufgaben.", ans:"hatten" },
      { q:"Ich ___ heute fr√ºh auf.", ans:"stehe" },
      { q:"Sie ___ Brot und Milch.", ans:"kauft" },
      { q:"Wir ___ um 7 Uhr in der Schule.", ans:"sind" },
      { q:"Der Film ___ um 18:30 Uhr.", ans:"beginnt" },
      { q:"Ich ___ gern Fu√üball.", ans:"spiele" },
      { q:"Heute ___ es warm.", ans:"ist" },
      { q:"Entschuldigung, ich ___ eine Frage.", ans:"habe" },
      { q:"Meine Freunde ___ morgen nach Berlin.", ans:"fahren" }
    ];
    const WORD_BANK = [...new Set(FILL_ITEMS.map(x => x.ans))];

    /* ======== Glosario (palabras dif√≠ciles) ======== */
    const GLOSS = {
      "Versp√§tung":"demora, retraso (p.ej., del tren).",
      "Schalter":"ventanilla/taquilla (punto de atenci√≥n para comprar tickets).",
      "beide":"ambos/ambas.",
      "wann":"¬øcu√°ndo?",
      "wie lange":"¬øcu√°nto tiempo?",
      "bestellen":"pedir/ordenar (comida, producto).",
      "erkl√§rt":"explica.",
      "Aufgabe":"tarea/ejercicio.",
      "besuchen":"visitar.",
      "beginnt":"empieza, comienza.",
      "wohnt":"vive (reside).",
      "f√§hrt":"va/conduce (en veh√≠culo).",
      "seit":"desde (hace).",
      "gebeten":"(participio de) pedir/rogar (no se usa aqu√≠ como opci√≥n correcta)."
    };

    /* ======== Utilidades ======== */
    const byId = id => document.getElementById(id);
    const norm = s => s.toLowerCase().replaceAll(/[.,!?¬ø¬°]/g,'').trim();
    function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }

    /* ======== 1) DnD / Tap-to-build ======== */
    const dnd = {
      idx: 0,
      init(){
        this.target = byId('dnd-target');
        this.source = byId('dnd-source');
        this.progress = byId('dnd-progress');
        this.feedback = byId('dnd-feedback');
        byId('dnd-check').addEventListener('click', ()=>this.check());
        byId('dnd-prev').addEventListener('click', ()=>this.move(-1));
        byId('dnd-next').addEventListener('click', ()=>this.move(1));
        byId('dnd-reset').addEventListener('click', ()=>this.load(this.idx));
        byId('dnd-solution').addEventListener('click', ()=>this.showSolution());
        this.load(0);
      },
      move(delta){
        this.idx = (this.idx + delta + DND_ITEMS.length) % DND_ITEMS.length;
        this.load(this.idx);
      },
      makeChip(text){
        const btn = document.createElement('button');
        btn.className = 'chip';
        btn.type = 'button';
        btn.textContent = text;
        btn.setAttribute('draggable','true');
        btn.addEventListener('dragstart', e=> e.dataTransfer.setData('text/plain', text));
        // Tap-to-move
        btn.addEventListener('click', ()=>{
          if (btn.parentElement === this.source) {
            this.target.appendChild(btn);
          } else {
            this.source.appendChild(btn);
          }
        });
        // Glosario si aplica
        const t = text.trim();
        const key = Object.keys(GLOSS).find(k => k.toLowerCase() === t.toLowerCase());
        if (key){
          btn.classList.add('gloss');
          btn.addEventListener('click', (ev)=>{
            // Evitar que el movimiento tape el gloss: si Ctrl o Alt, solo gloss
            if (!ev.ctrlKey && !ev.altKey) showGloss(key); 
          }, {capture:true});
        }
        return btn;
      },
      setupDnDZones(){
        const onOver = e=>{ e.preventDefault(); };
        const onDropTo = (toEl) => (e)=>{
          e.preventDefault();
          const text = e.dataTransfer.getData('text/plain');
          // Buscar chip en source con ese texto (si hay repetidos, toma el primero visible)
          const chip = [...this.source.querySelectorAll('.chip')].find(c => c.textContent === text);
          if (chip) toEl.appendChild(chip);
        };
        this.target.addEventListener('dragover', onOver);
        this.source.addEventListener('dragover', onOver);
        this.target.addEventListener('drop', onDropTo(this.target));
        this.source.addEventListener('drop', onDropTo(this.source));
      },
      load(i){
        const item = DND_ITEMS[i];
        this.feedback.textContent = '';
        this.progress.textContent = (i+1) + ' / ' + DND_ITEMS.length;

        // limpiar
        this.target.innerHTML = '';
        this.source.innerHTML = '';

        // rellenar source con orden aleatorio
        const parts = shuffle(item.parts.slice());
        parts.forEach(p => this.source.appendChild(this.makeChip(p)));

        // Asegurar listeners DnD
        this.setupDnDZones();
      },
      currentSentence(){
        return [...this.target.querySelectorAll('.chip')].map(c=>c.textContent).join(' ');
      },
      check(){
        const item = DND_ITEMS[this.idx];
        const got = norm(this.currentSentence());
        const expected = norm(item.answer);
        if (!got) {
          this.feedback.textContent = 'Primero arma tu oraci√≥n tocando/arrastrando las palabras.';
          this.feedback.className = 'bad';
          return;
        }
        if (got === expected){
          this.feedback.textContent = '¬°Correcto! üéâ';
          this.feedback.className = 'ok';
        } else {
          this.feedback.textContent = 'A√∫n no. Revisa posici√≥n del verbo y complementos.';
          this.feedback.className = 'bad';
        }
      },
      showSolution(){
        const item = DND_ITEMS[this.idx];
        this.target.innerHTML = '';
        this.source.innerHTML = '';
        item.parts.forEach(p => this.target.appendChild(this.makeChip(p)));
        this.feedback.textContent = 'Soluci√≥n mostrada.';
        this.feedback.className = 'ok';
      }
    };

    /* ======== 2) Multiple choice ======== */
    const mc = {
      init(){
        this.wrap = byId('mc-questions');
        this.score = byId('mc-score');
        byId('mc-check').addEventListener('click', ()=>this.checkAll());
        byId('mc-reset').addEventListener('click', ()=>this.render());
        this.render();
      },
      render(){
        this.score.textContent = '';
        this.wrap.innerHTML = '';
        MC_ITEMS.forEach((it, idx)=>{
          const card = document.createElement('div'); card.className='mc-card';
          const q = document.createElement('div'); q.className='mc-q';
          // Realzar palabras dif√≠ciles en el enunciado
          let qText = it.q;
          qText = qText
            .replace('seit', '<span class="gloss" data-term="seit">seit</span>');
          q.innerHTML = `<strong>${idx+1}.</strong> ${qText}`;
          const ul = document.createElement('ul'); ul.className='mc-opts';
          it.opts.forEach((opt,oIdx)=>{
            // marcar opciones con t√©rminos dif√≠ciles
            let showOpt = opt;
            if (GLOSS[opt]) showOpt = `<span class="gloss" data-term="${opt}">${opt}</span>`;
            const id = `mc_${idx}_${oIdx}`;
            const li = document.createElement('li');
            li.innerHTML = `
              <label for="${id}">
                <input type="radio" id="${id}" name="mc_${idx}" value="${oIdx}">
                ${String.fromCharCode(97+oIdx)}) ${showOpt}
              </label>`;
            ul.appendChild(li);
          });
          const feedback = document.createElement('p'); feedback.id = `mc_fb_${idx}`;
          card.appendChild(q); card.appendChild(ul); card.appendChild(feedback);
          this.wrap.appendChild(card);
        });
        // activar glosario en los spans a√±adidos
        this.wrap.querySelectorAll('.gloss').forEach(el=>{
          el.addEventListener('click', ()=> showGloss(el.dataset.term));
        });
      },
      checkAll(){
        let correct=0;
        MC_ITEMS.forEach((it, idx)=>{
          const chosen = document.querySelector(`input[name="mc_${idx}"]:checked`);
          const fb = byId(`mc_fb_${idx}`);
          if(!chosen){
            fb.textContent='Elige una opci√≥n.'; fb.className='bad';
            return;
          }
          if (parseInt(chosen.value,10) === it.ans){
            fb.textContent='¬°Correcto!'; fb.className='ok'; correct++;
          } else {
            fb.textContent=`Incorrecto. Respuesta: ${String.fromCharCode(97+it.ans)}) ${it.opts[it.ans]}`; fb.className='bad';
          }
        });
        this.score.textContent = `Puntaje: ${correct} / ${MC_ITEMS.length}`;
      }
    };

    /* ======== 3) Fill-in + Banco de palabras ======== */
    const fill = {
      init(){
        this.wrap = byId('fill-questions');
        this.bank = byId('word-bank');
        this.score = byId('fill-score');
        byId('fill-check').addEventListener('click', ()=>this.checkAll());
        byId('fill-reset').addEventListener('click', ()=>this.render());
        this.render();
      },
      render(){
        this.score.textContent = '';
        this.wrap.innerHTML = '';
        // Render preguntas
        FILL_ITEMS.forEach((it, idx)=>{
          const box = document.createElement('div'); box.className='fill-item';
          // Resaltar palabras dif√≠ciles en el enunciado
          let qText = it.q
            .replace('f√§hrt','<span class="gloss" data-term="f√§hrt">f√§hrt</span>')
            .replace('wo','<span class="gloss" data-term="wann">wo</span>') // nota: usamos gloss de 'wann' solo para ejemplo "interrogativos"
            .replace('beginnt','<span class="gloss" data-term="beginnt">beginnt</span>')
            .replace('wohne','<span class="gloss" data-term="wohnt">wohne</span>') // aproximaci√≥n
            .replace('wohns','<span class="gloss" data-term="wohnt">wohns</span>');
          box.innerHTML = `
            <label for="fill_${idx}"><strong>${idx+1}.</strong> ${qText}</label>
            <div style="margin-top:.4rem;">
              <input inputmode="latin" autocomplete="off" autocapitalize="off" spellcheck="false" id="fill_${idx}" placeholder="Escribe o toca del banco ‚Üí">
              <span id="fill_fb_${idx}"></span>
            </div>
          `;
          this.wrap.appendChild(box);
        });
        // Glosario en enunciados
        this.wrap.querySelectorAll('.gloss').forEach(el=>{
          el.addEventListener('click', ()=> showGloss(el.dataset.term));
        });
        // Banco de palabras
        this.bank.innerHTML = '';
        WORD_BANK.forEach(w=>{
          const chip = document.createElement('button');
          chip.type='button'; chip.className='bank-chip'; chip.textContent = w;
          chip.addEventListener('click', ()=>{
            // insertar en input enfocado o el primero vac√≠o
            const focused = document.activeElement && document.activeElement.tagName==='INPUT' && document.activeElement.id.startsWith('fill_')
              ? document.activeElement
              : [...this.wrap.querySelectorAll('input')].find(i=>!i.value);
            if (focused) {
              focused.value = w;
              focused.focus();
            }
          });
          this.bank.appendChild(chip);
        });
      },
      checkAll(){
        let correct=0;
        FILL_ITEMS.forEach((it, idx)=>{
          const input = byId(`fill_${idx}`);
          const fb = byId(`fill_fb_${idx}`);
          const val = (input.value || '').trim().toLowerCase();
          if (!val){ fb.textContent=' ‚ö†Ô∏è'; fb.className='bad'; fb.style.marginLeft='.4rem'; return; }
          if (val === it.ans.toLowerCase()){
            fb.textContent=' ‚úî'; fb.className='ok'; fb.style.marginLeft='.4rem'; correct++;
          } else {
            fb.textContent=` ‚úñ (${it.ans})`; fb.className='bad'; fb.style.marginLeft='.4rem';
          }
        });
        this.score.textContent = `Puntaje: ${correct} / ${FILL_ITEMS.length}`;
      }
    };

    /* ======== Modal glosario ======== */
    const modal = byId('gloss-modal'), termEl = byId('gloss-term'), defEl = byId('gloss-def');
    byId('gloss-close').addEventListener('click', ()=> modal.classList.add('hidden'));
    function showGloss(term){
      const key = Object.keys(GLOSS).find(k => k.toLowerCase() === term.toLowerCase());
      termEl.textContent = key || term;
      defEl.textContent = GLOSS[key] || 'Sin definici√≥n registrada.';
      modal.classList.remove('hidden');
    }

    /* ======== Inicializar cuando el DOM est√© listo ======== */
    function initAll(){
      // Activar glosario en el texto introductorio
      document.querySelectorAll('#grammatik .gloss').forEach(el=>{
        if (el.dataset.term) el.addEventListener('click', ()=> showGloss(el.dataset.term));
      });
      dnd.init(); mc.init(); fill.init();
    }
    if (document.readyState !== 'loading') initAll();
    else document.addEventListener('DOMContentLoaded', initAll);
  })();
  </script>
</section>


<!-- LESEVERSTEHEN (EXTENDIDO) -->
<section id="lesen" class="contenido-oculto">
  <style>
    /* ===== Estilos locales para Comprensi√≥n Lectora ===== */
    .hint {
      background: rgba(255,255,255,.85);
      border-left: 5px solid var(--blue);
      padding: .9rem 1rem; border-radius: 10px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .lesen-wrap { display:flex; flex-direction:column; gap:1rem; }
    .tabs { display:flex; gap:.6rem; flex-wrap:wrap; }
    .tab-btn {
      border:2px solid var(--blue); background:#fff; color:var(--text);
      padding:.5rem .8rem; border-radius: 999px; cursor:pointer; font-weight:700;
    }
    .tab-btn.active { background: var(--blue); color: #fff; }
    .card-lesen {
      background: rgba(255,255,255,.9); border-radius: 12px; padding: 1rem;
      box-shadow: 0 4px 16px var(--shadow);
    }
    .title-row { display:flex; align-items:center; gap:.6rem; margin-bottom:.4rem; }
    .mini-text { font-size:1rem; line-height:1.55; margin:.4rem 0 .8rem; }
    .q-block { margin:.6rem 0; }
    .opts { list-style:none; margin:.3rem 0 0; padding:0; }
    .opts li { margin:.3rem 0; }
    .opts label { display:flex; align-items:center; gap:.5rem; cursor:pointer; }
    .controls { display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; margin-top:.6rem; }
    .score { font-weight:700; }
    .ok { color:#1a7f37; }
    .bad { color:#b1002e; }
    .muted { opacity:.85; }

    /* Modal glosario local (ID √∫nico para esta secci√≥n) */
    .modal-lesen { position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: rgba(0,0,0,.45); z-index: 9999; }
    .modal-lesen.hidden { display:none; }
    .modal-box {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; width:min(460px, calc(100% - 2rem));
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .modal-box h4 { margin:0 0 .3rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    /* Palabras dif√≠ciles clicables */
    .gloss { border-bottom:2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }

    /* Responsivo m√≥vil */
    @media (max-width:600px){
      .card-lesen { padding:.9rem; }
      .opts li { margin:.25rem 0; }
    }
  </style>

  <h2>Comprensi√≥n lectora ‚Äì Lesen und Verstehen</h2>
  <p class="hint">
    üìñ En esta secci√≥n practicar√°s con <strong>textos muy cortos</strong> (correos, avisos, mensajes) como en el nivel <strong>A1/A2</strong>.  
    Lee con calma y responde. Funciona en celular, tablet y computador.  
    Las <span class="gloss" data-term="palabras dif√≠ciles">palabras dif√≠ciles</span> aparecen subrayadas: t√≥calas para ver el significado en espa√±ol.
  </p>

  <div class="lesen-wrap">
    <div class="tabs" role="tablist">
      <button class="tab-btn active" id="tab-mini" type="button"><i class="fa-solid fa-envelope-open-text"></i> Mini-textos</button>
      <button class="tab-btn" id="tab-vf" type="button"><i class="fa-solid fa-check-double"></i> Verdadero/Falso</button>
    </div>

    <!-- MINI-TEXTOS -->
    <div id="mini-panel" class="card-lesen" role="tabpanel" aria-labelledby="tab-mini">
      <div class="title-row">
        <i id="mini-icon" class="fa-solid fa-envelope"></i>
        <strong id="mini-tipo">[Correo escolar]</strong>
        <span class="muted" id="mini-progress">1 / 15</span>
      </div>
      <div id="mini-text" class="mini-text"></div>
      <div class="q-block">
        <div id="mini-q1" class="mc-row"></div>
        <ul id="mini-opts1" class="opts"></ul>
        <p id="mini-fb1"></p>
      </div>
      <div class="q-block">
        <div id="mini-q2" class="mc-row"></div>
        <ul id="mini-opts2" class="opts"></ul>
        <p id="mini-fb2"></p>
      </div>
      <div class="controls">
        <button class="btn-submit" id="mini-check" type="button">Comprobar</button>
        <button class="btn-ghost" id="mini-prev" type="button">‚üµ Anterior</button>
        <button class="btn-ghost" id="mini-next" type="button">Siguiente ‚ü∂</button>
        <button class="btn-ghost" id="mini-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
        <span id="mini-score" class="score"></span>
      </div>
    </div>

    <!-- VERDADERO/FALSO -->
    <div id="vf-panel" class="card-lesen" role="tabpanel" aria-labelledby="tab-vf" style="display:none;">
      <div class="title-row">
        <i id="vf-icon" class="fa-solid fa-circle-info"></i>
        <strong id="vf-tipo">[Aviso del edificio]</strong>
        <span class="muted" id="vf-progress">1 / 15</span>
      </div>
      <div id="vf-text" class="mini-text"></div>

      <div class="q-block">
        <div class="mc-row"><strong>1.</strong> <span id="vf-a1"></span></div>
        <ul class="opts">
          <li><label><input type="radio" name="vf1" value="true"> Wahr</label></li>
          <li><label><input type="radio" name="vf1" value="false"> Falsch</label></li>
        </ul>
        <p id="vf-fb1"></p>
      </div>
      <div class="q-block">
        <div class="mc-row"><strong>2.</strong> <span id="vf-a2"></span></div>
        <ul class="opts">
          <li><label><input type="radio" name="vf2" value="true"> Wahr</label></li>
          <li><label><input type="radio" name="vf2" value="false"> Falsch</label></li>
        </ul>
        <p id="vf-fb2"></p>
      </div>
      <div class="q-block">
        <div class="mc-row"><strong>3.</strong> <span id="vf-a3"></span></div>
        <ul class="opts">
          <li><label><input type="radio" name="vf3" value="true"> Wahr</label></li>
          <li><label><input type="radio" name="vf3" value="false"> Falsch</label></li>
        </ul>
        <p id="vf-fb3"></p>
      </div>

      <div class="controls">
        <button class="btn-submit" id="vf-check" type="button">Comprobar</button>
        <button class="btn-ghost" id="vf-prev" type="button">‚üµ Anterior</button>
        <button class="btn-ghost" id="vf-next" type="button">Siguiente ‚ü∂</button>
        <button class="btn-ghost" id="vf-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
        <span id="vf-score" class="score"></span>
      </div>
    </div>
  </div>

  <!-- Modal de glosario (√∫nico para esta secci√≥n) -->
  <div id="gloss-modal-lesen" class="modal-lesen hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term-lesen" aria-describedby="gloss-def-lesen">
    <div class="modal-box">
      <button id="gloss-close-lesen" class="modal-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term-lesen">T√©rmino</h4>
      <p id="gloss-def-lesen">Definici√≥n en espa√±ol</p>
    </div>
  </div>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <script>
  (function(){
    /* ========= Glosario (palabras dif√≠ciles) ========= */
    const GLOSS = {
      "Betreff":"asunto (en un correo).",
      "Treffpunkt":"punto de encuentro.",
      "Turnhalle":"gimnasio o coliseo escolar.",
      "Trinkflasche":"botella de agua.",
      "Versp√§tung":"retraso, demora.",
      "Einlass":"ingreso/entrada permitida.",
      "Mensa":"comedor escolar/universitario.",
      "Ausleihe":"pr√©stamo (de libros, etc.).",
      "Praxis":"consultorio m√©dico.",
      "R√ºckgabeautomat":"m√°quina para devoluci√≥n (de libros).",
      "Beratung":"asesor√≠a/atenci√≥n al p√∫blico.",
      "gesperrt":"cerrado/bloqueado.",
      "Linie":"l√≠nea (de bus/metro).",
      "Ersatzbus":"bus de reemplazo.",
      "Taschenrechner":"calculadora.",
      "Notenheft":"cuaderno de partituras.",
      "verschoben":"aplazado/reprogramado.",
      "Versicherungskarte":"tarjeta de seguro m√©dico.",
      "Ausweis":"documento de identidad.",
      "Schneegefahr":"peligro de nieve.",
      "Foyer":"vest√≠bulo/entrada de un edificio.",
      "Eintritt":"entrada (boleto) / costo de entrada."
    };

    /* ========= Utilidades ========= */
    const byId = id => document.getElementById(id);
    // resalta t√©rminos con span.gloss
    function highlightGloss(text){
      // Ordenar claves por longitud para evitar solapamientos
      const keys = Object.keys(GLOSS).sort((a,b)=>b.length-a.length);
      let out = text;
      keys.forEach(k=>{
        const rx = new RegExp(`\\b${escapeRegExp(k)}\\b`,'g');
        out = out.replace(rx, `<span class="gloss" data-term="${k}">${k}</span>`);
      });
      return out;
    }
    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
    function attachGlossHandlers(scope){
      scope.querySelectorAll('.gloss').forEach(el=>{
        el.addEventListener('click', ()=> showGloss(el.dataset.term));
      });
    }
    function showGloss(term){
      const modal = byId('gloss-modal-lesen');
      byId('gloss-term-lesen').textContent = term;
      byId('gloss-def-lesen').textContent = GLOSS[term] || 'Sin definici√≥n registrada.';
      modal.classList.remove('hidden');
    }
    byId('gloss-close-lesen').addEventListener('click', ()=> byId('gloss-modal-lesen').classList.add('hidden'));

    /* ========= Banco A) Mini-textos (15) ========= */
    const ICONS = {
      "Correo escolar": "fa-envelope-open-text",
      "Mensaje de m√≥vil": "fa-mobile-screen",
      "Aviso escolar": "fa-school",
      "Correo de biblioteca": "fa-book",
      "Mensaje del entrenador": "fa-person-running",
      "Anuncio de cine": "fa-film",
      "Nota del profesor": "fa-chalkboard-user",
      "Correo de excursi√≥n": "fa-train-subway",
      "Aviso del supermercado": "fa-basket-shopping",
      "Mensaje de consulta m√©dica": "fa-user-doctor",
      "Correo de biblioteca escolar": "fa-book-open-reader",
      "Anuncio de transporte": "fa-bus",
      "Mensaje de clase de m√∫sica": "fa-music",
      "Correo de cumplea√±os": "fa-cake-candles",
      "Aviso del tiempo": "fa-cloud-sun-rain"
    };

    const MINI = [
      {
        tipo:"Correo escolar",
        text:`<strong>Betreff</strong>: Klassenfahrt<br>
        Liebe Eltern, am Freitag fahren wir um 7:30 Uhr mit dem Bus nach Bremen. <strong>Treffpunkt</strong> ist vor der <strong>Turnhalle</strong>. Bitte geben Sie den Kindern eine <strong>Trinkflasche</strong> und ein Sandwich mit.`,
        q1:"¬øCu√°ndo es la salida (Abfahrt)?",
        opts1:["7:00 Uhr","7:30 Uhr","8:00 Uhr"], ans1:1,
        q2:"¬øD√≥nde es el punto de encuentro (Treffpunkt)?",
        opts2:["Vor der Turnhalle","Am Lehrerzimmer","Im Klassenzimmer"], ans2:0
      },
      {
        tipo:"Mensaje de m√≥vil",
        text:`Hi Ben, ich komme heute sp√§ter. Mein Zug hat 15 Minuten <strong>Versp√§tung</strong>. Warte bitte vor dem Kino. ‚Äì Max`,
        q1:"¬øD√≥nde debe esperar Ben?",
        opts1:["Vor der Schule","Vor dem Kino","Am Bahnhof"], ans1:1,
        q2:"¬øCu√°nto es el retraso?",
        opts2:["10 Minuten","20 Minuten","15 Minuten"], ans2:2
      },
      {
        tipo:"Aviso escolar",
        text:`<strong>Mensa</strong>: Heute gibt es vegetarische Pasta und Salat. Das Mittagessen kostet 4,00 ‚Ç¨. Wasser ist kostenlos.`,
        q1:"¬øCu√°nto cuesta el almuerzo?",
        opts1:["2,50 ‚Ç¨","4,00 ‚Ç¨","5,00 ‚Ç¨"], ans1:1,
        q2:"¬øQu√© es gratuito?",
        opts2:["Salat","Wasser","Pasta"], ans2:1
      },
      {
        tipo:"Correo de biblioteca",
        text:`Ihre <strong>Ausleihe</strong>: ‚ÄûDie kleine Hexe‚Äú. Bitte bringen Sie das Buch bis Mittwoch zur√ºck. Die Bibliothek ist von 9‚Äì17 Uhr ge√∂ffnet.`,
        q1:"¬øHasta cu√°ndo se debe devolver el libro?",
        opts1:["Donnerstag","Mittwoch","Freitag"], ans1:1,
        q2:"¬øA qu√© hora abre la biblioteca?",
        opts2:["9 Uhr","8 Uhr","10 Uhr"], ans2:0
      },
      {
        tipo:"Mensaje del entrenador",
        text:`Hallo Team, das Training ist heute in der Sporthalle, nicht auf dem Platz. Bitte saubere Turnschuhe mitbringen.`,
        q1:"¬øD√≥nde es el entrenamiento?",
        opts1:["Auf dem Platz","In der Sporthalle","Im Park"], ans1:1,
        q2:"¬øQu√© deben traer?",
        opts2:["Fu√üballschuhe","Saubere Turnschuhe","Jacke"], ans2:1
      },
      {
        tipo:"Anuncio de cine",
        text:`Film ‚ÄûSternennacht‚Äú: Beginn 18:45 Uhr, Saal 3. Tickets nur online. <strong>Einlass</strong> ab 18:15 Uhr.`,
        q1:"¬øCu√°ndo empieza la pel√≠cula?",
        opts1:["18:15 Uhr","19:00 Uhr","18:45 Uhr"], ans1:2,
        q2:"¬øD√≥nde se compran los tickets?",
        opts2:["An der Kasse","Online","Im Laden"], ans2:1
      },
      {
        tipo:"Nota del profesor",
        text:`Morgen schreiben wir einen kurzen Test in Mathematik. Bitte bringt <strong>Taschenrechner</strong> und Lineal mit.`,
        q1:"¬øDe qu√© materia es la prueba?",
        opts1:["Deutsch","Mathematik","Englisch"], ans1:1,
        q2:"¬øQu√© deben traer?",
        opts2:["Zirkel","Taschenrechner und Lineal","W√∂rterbuch"], ans2:1
      },
      {
        tipo:"Correo de excursi√≥n",
        text:`Liebe Sch√ºler, wir treffen uns um 9:00 Uhr am Bahnhof. Denkt an eine Fahrkarte und Regenjacke.`,
        q1:"¬øD√≥nde se encuentran?",
        opts1:["Vor der Schule","Am Bahnhof","Im Bus"], ans1:1,
        q2:"¬øQu√© deben llevar?",
        opts2:["Sonnenbrille","Fahrkarte und Regenjacke","Badehose"], ans2:1
      },
      {
        tipo:"Aviso del supermercado",
        text:`Angebot: √Ñpfel 1,99 ‚Ç¨/kg, Bananen 1,49 ‚Ç¨/kg. Heute ge√∂ffnet bis 21 Uhr.`,
        q1:"¬øCu√°nto cuesta 1 kg de bananos?",
        opts1:["1,49 ‚Ç¨","1,99 ‚Ç¨","2,49 ‚Ç¨"], ans1:0,
        q2:"¬øHasta qu√© hora est√° abierto hoy?",
        opts2:["20 Uhr","21 Uhr","22 Uhr"], ans2:1
      },
      {
        tipo:"Mensaje de consulta m√©dica",
        text:`Ihr Termin: Mittwoch, 10:20 Uhr, <strong>Praxis</strong> Dr. Klein, Zimmer 2. Bitte 10 Minuten fr√ºher kommen.`,
        q1:"¬øCu√°ndo es la cita?",
        opts1:["Dienstag","Mittwoch","Donnerstag"], ans1:1,
        q2:"¬øQu√© se debe hacer?",
        opts2:["Llegar 10 minutos m√°s tarde","Llegar 10 minutos antes","Llegar exactamente 10:20"], ans2:1
      },
      {
        tipo:"Correo de biblioteca escolar",
        text:`Am Freitag ist B√ºchertausch in der Schulbibliothek. Bringt bitte un libro le√≠do y lleven uno nuevo.`,
        q1:"¬øD√≥nde es la actividad?",
        opts1:["In der Turnhalle","In der Schulbibliothek","Auf dem Schulhof"], ans1:1,
        q2:"¬øQu√© deben llevar?",
        opts2:["Eine Zeitschrift","Ein gelesenes Buch","Ein Heft"], ans2:1
      },
      {
        tipo:"Anuncio de transporte",
        text:`Wegen Bauarbeiten f√§hrt die <strong>Linie</strong> 5 heute nicht. Nutzen Sie bitte die Linie 3 oder den <strong>Ersatzbus</strong>.`,
        q1:"¬øQu√© l√≠nea no funciona hoy?",
        opts1:["Linie 3","Linie 5","Linie 7"], ans1:1,
        q2:"¬øQu√© se puede tomar en su lugar?",
        opts2:["Linie 9","Linie 3 oder Ersatzbus","Taxi"], ans2:1
      },
      {
        tipo:"Mensaje de clase de m√∫sica",
        text:`Bitte bringt morgen eure Fl√∂te und das <strong>Notenheft</strong> mit. Wir √ºben das Lied ‚ÄûGuten Morgen‚Äú.`,
        q1:"¬øQu√© se va a practicar?",
        opts1:["Das Lied ‚ÄûGuten Morgen‚Äú","Ein neues Gedicht","Ein Theaterst√ºck"], ans1:0,
        q2:"¬øQu√© deben traer?",
        opts2:["Gitarre","Fl√∂te und Notenheft","Kopfh√∂rer"], ans2:1
      },
      {
        tipo:"Correo de cumplea√±os",
        text:`Hallo Lara, yo festejo el s√°bado a las 16 Uhr en mi casa. Por favor trae algo para beber. ‚Äì Mia`,
        q1:"¬øA qu√© hora empieza la fiesta?",
        opts1:["15 Uhr","16 Uhr","17 Uhr"], ans1:1,
        q2:"¬øQu√© debe traer Lara?",
        opts2:["Kuchen","Etwas zu trinken","Luftballons"], ans2:1
      },
      {
        tipo:"Aviso del tiempo",
        text:`Wetter heute: Vormittags sonnig, nachmittags Regen. ¬°No olvides la chaqueta impermeable!`,
        q1:"¬øC√≥mo est√° el clima en la ma√±ana?",
        opts1:["Sonnig","Windig","Neblig"], ans1:0,
        q2:"¬øQu√© se espera en la tarde?",
        opts2:["Schnee","Regen","Sturm"], ans2:1
      }
    ];

    /* ========= Banco B) Verdadero/Falso (15) ========= */
    const VF = [
      {
        tipo:"Aviso del edificio",
        text:`Wegen Reinigung bleibt die Waschk√ºche am Montag von 9 bis 13 Uhr geschlossen.`,
        a1:"La lavander√≠a (Waschk√ºche) est√° cerrada el lunes en la ma√±ana.",
        a2:"La lavander√≠a abre a las 9 en punto.",
        a3:"La limpieza dura cuatro horas.",
        key:[true, false, true]
      },
      {
        tipo:"Anuncio escolar",
        text:`Der Schulhof ist wegen Bauarbeiten <strong>gesperrt</strong>. Der Eingang A bleibt offen.`,
        a1:"El patio escolar (Schulhof) est√° abierto.",
        a2:"Se puede usar la Entrada A.",
        a3:"Las obras han terminado.",
        key:[false, true, false]
      },
      {
        tipo:"Nota m√©dica",
        text:`Die <strong>Praxis</strong> ist heute nur bis 12 Uhr ge√∂ffnet. Recetas (Rezepte) desde las 10.`,
        a1:"El consultorio cierra al mediod√≠a.",
        a2:"Las recetas se entregan solo desde las 12.",
        a3:"Se pueden obtener recetas desde las 10.",
        key:[true, false, true]
      },
      {
        tipo:"Biblioteca",
        text:`<strong>R√ºckgabeautomat</strong>: abierto 24 horas. <strong>Beratung</strong> solo de 10‚Äì18 Uhr.`,
        a1:"La m√°quina de devoluci√≥n est√° siempre abierta.",
        a2:"La asesor√≠a es 24 horas.",
        a3:"La asesor√≠a termina a las 18.",
        key:[true, false, true]
      },
      {
        tipo:"Transporte",
        text:`El tren a Hamburgo <em>f√§llt aus</em> (no sale) hoy. Tome el tren de 10:15 a Bremen.`,
        a1:"El tren a Hamburgo hoy no sale.",
        a2:"Hay alternativa a las 10:15.",
        a3:"La alternativa va a Hamburgo.",
        key:[true, true, false]
      },
      {
        tipo:"Supermercado",
        text:`Caja 2 est√° cerrada. Por favor ir a Caja 3.`,
        a1:"Se puede usar la Caja 2.",
        a2:"La Caja 3 est√° abierta.",
        a3:"Todas las cajas est√°n cerradas.",
        key:[false, true, false]
      },
      {
        tipo:"Clase de deporte",
        text:`Hoy deporte al aire libre. Traer una chaqueta.`,
        a1:"Hoy el deporte es en el coliseo.",
        a2:"Se recomienda chaqueta.",
        a3:"La clase se cancela.",
        key:[false, true, false]
      },
      {
        tipo:"Piscina",
        text:`Piscina: D√≠a familiar el domingo. Ni√±os no pagan <strong>Eintritt</strong>.`,
        a1:"El domingo hay d√≠a familiar.",
        a2:"Los ni√±os deben pagar entrada.",
        a3:"La piscina est√° cerrada el domingo.",
        key:[true, false, false]
      },
      {
        tipo:"Restaurante",
        text:`Men√∫ de almuerzo de 11:30 a 14:30. Bebidas no incluidas.`,
        a1:"El men√∫ empieza a las 11:30.",
        a2:"Las bebidas est√°n incluidas.",
        a3:"El men√∫ termina a las 14:30.",
        key:[true, false, true]
      },
      {
        tipo:"Correo de profesor",
        text:`La prueba se <strong>verschoben</strong> (aplaza) para el viernes. Repetir el cap√≠tulo 3.`,
        a1:"La prueba es antes.",
        a2:"Se debe repasar el cap√≠tulo 3.",
        a3:"La prueba es el viernes.",
        key:[false, true, true]
      },
      {
        tipo:"M√©dico",
        text:`Por favor traer su <strong>Versicherungskarte</strong> y su <strong>Ausweis</strong> a la cita.`,
        a1:"Se necesita la tarjeta del seguro.",
        a2:"No es necesario documento de identidad.",
        a3:"Se trata de una cita.",
        key:[true, false, true]
      },
      {
        tipo:"Clima",
        text:`Ma√±ana <strong>Schneegefahr</strong> (riesgo de nieve). Los buses pueden salir tarde.`,
        a1:"Puede nevar ma√±ana.",
        a2:"Los buses saldr√°n puntuales con seguridad.",
        a3:"Son posibles retrasos.",
        key:[true, false, true]
      },
      {
        tipo:"Aula",
        text:`La clase hoy es en el sal√≥n 105, no en el 101.`,
        a1:"La clase es en el 101.",
        a2:"El sal√≥n correcto es 105.",
        a3:"La clase se cancela.",
        key:[false, true, false]
      },
      {
        tipo:"Entrega de tareas",
        text:`Subir la tarea hasta el domingo 20:00 en la plataforma.`,
        a1:"La entrega es el domingo.",
        a2:"La hora es 22:00.",
        a3:"La entrega es en l√≠nea.",
        key:[true, false, true]
      },
      {
        tipo:"Exposici√≥n escolar",
        text:`La exposici√≥n ‚ÄúNuestra ciudad‚Äù es el jueves en el <strong>Foyer</strong>. <strong>Eintritt</strong> gratis.`,
        a1:"La exposici√≥n es el jueves.",
        a2:"La entrada cuesta 5 euros.",
        a3:"La exposici√≥n es en el vest√≠bulo.",
        key:[true, false, true]
      }
    ];

    /* ========= Estado y elementos ========= */
    // Tabs
    const tabMini = byId('tab-mini'), tabVF = byId('tab-vf');
    const miniPanel = byId('mini-panel'), vfPanel = byId('vf-panel');

    // Mini-textos
    let miniIdx = 0, miniScore = 0, miniDone = Array(MINI.length).fill(false);
    const miniIcon = byId('mini-icon'), miniTipo = byId('mini-tipo'), miniProg = byId('mini-progress');
    const miniText = byId('mini-text');
    const miniQ1 = byId('mini-q1'), miniOpts1 = byId('mini-opts1'), miniFb1 = byId('mini-fb1');
    const miniQ2 = byId('mini-q2'), miniOpts2 = byId('mini-opts2'), miniFb2 = byId('mini-fb2');
    const miniCheck = byId('mini-check'), miniPrev = byId('mini-prev'), miniNext = byId('mini-next'),
          miniReset = byId('mini-reset'), miniScoreEl = byId('mini-score');

    // Verdadero/Falso
    let vfIdx = 0, vfScore = 0, vfDone = Array(VF.length).fill(false);
    const vfIcon = byId('vf-icon'), vfTipo = byId('vf-tipo'), vfProg = byId('vf-progress');
    const vfText = byId('vf-text');
    const a1 = byId('vf-a1'), a2 = byId('vf-a2'), a3 = byId('vf-a3');
    const vfFb1 = byId('vf-fb1'), vfFb2 = byId('vf-fb2'), vfFb3 = byId('vf-fb3');
    const vfCheck = byId('vf-check'), vfPrev = byId('vf-prev'), vfNext = byId('vf-next'),
          vfReset = byId('vf-reset'), vfScoreEl = byId('vf-score');

    /* ========= Render Mini-textos ========= */
    function renderMini(i){
      const m = MINI[i];
      // encabezado
      miniTipo.textContent = `[${m.tipo}]`;
      miniIcon.className = `fa-solid ${ICONS[m.tipo] || 'fa-file-lines'}`;
      miniProg.textContent = `${i+1} / ${MINI.length}`;
      // texto con glosario
      miniText.innerHTML = highlightGloss(m.text);
      attachGlossHandlers(miniText);

      // Pregunta 1
      miniQ1.innerHTML = `<strong>1.</strong> ${m.q1}`;
      miniOpts1.innerHTML = m.opts1.map((o, idx)=>(
        `<li><label><input type="radio" name="mini1" value="${idx}"> ${String.fromCharCode(97+idx)}) ${o}</label></li>`
      )).join('');
      miniFb1.textContent = '';

      // Pregunta 2
      miniQ2.innerHTML = `<strong>2.</strong> ${m.q2}`;
      miniOpts2.innerHTML = m.opts2.map((o, idx)=>(
        `<li><label><input type="radio" name="mini2" value="${idx}"> ${String.fromCharCode(97+idx)}) ${o}</label></li>`
      )).join('');
      miniFb2.textContent = '';

      miniScoreEl.textContent = `Puntaje: ${miniScore} / ${MINI.length*2}`;
    }
    function checkMini(){
      const m = MINI[miniIdx];
      let add = 0;

      const pick1 = document.querySelector('input[name="mini1"]:checked');
      if (!pick1){ miniFb1.textContent = 'Elige una opci√≥n.'; miniFb1.className='bad'; }
      else if (+pick1.value === m.ans1){ miniFb1.textContent = '¬°Correcto!'; miniFb1.className='ok'; add++; }
      else { miniFb1.textContent = `Incorrecto. Respuesta: ${String.fromCharCode(97+m.ans1)}) ${m.opts1[m.ans1]}`; miniFb1.className='bad'; }

      const pick2 = document.querySelector('input[name="mini2"]:checked');
      if (!pick2){ miniFb2.textContent = 'Elige una opci√≥n.'; miniFb2.className='bad'; }
      else if (+pick2.value === m.ans2){ miniFb2.textContent = '¬°Correcto!'; miniFb2.className='ok'; add++; }
      else { miniFb2.textContent = `Incorrecto. Respuesta: ${String.fromCharCode(97+m.ans2)}) ${m.opts2[m.ans2]}`; miniFb2.className='bad'; }

      if (!miniDone[miniIdx]) { miniScore += add; miniDone[miniIdx] = true; }
      miniScoreEl.textContent = `Puntaje: ${miniScore} / ${MINI.length*2}`;
    }

    /* ========= Render Verdadero/Falso ========= */
    function renderVF(i){
      const v = VF[i];
      vfTipo.textContent = `[${v.tipo}]`;
      vfIcon.className = `fa-solid ${ICONS[v.tipo] || 'fa-circle-info'}`;
      vfProg.textContent = `${i+1} / ${VF.length}`;
      vfText.innerHTML = highlightGloss(v.text);
      attachGlossHandlers(vfText);
      a1.innerHTML = v.a1; a2.innerHTML = v.a2; a3.innerHTML = v.a3;
      // limpiar selecciones
      ['vf1','vf2','vf3'].forEach(n => document.querySelectorAll(`input[name="${n}"]`).forEach(r=> r.checked=false));
      vfFb1.textContent = vfFb2.textContent = vfFb3.textContent = '';
      vfScoreEl.textContent = `Puntaje: ${vfScore} / ${VF.length*3}`;
    }
    function checkVF(){
      const v = VF[vfIdx];
      let add = 0;
      const c1 = document.querySelector('input[name="vf1"]:checked');
      const c2 = document.querySelector('input[name="vf2"]:checked');
      const c3 = document.querySelector('input[name="vf3"]:checked');

      if (!c1){ vfFb1.textContent = 'Selecciona una opci√≥n.'; vfFb1.className='bad'; }
      else if ((c1.value==='true') === v.key[0]){ vfFb1.textContent='¬°Correcto!'; vfFb1.className='ok'; add++; }
      else { vfFb1.textContent = `Incorrecto. Es ${v.key[0] ? 'Wahr' : 'Falsch'}.`; vfFb1.className='bad'; }

      if (!c2){ vfFb2.textContent = 'Selecciona una opci√≥n.'; vfFb2.className='bad'; }
      else if ((c2.value==='true') === v.key[1]){ vfFb2.textContent='¬°Correcto!'; vfFb2.className='ok'; add++; }
      else { vfFb2.textContent = `Incorrecto. Es ${v.key[1] ? 'Wahr' : 'Falsch'}.`; vfFb2.className='bad'; }

      if (!c3){ vfFb3.textContent = 'Selecciona una opci√≥n.'; vfFb3.className='bad'; }
      else if ((c3.value==='true') === v.key[2]){ vfFb3.textContent='¬°Correcto!'; vfFb3.className='ok'; add++; }
      else { vfFb3.textContent = `Incorrecto. Es ${v.key[2] ? 'Wahr' : 'Falsch'}.`; vfFb3.className='bad'; }

      if (!vfDone[vfIdx]) { vfScore += add; vfDone[vfIdx] = true; }
      vfScoreEl.textContent = `Puntaje: ${vfScore} / ${VF.length*3}`;
    }

    /* ========= Eventos ========= */
    // Tabs
    tabMini.addEventListener('click', ()=>{
      tabMini.classList.add('active'); tabVF.classList.remove('active');
      miniPanel.style.display='block'; vfPanel.style.display='none';
      window.scrollTo({top: miniPanel.getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'});
    });
    tabVF.addEventListener('click', ()=>{
      tabVF.classList.add('active'); tabMini.classList.remove('active');
      vfPanel.style.display='block'; miniPanel.style.display='none';
      window.scrollTo({top: vfPanel.getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'});
    });

    // Mini
    miniCheck.addEventListener('click', checkMini);
    miniPrev.addEventListener('click', ()=>{ miniIdx = (miniIdx - 1 + MINI.length) % MINI.length; renderMini(miniIdx); });
    miniNext.addEventListener('click', ()=>{ miniIdx = (miniIdx + 1) % MINI.length; renderMini(miniIdx); });
    miniReset.addEventListener('click', ()=>{
      miniScore = 0; miniDone = Array(MINI.length).fill(false); renderMini(miniIdx=0);
    });

    // VF
    vfCheck.addEventListener('click', checkVF);
    vfPrev.addEventListener('click', ()=>{ vfIdx = (vfIdx - 1 + VF.length) % VF.length; renderVF(vfIdx); });
    vfNext.addEventListener('click', ()=>{ vfIdx = (vfIdx + 1) % VF.length; renderVF(vfIdx); });
    vfReset.addEventListener('click', ()=>{
      vfScore = 0; vfDone = Array(VF.length).fill(false); renderVF(vfIdx=0);
    });

    /* ========= Inicializaci√≥n ========= */
    // Render primeros √≠tems
    renderMini(0);
    renderVF(0);

    // Activar glosario en texto introductorio
    attachGlossHandlers(document.getElementById('lesen'));
  })();
  </script>
</section>


<!-- REDEMITTEL (EXTENDIDO) -->
<section id="redemittel" class="contenido-oculto">
  <style>
    /* ===== Estilos locales para Redemittel ===== */
    .hint {
      background: rgba(255,255,255,.85);
      border-left: 5px solid var(--blue);
      padding: .9rem 1rem; border-radius: 10px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .rdm-wrap { display:flex; flex-direction:column; gap:1rem; }
    .rdm-card {
      background: rgba(255,255,255,.92); border-radius: 14px; padding: 1rem;
      box-shadow: 0 6px 18px var(--shadow);
    }
    .title-row { display:flex; align-items:center; gap:.6rem; margin-bottom:.5rem; }
    .title-row i { opacity:.9; }
    .dialog {
      background: linear-gradient(180deg, #ffffff 0%, #f7fbff 100%);
      border: 2px dashed var(--blue); border-radius: 12px; padding:.8rem; margin:.6rem 0;
    }
    .bubble { margin:.25rem 0; }
    .bubble strong { color: var(--blue); }
    .opts { list-style:none; padding:0; margin:.5rem 0; }
    .opts li { margin:.35rem 0; }
    .opts label { display:flex; align-items:flex-start; gap:.55rem; cursor:pointer; }
    .controls { display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; margin-top:.6rem; }
    .score { font-weight:700; }
    .ok { color:#1a7f37; }
    .bad { color:#b1002e; }
    .muted { opacity:.88; }

    /* Mini flashcards (opcional, solo √≠conos) */
    .flashcard-container { display:flex; flex-wrap:wrap; gap:.7rem; }
    .flashcard {
      background:#fff; border:2px solid var(--amber); border-radius:12px; width:122px; height:122px;
      display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; cursor:pointer;
      box-shadow:0 3px 10px rgba(0,0,0,.08);
      transition: transform .12s ease-in;
    }
    .flashcard:active { transform: scale(.97); }
    .flashcard i { font-size:2rem; color: var(--coral); }
    .flashcard .word { position:absolute; bottom:.5rem; left:0; right:0; text-align:center; font-weight:700; font-size:.9rem; display:none; }
    .flashcard.show .word { display:block; }

    /* Modal glosario local (ID √∫nico para esta secci√≥n) */
    .modal-rdm { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.45); z-index:9999; }
    .modal-rdm.hidden { display:none; }
    .modal-box {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; width:min(460px, calc(100% - 2rem));
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .modal-box h4 { margin:0 0 .3rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    /* Palabras dif√≠ciles clicables */
    .gloss { border-bottom:2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }

    /* Responsivo m√≥vil */
    @media (max-width:600px){
      .rdm-card { padding:.9rem; }
      .opts li { margin:.25rem 0; }
      .flashcard { width:108px; height:108px; }
    }
  </style>

  <h2>Redemittel ‚Äì Expresiones √∫tiles</h2>
  <p class="hint">
    üéØ Objetivo: memorizar y usar frases cortas en situaciones reales del nivel <strong>A1/A2</strong> (panader√≠a, bus, restaurante, etc.).  
    Lee el <strong>di√°logo</strong> en alem√°n y <strong>elige</strong> la frase que falta (alem√°n muy sencillo).  
    Funciona en celular, tablet y computador. Las <span class="gloss" data-term="palabras dif√≠ciles">palabras dif√≠ciles</span> aparecen subrayadas: t√≥cala para ver el significado en espa√±ol.
  </p>

  <!-- Mini Redemittel por √≠conos (opcional, solo internos/√≠conos) -->
  <h3><i class="fa-solid fa-wand-magic-sparkles"></i> Tarjetas r√°pidas (toca para ver la frase)</h3>
  <div class="flashcard-container">
    <div class="flashcard" onclick="this.classList.toggle('show')">
      <i class="fa-solid fa-bread-slice"></i>
      <span class="word">Ich h√§tte gern zwei Br√∂tchen, bitte.</span>
    </div>
    <div class="flashcard" onclick="this.classList.toggle('show')">
      <i class="fa-solid fa-mug-hot"></i>
      <span class="word">Ein Cappuccino ohne Zucker, bitte.</span>
    </div>
    <div class="flashcard" onclick="this.classList.toggle('show')">
      <i class="fa-solid fa-bus"></i>
      <span class="word">F√§hrt dieser Bus zum Bahnhof?</span>
    </div>
  </div>

  <article class="rdm-wrap">
    <div class="rdm-card" id="rdm-panel">
      <div class="title-row">
        <i id="rdm-icon" class="fa-solid fa-comments"></i>
        <strong id="rdm-sit">[Situaci√≥n]</strong>
        <span class="muted" id="rdm-progress">1 / 20</span>
      </div>

      <div class="dialog" id="rdm-dialog">
        <p class="bubble"><strong>A:</strong> <span id="rdm-a"></span></p>
        <p class="bubble"><strong>B:</strong> <em>_____</em></p>
      </div>

      <ul id="rdm-opts" class="opts"></ul>
      <p id="rdm-feedback"></p>

      <div class="controls">
        <button class="btn-submit" id="rdm-check" type="button">Comprobar</button>
        <button class="btn-ghost" id="rdm-prev" type="button">‚üµ Anterior</button>
        <button class="btn-ghost" id="rdm-next" type="button">Siguiente ‚ü∂</button>
        <button class="btn-ghost" id="rdm-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
        <span id="rdm-score" class="score"></span>
      </div>
    </div>
  </article>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <!-- Modal de glosario (√∫nico para esta secci√≥n) -->
  <div id="gloss-modal-rdm" class="modal-rdm hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term-rdm" aria-describedby="gloss-def-rdm">
    <div class="modal-box">
      <button id="gloss-close-rdm" class="modal-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term-rdm">T√©rmino</h4>
      <p id="gloss-def-rdm">Definici√≥n en espa√±ol</p>
    </div>
  </div>

  <script>
  (function(){
    /* ========= Glosario (palabras dif√≠ciles) ========= */
    const GLOSS = {
      "ohne":"sin.",
      "Linie":"l√≠nea (de bus/metro).",
      "Tropfen":"gotas (medicina).",
      "Husten":"tos.",
      "Gleis":"and√©n/v√≠a (tren).",
      "Rechnung":"cuenta/factura en el restaurante.",
      "Hausaufgaben":"tareas (del colegio).",
      "Heft":"cuaderno.",
      "ausleihen":"tomar prestado.",
      "Bibliotheksausweis":"carn√© de biblioteca.",
      "anprobieren":"probarse (ropa).",
      "Umkleiden":"probadores/vestidores.",
      "Termin":"cita (m√©dica, etc.).",
      "reserviert":"reservado.",
      "versichert":"asegurado (env√≠o).",
      "Angebot":"oferta/promo.",
      "kabelgebunden":"con cable.",
      "Bluetooth":"conexi√≥n inal√°mbrica Bluetooth.",
      "Geradeaus":"todo recto.",
      "Ecke":"esquina.",
      "grillen":"hacer asado/parrillada.",
      "Verein":"club/asociaci√≥n.",
      "Formular":"formulario.",
      "verloren":"perdido.",
      "Einzelzimmer":"habitaci√≥n individual.",
      "Karten":"boletas/entradas."
    };

    /* ========= Utilidades ========= */
    const byId = id => document.getElementById(id);
    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
    // resalta t√©rminos con span.gloss (case-sensitive para alem√°n simple)
    function highlightGloss(text){
      const keys = Object.keys(GLOSS).sort((a,b)=>b.length-a.length);
      let out = text;
      keys.forEach(k=>{
        const rx = new RegExp(`\\b${escapeRegExp(k)}\\b`,'g');
        out = out.replace(rx, `<span class="gloss" data-term="${k}">${k}</span>`);
      });
      return out;
    }
    function attachGlossHandlers(scope){
      scope.querySelectorAll('.gloss').forEach(el=>{
        el.addEventListener('click', ()=> showGloss(el.dataset.term));
      });
    }
    function showGloss(term){
      const modal = byId('gloss-modal-rdm');
      byId('gloss-term-rdm').textContent = term;
      byId('gloss-def-rdm').textContent = GLOSS[term] || 'Sin definici√≥n registrada.';
      modal.classList.remove('hidden');
    }
    byId('gloss-close-rdm').addEventListener('click', ()=> byId('gloss-modal-rdm').classList.add('hidden'));

    /* ========= Banco de ejercicios (20 di√°logos) ========= */
    const ICON = {
      "Panader√≠a":"fa-bread-slice",
      "Cafeter√≠a":"fa-mug-hot",
      "Parada de bus":"fa-bus",
      "Farmacia":"fa-prescription-bottle-medical",
      "Estaci√≥n de tren":"fa-train",
      "Restaurante (pedido)":"fa-utensils",
      "Restaurante (cuenta)":"fa-receipt",
      "Escuela (tarea)":"fa-book-open",
      "Biblioteca":"fa-book",
      "Tienda de ropa":"fa-shirt",
      "Consulta m√©dica (cita)":"fa-user-doctor",
      "Hotel (check-in)":"fa-bed",
      "Oficina de correos":"fa-box",
      "Supermercado (precio)":"fa-basket-shopping",
      "Tienda de electr√≥nica":"fa-headphones",
      "Calle (direcciones)":"fa-location-arrow",
      "Invitaci√≥n":"fa-burger",
      "Club deportivo (inscripci√≥n)":"fa-dumbbell",
      "Objetos perdidos":"fa-magnifying-glass",
      "Taquilla de cine":"fa-ticket"
    };

    const RDM = [
      {sit:"Panader√≠a", a:"Guten Morgen! Was m√∂chten Sie?", opts:["Ich h√§tte gern zwei Br√∂tchen, bitte.","Ich wohne im zweiten Stock.","Der Bus kommt um 8 Uhr."], ans:0},
      {sit:"Cafeter√≠a", a:"M√∂chten Sie etwas trinken?", opts:["Ja, ein Cappuccino ohne Zucker, bitte.","Ich trage Gr√∂√üe M.","Der Zug ist p√ºnktlich."], ans:0},
      {sit:"Parada de bus", a:"Entschuldigung, f√§hrt dieser Bus zum Bahnhof?", opts:["Ja, Linie 7 f√§hrt direkt dorthin.","Ich brauche Kopfschmerztabletten.","Zwei Karten f√ºr den Film, bitte."], ans:0},
      {sit:"Farmacia", a:"Guten Tag, was fehlt Ihnen?", opts:["Ich suche Tropfen gegen Husten.","Ich m√∂chte die Jacke anprobieren.","Wir treffen uns am Gleis 3."], ans:0},
      {sit:"Estaci√≥n de tren", a:"Wann f√§hrt der Zug nach K√∂ln?", opts:["Um 10:45 Uhr von Gleis 2.","Ich esse lieber Pasta.","Ich wohne in K√∂ln."], ans:0},
      {sit:"Restaurante (pedido)", a:"Sind Sie bereit zu bestellen?", opts:["Ja, ich nehme die Tomatensuppe.","Wo ist die Umkleidekabine?","Die Klassenarbeit ist morgen."], ans:0},
      {sit:"Restaurante (cuenta)", a:"Hat es Ihnen geschmeckt?", opts:["Ja, sehr. K√∂nnten wir bitte die Rechnung bekommen?","Das T-Shirt ist zu klein.","Ich brauche eine Monatskarte."], ans:0},
      {sit:"Escuela (tarea)", a:"Hast du die Hausaufgaben dabei?", opts:["Ja, hier im Heft.","Zwei Br√∂tchen, bitte.","Der Film beginnt sp√§ter."], ans:0},
      {sit:"Biblioteca", a:"Guten Tag, kann ich dieses Buch ausleihen?", opts:["Ja, f√ºr zwei Wochen mit Bibliotheksausweis.","Der Bus f√§hrt alle zehn Minuten.","Ich h√§tte gern eine Suppe."], ans:0},
      {sit:"Tienda de ropa", a:"Kann ich diese Jacke anprobieren?", opts:["Ja, die Umkleiden sind dort links.","Der Zug hat Versp√§tung.","Ich buche ein Doppelzimmer."], ans:0},
      {sit:"Consulta m√©dica (cita)", a:"Haben Sie einen Termin?", opts:["Ja, um 11 Uhr bei Frau Dr. Meyer.","Ich suche den Kassenbon.","Die Mathepr√ºfung ist heute."], ans:0},
      {sit:"Hotel (check-in)", a:"Guten Abend, haben Sie reserviert?", opts:["Ja, auf den Namen Schneider, f√ºr zwei N√§chte.","Eine Fahrkarte nach Bremen, bitte.","Ich brauche ein Ladeger√§t."], ans:0},
      {sit:"Oficina de correos", a:"Wohin m√∂chten Sie das Paket schicken?", opts:["Nach M√ºnchen, bitte versichert.","Ich nehme Gr√∂√üe 42.","Der Unterricht f√§llt aus."], ans:0},
      {sit:"Supermercado (precio)", a:"Entschuldigung, was kostet dieses Brot?", opts:["2,49 Euro, das ist im Angebot.","Der Film l√§uft um 19 Uhr.","Ich wohne im dritten Stock."], ans:0},
      {sit:"Tienda de electr√≥nica", a:"Haben Sie Kopfh√∂rer mit Mikrofon?", opts:["Ja, hier. M√∂chten Sie kabelgebunden oder Bluetooth?","Ich suche eine Haltestelle.","Ich nehme die Tomatensuppe."], ans:0},
      {sit:"Calle (direcciones)", a:"Entschuldigung, wo ist die Bibliothek?", opts:["Geradeaus und an der Ecke rechts.","Zwei Fahrkarten nach Hamburg.","Ich h√§tte gern ein Wasser."], ans:0},
      {sit:"Invitaci√≥n", a:"Hast du am Samstag Zeit? Wir grillen im Garten.", opts:["Ja, gern! Um wie viel Uhr soll ich kommen?","Der Bus f√§hrt nicht.","Ich brauche eine Quittung."], ans:0},
      {sit:"Club deportivo (inscripci√≥n)", a:"M√∂chten Sie dem Verein beitreten?", opts:["Ja, wo kann ich das Formular ausf√ºllen?","Ich kaufe Obst und Gem√ºse.","Der Film ist spannend."], ans:0},
      {sit:"Objetos perdidos", a:"Was haben Sie verloren?", opts:["Meinen schwarzen Rucksack mit Sportkleidung.","Ich nehme ein Einzelzimmer.","Ich esse kein Fleisch."], ans:0},
      {sit:"Taquilla de cine", a:"F√ºr welchen Film m√∂chten Sie Tickets?", opts:["F√ºr ‚ÄûSternennacht‚Äú, zwei Karten f√ºr 18:30 Uhr.","Ich wohne bei meinen Eltern.","Der Zug f√§hrt vom Gleis 5."], ans:0}
    ];

    /* ========= Elementos ========= */
    const iconEl = byId('rdm-icon');
    const sitEl = byId('rdm-sit');
    const progEl = byId('rdm-progress');
    const aEl = byId('rdm-a');
    const optsEl = byId('rdm-opts');
    const fbEl = byId('rdm-feedback');
    const scoreEl = byId('rdm-score');

    const btnCheck = byId('rdm-check');
    const btnPrev = byId('rdm-prev');
    const btnNext = byId('rdm-next');
    const btnReset = byId('rdm-reset');

    let idx = 0, score = 0, done = Array(RDM.length).fill(false);

    /* ========= Render ========= */
    function render(i){
      const item = RDM[i];
      iconEl.className = `fa-solid ${ICON[item.sit] || 'fa-comments'}`;
      sitEl.textContent = `[${item.sit}]`;
      progEl.textContent = `${i+1} / ${RDM.length}`;
      // A: con glosario
      aEl.innerHTML = highlightGloss(item.a);
      attachGlossHandlers(byId('rdm-dialog'));

      // Opciones
      optsEl.innerHTML = '';
      item.opts.forEach((o, k)=>{
        const id = `rdm_${i}_${k}`;
        const li = document.createElement('li');
        li.innerHTML = `
          <label for="${id}">
            <input type="radio" id="${id}" name="rdm_opt" value="${k}">
            ${String.fromCharCode(97+k)}) ${highlightGloss(o)}
          </label>`;
        optsEl.appendChild(li);
      });
      attachGlossHandlers(optsEl);
      fbEl.textContent = '';
      scoreEl.textContent = `Puntaje: ${score} / ${RDM.length}`;
    }

    function check(){
      const pick = document.querySelector('input[name="rdm_opt"]:checked');
      if(!pick){ fbEl.textContent='Selecciona una opci√≥n.'; fbEl.className='bad'; return; }
      const correct = (+pick.value === RDM[idx].ans);
      if (correct){
        fbEl.textContent='¬°Correcto!'; fbEl.className='ok';
        if (!done[idx]){ score++; done[idx] = true; }
      } else {
        const ans = RDM[idx].ans;
        fbEl.textContent=`Incorrecto. Respuesta: ${String.fromCharCode(97+ans)}) ${RDM[idx].opts[ans]}`;
        fbEl.className='bad';
        done[idx] = true; // se considera contestada
      }
      scoreEl.textContent = `Puntaje: ${score} / ${RDM.length}`;
    }

    /* ========= Eventos ========= */
    btnCheck.addEventListener('click', check);
    btnPrev.addEventListener('click', ()=>{ idx = (idx - 1 + RDM.length) % RDM.length; render(idx); });
    btnNext.addEventListener('click', ()=>{ idx = (idx + 1) % RDM.length; render(idx); });
    btnReset.addEventListener('click', ()=>{
      idx = 0; score = 0; done = Array(RDM.length).fill(false); render(idx);
    });

    /* ========= Init ========= */
    // activar glosario tambi√©n en p√°rrafo introductorio
    attachGlossHandlers(document.getElementById('redemittel'));
    render(0);
  })();
  </script>
</section>


<!-- QUIZ-MODUS (EXTENDIDO) -->
<section id="quiz" class="contenido-oculto">
  <style>
    /* ===== Estilos locales para Quiz-Modus ===== */
    .hint {
      background: rgba(255,255,255,.9);
      border-left: 5px solid var(--blue);
      padding: .9rem 1rem; border-radius: 10px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .quiz-tabs { display:flex; gap:.6rem; flex-wrap:wrap; margin:.4rem 0 1rem; }
    .quiz-tab {
      border:2px solid var(--blue); background:#fff; color:var(--text);
      padding:.5rem .9rem; border-radius: 999px; cursor:pointer; font-weight:700;
      display:flex; align-items:center; gap:.5rem;
    }
    .quiz-tab.active { background: var(--blue); color:#fff; }

    .quiz-card {
      background: rgba(255,255,255,.94); border-radius: 14px; padding: 1rem;
      box-shadow: 0 6px 18px var(--shadow);
    }
    .title-row { display:flex; align-items:center; gap:.6rem; margin-bottom:.6rem; }
    .title-row i { opacity:.9; }

    /* Opciones */
    .opts { list-style:none; padding:0; margin:.6rem 0; }
    .opts li { margin:.35rem 0; }
    .opts label { display:flex; align-items:flex-start; gap:.55rem; cursor:pointer; }

    /* Controles */
    .controls { display:flex; gap:.6rem; flex-wrap:wrap; align-items:center; margin-top:.6rem; }
    .score { font-weight:700; }
    .ok { color:#1a7f37; }
    .bad { color:#b1002e; }
    .muted { opacity:.85; }

    /* Temporizador */
    .timer-row { display:flex; align-items:center; gap:.6rem; }
    .timer { font-weight:800; min-width: 3ch; text-align:right; }
    .bar {
      position:relative; flex:1; height:10px; background:#e8eefb; border-radius:999px; overflow:hidden;
    }
    .bar > span {
      position:absolute; left:0; top:0; bottom:0; width:100%;
      background: linear-gradient(90deg, var(--grass), var(--amber));
      transition: width .2s linear;
    }

    /* Eliminaci√≥n progresiva */
    .elim-prompt { margin:.5rem 0 .7rem; }
    .elim-opts { display:flex; flex-wrap:wrap; gap:.5rem; }
    .elim-btn {
      border:2px solid var(--coral); background:#fff; border-radius: 999px; padding:.45rem .8rem; font-weight:700; cursor:pointer;
    }
    .elim-btn[disabled] { opacity:.45; text-decoration: line-through; cursor:not-allowed; }
    .elim-hint { margin-top:.5rem; font-size:.95rem; }

    /* Modal glosario exclusivo de esta secci√≥n */
    .modal-quiz { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.45); z-index:9999; }
    .modal-quiz.hidden { display:none; }
    .modal-box {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; width:min(460px, calc(100% - 2rem));
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .modal-box h4 { margin:0 0 .3rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    /* Palabras dif√≠ciles clicables */
    .gloss { border-bottom:2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }

    /* Responsivo m√≥vil */
    @media (max-width:600px){
      .quiz-card { padding:.9rem; }
      .opts li { margin:.25rem 0; }
    }
  </style>

  <h2>Quiz-Modus</h2>
  <p class="hint">
    üéØ Objetivo: repasar <strong>vocabulario, gram√°tica y frases</strong> con juegos r√°pidos (nivel A2).  
    Lee las instrucciones en <strong>espa√±ol</strong> y responde en <strong>alem√°n</strong>.  
    Funciona en celular, tablet y computador. Las <span class="gloss" data-term="palabras dif√≠ciles">palabras dif√≠ciles</span> est√°n subrayadas: t√≥cala para ver su significado en espa√±ol.
  </p>

  <div class="quiz-tabs" role="tablist">
    <button class="quiz-tab active" id="tab-trivia" type="button"><i class="fa-solid fa-bolt"></i> Trivia (Tiempo)</button>
    <button class="quiz-tab" id="tab-vf" type="button"><i class="fa-solid fa-check-double"></i> Wahr/Falsch</button>
    <button class="quiz-tab" id="tab-elim" type="button"><i class="fa-solid fa-filter-circle-xmark"></i> Eliminaci√≥n</button>
  </div>

  <!-- A) TRIVIA CON TIEMPO -->
  <div id="panel-trivia" class="quiz-card" role="tabpanel" aria-labelledby="tab-trivia">
    <div class="title-row">
      <i class="fa-solid fa-hourglass-half"></i>
      <strong>Trivia de opci√≥n m√∫ltiple</strong>
      <span class="muted" id="trivia-progress">1 / 10</span>
    </div>
    <p class="muted">‚è±Ô∏è Tienes <strong>15 segundos</strong> por pregunta. Si se acaba el tiempo, pasas a la siguiente.</p>

    <div class="timer-row">
      <span class="timer" id="trivia-time">15</span>
      <div class="bar"><span id="trivia-bar"></span></div>
    </div>

    <div id="trivia-q" style="margin:.8rem 0 .4rem;"></div>
    <ul id="trivia-opts" class="opts"></ul>
    <p id="trivia-fb"></p>

    <div class="controls">
      <button class="btn-submit" id="trivia-submit" type="button">Responder</button>
      <button class="btn-ghost" id="trivia-next" type="button">Siguiente ‚ü∂</button>
      <button class="btn-ghost" id="trivia-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
      <span id="trivia-score" class="score"></span>
    </div>
  </div>

  <!-- B) VERDADERO / FALSO -->
  <div id="panel-vf" class="quiz-card" role="tabpanel" aria-labelledby="tab-vf" style="display:none;">
    <div class="title-row">
      <i class="fa-solid fa-list-ol"></i>
      <strong>Wahr / Falsch (aleatorio)</strong>
      <span class="muted" id="vf-progress">1 / 10</span>
    </div>
    <div id="vf-statement" style="margin:.6rem 0 .4rem;"></div>
    <ul class="opts">
      <li><label><input type="radio" name="vfAns" value="true"> Wahr</label></li>
      <li><label><input type="radio" name="vfAns" value="false"> Falsch</label></li>
    </ul>
    <p id="vf-fb"></p>
    <div class="controls">
      <button class="btn-submit" id="vf-submit" type="button">Responder</button>
      <button class="btn-ghost" id="vf-next" type="button">Siguiente ‚ü∂</button>
      <button class="btn-ghost" id="vf-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
      <span id="vf-score" class="score"></span>
    </div>
  </div>

  <!-- C) ELIMINACI√ìN PROGRESIVA -->
  <div id="panel-elim" class="quiz-card" role="tabpanel" aria-labelledby="tab-elim" style="display:none;">
    <div class="title-row">
      <i class="fa-solid fa-stairs"></i>
      <strong>Eliminaci√≥n progresiva</strong>
      <span class="muted" id="elim-progress">1 / 10</span>
    </div>
    <p class="muted">Si fallas, la opci√≥n se <strong>elimina</strong>. Avanzas al siguiente √≠tem cuando aciertas.</p>

    <div class="elim-prompt" id="elim-prompt"></div>
    <div class="elim-opts" id="elim-opts"></div>
    <p class="elim-hint" id="elim-hint"></p>
    <p id="elim-fb"></p>

    <div class="controls">
      <button class="btn-ghost" id="elim-reset" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
      <span id="elim-score" class="score"></span>
    </div>
  </div>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <!-- Modal de glosario (√∫nico para esta secci√≥n) -->
  <div id="gloss-modal-quiz" class="modal-quiz hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term-quiz" aria-describedby="gloss-def-quiz">
    <div class="modal-box">
      <button id="gloss-close-quiz" class="modal-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term-quiz">T√©rmino</h4>
      <p id="gloss-def-quiz">Definici√≥n en espa√±ol</p>
    </div>
  </div>

  <script>
  (function(){
    /* ========= Glosario (palabras dif√≠ciles) ========= */
    const GLOSS = {
      "Versp√§tung":"retraso, demora.",
      "Haltestelle":"parada (de bus).",
      "Erdgeschoss":"planta baja.",
      "Gleis":"and√©n/v√≠a (del tren).",
      "Angebot":"oferta/promoci√≥n.",
      "au√üer Betrieb":"fuera de servicio.",
      "Eintritt":"entrada/costo de entrada.",
      "Bluetooth":"conexi√≥n inal√°mbrica Bluetooth."
    };
    const byId = id => document.getElementById(id);
    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
    function highlightGloss(text){
      const keys = Object.keys(GLOSS).sort((a,b)=>b.length-a.length);
      let out = text;
      keys.forEach(k=>{
        const rx = new RegExp(`\\b${escapeRegExp(k)}\\b`,'g');
        out = out.replace(rx, `<span class="gloss" data-term="${k}">${k}</span>`);
      });
      return out;
    }
    function attachGlossHandlers(scope){
      scope.querySelectorAll('.gloss').forEach(el=>{
        el.addEventListener('click', ()=> showGloss(el.dataset.term));
      });
    }
    function showGloss(term){
      const modal = byId('gloss-modal-quiz');
      byId('gloss-term-quiz').textContent = term;
      byId('gloss-def-quiz').textContent = GLOSS[term] || 'Sin definici√≥n registrada.';
      modal.classList.remove('hidden');
    }
    byId('gloss-close-quiz').addEventListener('click', ()=> byId('gloss-modal-quiz').classList.add('hidden'));

    /* ========= Banco A) Trivia (10) ========= */
    const TRIVIA = [
      {q:"Wie viel kostet das Ticket? ‚Äì Es kostet ___ Euro.", opts:["f√ºnf","f√ºnfen","f√ºnfer"], ans:0},
      {q:"Morgen ___ wir keine Schule.", opts:["haben","ist","sind"], ans:0},
      {q:"Ich gehe heute ___ Kino.", opts:["im","ins","in der"], ans:1},
      {q:"Er ___ jeden Tag um 6 Uhr auf.", opts:["steht","stehen","stehst"], ans:0},
      {q:"Wir fahren am Wochenende ___ Berlin.", opts:["nach","in","zu"], ans:0},
      {q:"Ich nehme ___ Apfel und ein Wasser.", opts:["der","den","dem"], ans:1},
      {q:"Gestern ___ es sehr kalt.", opts:["ist","war","waren"], ans:1},
      {q:"Das ist die Tasche ___ Schwester.", opts:["meines","meiner","meinem"], ans:1},
      {q:"Ich warte ___ den Bus.", opts:["auf","an","mit"], ans:0},
      {q:"Entschuldigung, wo ist ___ Toilette?", opts:["der","die","das"], ans:1}
    ];

    /* ========= Banco B) Wahr/Falsch (10) ========= */
    const VF = [
      {t:"‚ÄúIch habe Hunger.‚Äù bedeutet: Ich m√∂chte essen.", key:true},
      {t:"‚ÄúDer Zug hat Versp√§tung.‚Äù bedeutet: Der Zug kommt fr√ºher.", key:false},
      {t:"‚ÄúDie Haltestelle ist da vorne.‚Äù bedeutet: Der Bus h√§lt in der N√§he.", key:true},
      {t:"‚ÄúIch gehe zu Fu√ü.‚Äù bedeutet: Ich fahre mit dem Auto.", key:false},
      {t:"‚ÄúIch h√§tte gern ein Wasser.‚Äù ist eine h√∂fliche Bestellung.", key:true},
      {t:"‚ÄúDer Aufzug ist au√üer Betrieb.‚Äù bedeutet: Der Aufzug funktioniert.", key:false},
      {t:"‚ÄúIch bin krank.‚Äù bedeutet: Ich f√ºhle mich nicht gut.", key:true},
      {t:"‚ÄúHeute f√§llt der Unterricht aus.‚Äù bedeutet: Kein Unterricht heute.", key:true},
      {t:"‚ÄúDie Kasse ist geschlossen.‚Äù bedeutet: Man kann dort bezahlen.", key:false},
      {t:"‚ÄúIch wohne im zweiten Stock.‚Äù bedeutet: Ich wohne im Erdgeschoss.", key:false}
    ];

    /* ========= Banco C) Eliminaci√≥n (10) ========= */
    const ELIM = [
      {p:"Welche Pr√§position passt? ‚Äì Ich warte ___ den Bus.", opts:["auf","an","mit","bei"], ans:0, hint:"'auf + Akk.' con 'warten'."},
      {p:"Welcher Artikel ist richtig? ‚Äì Ich suche ___ B√§ckerei.", opts:["die","der","das","den"], ans:0, hint:"'die B√§ckerei' (femenino)."},
      {p:"Welche Form ist richtig? ‚Äì Er ___ heute zu Hause.", opts:["ist","sind","war","habe"], ans:0, hint:"3. Persona singular: 'ist'."},
      {p:"Wohin-Pr√§position (Bewegung)? ‚Äì Wir gehen ___ Park.", opts:["in den","im","an dem","beim"], ans:0, hint:"Direcci√≥n ‚Üí 'in den' + Akk."},
      {p:"Perfekt mit ‚Äúhaben/sein‚Äù? ‚Äì Sie ___ gestern sp√§t angekommen.", opts:["ist","hat","war","hatte"], ans:0, hint:"'ankommen' usa 'sein'."},
      {p:"Trennbares Verb (Gegenwart): ‚Äì Ich ___ um 7 Uhr ___. (aufstehen)", opts:["stehe ‚Ä¶ auf","aufstehe","steht ‚Ä¶ auf","stand ‚Ä¶ auf"], ans:0, hint:"Presente: 'ich stehe ‚Ä¶ auf'."},
      {p:"Artikel im Akkusativ: ‚Äì Ich nehme ___ Kaffee.", opts:["einen","ein","einem","des"], ans:0, hint:"Akkusativ masculino: 'einen'."},
      {p:"Zeitangabe im Satz: ‚Äì ___ Nachmittag habe ich Training.", opts:["Am","Im","An","F√ºr"], ans:0, hint:"Expresi√≥n fija: 'Am Nachmittag'."},
      {p:"Pr√§position Ort (Lage): ‚Äì Die Jacke h√§ngt ___ der T√ºr.", opts:["an","auf","unter","√ºber"], ans:0, hint:"Colgado en superficie vertical: 'an'."},
      {p:"Korrekte Verbform: ‚Äì Wir ___ morgen einen Test.", opts:["haben","hat","seid","waren"], ans:0, hint:"1¬™ persona plural: 'wir haben'."}
    ];

    /* ========= Tabs ========= */
    const tabTrivia = byId('tab-trivia'), tabVF = byId('tab-vf'), tabElim = byId('tab-elim');
    const panelTrivia = byId('panel-trivia'), panelVF = byId('panel-vf'), panelElim = byId('panel-elim');
    function showPanel(p){
      [tabTrivia, tabVF, tabElim].forEach(t=>t.classList.remove('active'));
      [panelTrivia, panelVF, panelElim].forEach(x=>x.style.display='none');
      if (p==='trivia'){ tabTrivia.classList.add('active'); panelTrivia.style.display='block'; }
      if (p==='vf'){ tabVF.classList.add('active'); panelVF.style.display='block'; }
      if (p==='elim'){ tabElim.classList.add('active'); panelElim.style.display='block'; }
      window.scrollTo({top: (p==='trivia'?panelTrivia: p==='vf'?panelVF:panelElim).getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'});
    }
    tabTrivia.addEventListener('click', ()=>showPanel('trivia'));
    tabVF.addEventListener('click', ()=>showPanel('vf'));
    tabElim.addEventListener('click', ()=>showPanel('elim'));

    /* ========= A) TRIVIA (con tiempo) ========= */
    const triviaQ = byId('trivia-q'), triviaOpts = byId('trivia-opts');
    const triviaSubmit = byId('trivia-submit'), triviaNext = byId('trivia-next'), triviaReset = byId('trivia-reset');
    const triviaFb = byId('trivia-fb'), triviaScoreEl = byId('trivia-score'), triviaProg = byId('trivia-progress');
    const tTime = byId('trivia-time'), tBar = byId('trivia-bar');

    let tIndex=0, tScore=0, tOrder=[...TRIVIA.keys()], tTimer=null, tLeft=15;

    function startTimer(){
      clearInterval(tTimer);
      tLeft = 15;
      tTime.textContent = tLeft;
      tBar.style.width = '100%';
      tTimer = setInterval(()=>{
        tLeft--;
        tTime.textContent = tLeft;
        tBar.style.width = (tLeft/15*100)+'%';
        if (tLeft<=0){ clearInterval(tTimer); lockTrivia(); triviaFb.textContent='‚è≥ Tiempo agotado.'; triviaFb.className='bad'; }
      }, 1000);
    }
    function lockTrivia(disable=true){
      triviaOpts.querySelectorAll('input[type="radio"]').forEach(r=> r.disabled = disable);
      triviaSubmit.disabled = disable;
    }
    function renderTrivia(){
      if (tIndex===0){ tScore=0; tOrder = shuffle([...TRIVIA.keys()]); }
      triviaFb.textContent = '';
      const q = TRIVIA[tOrder[tIndex]];
      triviaProg.textContent = (tIndex+1)+' / '+TRIVIA.length;
      triviaQ.innerHTML = highlightGloss(`<strong>${tIndex+1}.</strong> ${q.q}`);
      triviaOpts.innerHTML = q.opts.map((o,i)=>(
        `<li><label><input type="radio" name="tAns" value="${i}"> ${String.fromCharCode(97+i)}) ${highlightGloss(o)}</label></li>`
      )).join('');
      attachGlossHandlers(panelTrivia);
      lockTrivia(false);
      startTimer();
      triviaScoreEl.textContent = `Puntaje: ${tScore} / ${TRIVIA.length}`;
    }
    triviaSubmit.addEventListener('click', ()=>{
      const choice = panelTrivia.querySelector('input[name="tAns"]:checked');
      if(!choice){ triviaFb.textContent='Selecciona una opci√≥n.'; triviaFb.className='bad'; return; }
      clearInterval(tTimer);
      const q = TRIVIA[tOrder[tIndex]];
      if (+choice.value===q.ans){ tScore++; triviaFb.textContent='¬°Correcto!'; triviaFb.className='ok'; }
      else { triviaFb.textContent=`Incorrecto. Respuesta: ${String.fromCharCode(97+q.ans)}) ${q.opts[q.ans]}`; triviaFb.className='bad'; }
      lockTrivia(true);
      triviaScoreEl.textContent = `Puntaje: ${tScore} / ${TRIVIA.length}`;
    });
    triviaNext.addEventListener('click', ()=>{
      clearInterval(tTimer);
      tIndex = (tIndex+1) % TRIVIA.length;
      renderTrivia();
    });
    triviaReset.addEventListener('click', ()=>{
      clearInterval(tTimer);
      tIndex=0; tScore=0; renderTrivia();
    });

    /* ========= B) VERDADERO/FALSO ========= */
    const vfStatement = byId('vf-statement'), vfSubmit = byId('vf-submit'), vfNext = byId('vf-next'), vfReset = byId('vf-reset');
    const vfFb = byId('vf-fb'), vfScoreEl = byId('vf-score'), vfProg = byId('vf-progress');
    let vIndex=0, vScore=0, vOrder=[...VF.keys()];
    function renderVF(){
      if (vIndex===0){ vScore=0; vOrder = shuffle([...VF.keys()]); }
      const it = VF[vOrder[vIndex]];
      vfProg.textContent = (vIndex+1)+' / '+VF.length;
      vfStatement.innerHTML = highlightGloss(`<strong>${vIndex+1}.</strong> ${it.t}`);
      // limpiar selecci√≥n
      panelVF.querySelectorAll('input[name="vfAns"]').forEach(r=>{ r.checked=false; r.disabled=false; });
      vfFb.textContent='';
      attachGlossHandlers(panelVF);
      vfScoreEl.textContent = `Puntaje: ${vScore} / ${VF.length}`;
    }
    vfSubmit.addEventListener('click', ()=>{
      const pick = panelVF.querySelector('input[name="vfAns"]:checked');
      if(!pick){ vfFb.textContent='Selecciona una opci√≥n.'; vfFb.className='bad'; return; }
      const it = VF[vOrder[vIndex]];
      const isTrue = (pick.value==='true');
      if (isTrue===it.key){ vfFb.textContent='¬°Correcto!'; vfFb.className='ok'; vScore++; }
      else { vfFb.textContent=`Incorrecto. Es ${it.key ? 'Wahr' : 'Falsch'}.`; vfFb.className='bad'; }
      panelVF.querySelectorAll('input[name="vfAns"]').forEach(r=> r.disabled=true);
      vfScoreEl.textContent = `Puntaje: ${vScore} / ${VF.length}`;
    });
    vfNext.addEventListener('click', ()=>{
      vIndex = (vIndex+1) % VF.length;
      renderVF();
    });
    vfReset.addEventListener('click', ()=>{ vIndex=0; vScore=0; renderVF(); });

    /* ========= C) ELIMINACI√ìN PROGRESIVA ========= */
    const elimPrompt = byId('elim-prompt'), elimOpts = byId('elim-opts'), elimHint = byId('elim-hint'), elimFb = byId('elim-fb');
    const elimReset = byId('elim-reset'), elimScoreEl = byId('elim-score'), elimProg = byId('elim-progress');
    let eIndex=0, eScore=0, eOrder=[...ELIM.keys()];
    function renderElim(){
      if (eIndex===0){ eScore=0; eOrder = shuffle([...ELIM.keys()]); }
      const it = ELIM[eOrder[eIndex]];
      elimProg.textContent = (eIndex+1)+' / '+ELIM.length;
      elimPrompt.innerHTML = highlightGloss(`<strong>${eIndex+1}.</strong> ${it.p}`);
      elimOpts.innerHTML = '';
      it.opts.forEach((o,i)=>{
        const btn = document.createElement('button');
        btn.type='button'; btn.className='elim-btn'; btn.textContent=o;
        btn.addEventListener('click', ()=>{
          if (i===it.ans){
            eScore++;
            elimFb.textContent = '¬°Correcto!'; elimFb.className='ok';
            // pasar al siguiente √≠tem autom√°ticamente
            setTimeout(()=>{ eIndex = (eIndex+1)%ELIM.length; renderElim(); }, 650);
          } else {
            btn.disabled = true;
            elimHint.textContent = it.hint;
            elimFb.textContent = 'Sigue intentando‚Ä¶'; elimFb.className='bad';
          }
          elimScoreEl.textContent = `Puntaje: ${eScore} / ${ELIM.length}`;
        });
        elimOpts.appendChild(btn);
      });
      elimHint.textContent = ''; elimFb.textContent='';
      attachGlossHandlers(panelElim);
      elimScoreEl.textContent = `Puntaje: ${eScore} / ${ELIM.length}`;
    }
    elimReset.addEventListener('click', ()=>{ eIndex=0; eScore=0; renderElim(); });

    /* ========= Utilidades ========= */
    function shuffle(arr){ return arr.map(x=>[Math.random(),x]).sort((a,b)=>a[0]-b[0]).map(p=>p[1]); }

    /* ========= Inicializaci√≥n ========= */
    // Activar glosario en el p√°rrafo introductorio
    attachGlossHandlers(document.getElementById('quiz'));

    // Render inicial de cada modo
    renderTrivia();
    renderVF();
    renderElim();
  })();
  </script>
</section>


<!-- SIMULATIONSF√úHRUNG EXAMEN (EXTENDIDO) -->
<section id="simulation" class="contenido-oculto">
  <style>
    /* ===== Estilos locales para la Simulaci√≥n ===== */
    .hint {
      background: rgba(255,255,255,.9);
      border-left: 5px solid var(--blue);
      padding: .9rem 1rem; border-radius: 10px; margin: .6rem 0 1rem;
      font-size: .95rem;
    }
    .exam-hud {
      display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; margin:.6rem 0 1rem;
    }
    .pill {
      white-space:nowrap; border:2px solid var(--blue); background:#fff; color:var(--text);
      padding:.45rem .8rem; border-radius:999px; font-weight:700; display:flex; align-items:center; gap:.45rem;
    }
    .btn-ghost { border:2px solid var(--coral); background:#fff; color:var(--text); padding:.45rem .8rem; border-radius:10px; font-weight:700; cursor:pointer; }
    .btn-ghost:active { transform:scale(.98); }

    .exam-card {
      background: rgba(255,255,255,.94); border-radius: 14px; padding: 1rem;
      box-shadow: 0 6px 18px var(--shadow); margin-bottom:1rem;
    }
    .title-row { display:flex; align-items:center; gap:.6rem; margin-bottom:.6rem; }
    .title-row i { opacity:.9; }
    .muted { opacity:.85; }
    .ok { color:#1a7f37; font-weight:700; }
    .bad { color:#b1002e; font-weight:700; }

    /* Opciones tipo radio */
    .opts { list-style:none; padding:0; margin:.5rem 0; }
    .opts li { margin:.35rem 0; }
    .opts label { display:flex; align-items:flex-start; gap:.55rem; cursor:pointer; }

    /* Gram√°tica nube de opciones */
    .cloud { display:flex; flex-wrap:wrap; gap:.5rem; margin:.5rem 0; }
    .chip {
      border:2px solid var(--grass); background:#fff; border-radius:999px; padding:.35rem .7rem; cursor:pointer; font-weight:700;
    }
    .chip.active { background:var(--grass); }
    .sentence { background:#f7fbff; border:2px dashed var(--blue); border-radius:10px; padding:.6rem .7rem; display:inline-block; }
    .blank { border-bottom:3px solid var(--coral); min-width: 6ch; display:inline-block; text-align:center; }

    /* Glosario modal (secci√≥n exclusiva) */
    .gloss { border-bottom:2px dotted var(--coral); background: rgba(212,90,86,.08); border-radius:6px; padding:0 .2rem; cursor:pointer; }
    .modal-exam { position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background: rgba(0,0,0,.45); z-index:9999; }
    .modal-exam.hidden { display:none; }
    .modal-box {
      background:#fff; border-radius:12px; padding:1rem 1.2rem; width:min(520px, calc(100% - 2rem));
      box-shadow:0 12px 28px rgba(0,0,0,.35);
    }
    .modal-box h4 { margin:0 0 .3rem; color:var(--blue); }
    .modal-close { float:right; border:none; background:transparent; font-size:1.4rem; cursor:pointer; }

    /* Resumen / historial */
    .summary { background:#fff; border-radius:12px; padding: .8rem 1rem; box-shadow:0 6px 18px var(--shadow); }
    .history { margin-top:.6rem; font-size:.95rem; }
    .history li { margin:.2rem 0; }

    @media (max-width:600px){
      .exam-card { padding:.9rem; }
      .opts li { margin:.25rem 0; }
    }
  </style>

  <h2>Simulationspr√ºfung ‚Äì Examen de pr√°ctica A2</h2>
  <p class="hint">
    üéØ Objetivo: integrar <strong>vocabulario + gram√°tica + lectura + expresiones</strong> (nivel A2).  
    ‚ñ∏ <strong>Secci√≥n 1</strong> (Wortschatz): elige la palabra que coincide con el <em>√≠cono</em>.  
    ‚ñ∏ <strong>Secci√≥n 2</strong> (Grammatik): completa la frase tocando 1 opci√≥n de la <em>nube</em>.  
    ‚ñ∏ <strong>Secci√≥n 3</strong> (Lesen): lee el mensaje y responde (3 opciones).  
    ‚ñ∏ <strong>Secci√≥n 4</strong> (Redemittel): elige la frase que encaja (3 opciones).  
    üí° Algunas <span class="gloss" data-term="palabras dif√≠ciles">palabras dif√≠ciles</span> est√°n subrayadas: t√≥cala para ver su significado en espa√±ol. Tu progreso se guarda autom√°ticamente en este dispositivo.
  </p>

  <div class="exam-hud">
    <span class="pill"><i class="fa-solid fa-list-ol"></i> √çtem <span id="ex-pos">1</span> / <span id="ex-total">20</span></span>
    <span class="pill"><i class="fa-solid fa-star"></i> Puntaje: <span id="ex-score">0</span></span>
    <button id="ex-prev" class="btn-ghost" type="button">‚üµ Anterior</button>
    <button id="ex-next" class="btn-ghost" type="button">Siguiente ‚ü∂</button>
    <button id="ex-reset" class="btn-ghost" type="button"><i class="fa-solid fa-rotate-left"></i> Reiniciar</button>
  </div>

  <!-- Contenedor din√°mico del √≠tem -->
  <div id="exam-container"></div>

  <!-- Controles globales -->
  <div class="exam-card">
    <div class="title-row"><i class="fa-solid fa-flag-checkered"></i><strong>Finalizar</strong></div>
    <p class="muted">Puedes terminar cuando quieras. Ver√°s tu nota y se guardar√° en el historial.</p>
    <button class="btn-submit" id="ex-submit" type="button">Pr√ºfung abschlie√üen</button>
    <p id="exam-result" class="ok" style="display:none;"></p>
  </div>

  <div class="summary">
    <div class="title-row"><i class="fa-solid fa-clock-rotate-left"></i><strong>Historial local</strong></div>
    <ul id="ex-history" class="history"></ul>
  </div>

  <span class="back-btn" onclick="mostrarSeccion('home')">Volver al inicio</span>

  <!-- Modal glosario -->
  <div id="gloss-modal-exam" class="modal-exam hidden" role="dialog" aria-modal="true" aria-labelledby="gloss-term-exam" aria-describedby="gloss-def-exam">
    <div class="modal-box">
      <button id="gloss-close-exam" class="modal-close" aria-label="Cerrar">√ó</button>
      <h4 id="gloss-term-exam">T√©rmino</h4>
      <p id="gloss-def-exam">Definici√≥n en espa√±ol</p>
    </div>
  </div>

  <script>
  (function(){
    const byId = id => document.getElementById(id);

    /* ========= Glosario ========= */
    const GLOSS = {
      "Versp√§tung":"retraso, demora (transporte).",
      "Einlass":"acceso/entrada al recinto.",
      "Beginn":"inicio/comienzo.",
      "Ersatzbus":"bus de reemplazo.",
      "Eintritt":"entrada (precio).",
      "Bibliothek":"biblioteca.",
      "Fahrkarte":"billete de transporte.",
      "Gleis":"and√©n/v√≠a (tren).",
      "Schalter":"ventanilla/mostrador.",
      "Formular":"formulario.",
      "Verein":"club/asociaci√≥n.",
      "Termin":"cita (m√©dica, etc.).",
      "Praxis":"consulta/cl√≠nica.",
      "Rezept":"receta m√©dica.",
      "Kasse":"caja (pago).",
      "Umkleide":"probador/vestidor.",
      "Angebot":"oferta/promoci√≥n."
    };
    function escapeRegExp(s){ return s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'); }
    function highlightGloss(text){
      const keys = Object.keys(GLOSS).sort((a,b)=>b.length-a.length);
      let out = text;
      keys.forEach(k=>{
        const rx = new RegExp(`\\b${escapeRegExp(k)}\\b`,'g');
        out = out.replace(rx, `<span class="gloss" data-term="${k}">${k}</span>`);
      });
      return out;
    }
    function attachGlossHandlers(scope){
      scope.querySelectorAll('.gloss').forEach(el=>{
        el.addEventListener('click', ()=>{
          byId('gloss-term-exam').textContent = el.dataset.term;
          byId('gloss-def-exam').textContent = GLOSS[el.dataset.term] || 'Sin definici√≥n registrada.';
          byId('gloss-modal-exam').classList.remove('hidden');
        });
      });
    }
    byId('gloss-close-exam').addEventListener('click', ()=> byId('gloss-modal-exam').classList.add('hidden'));

    /* ========= Banco de √≠tems (20) ========= */
    const ITEMS = [
      // √çtem 1
      {
        vocab: { icon:'fa-bus', q:'Was passt zum Bild?', opts:['der Zug','der Bus','das Fahrrad'], ans:1 },
        gram : { text:'Gestern ___ wir mit dem Bus nach Hause.', opts:['sind gefahren','haben gefahren','ist gefahren','gehen','f√§hrt','sind gehen','sind gefahrene','wurden fahren','hat gefahren'], ans:0 },
        read : { text:'Chat: ‚ÄûKommst du heute mit? Der Film beginnt um 18:30. Ich warte am Eingang.‚Äú', q:'Wann beginnt der Film?', opts:['18:00','18:30','18:45'], ans:1 },
        redm : { ctx:'Taquilla: A: Guten Abend! Was darf es sein? ‚Äì B: _____', opts:['Zwei Karten f√ºr ‚ÄûAbenteuer‚Äú, bitte.','Ich wohne neben der Bibliothek.','Der Aufzug ist kaputt.'], ans:0 }
      },
      // √çtem 2
      {
        vocab: { icon:'fa-bread-slice', q:'Was passt zum Bild?', opts:['das Br√∂tchen','der K√§se','die Suppe'], ans:0 },
        gram : { text:'Morgen ___ ich meinen Freund im Park.', opts:['treffe','trifft','treffen','habe getroffen','getroffen','ging','laufe','besuche','gespielt'], ans:0 },
        read : { text:'Notiz: ‚ÄûBitte Hausaufgaben bis Mittwoch abgeben. Raum 204.‚Äú', q:'Bis wann abgeben?', opts:['Dienstag','Mittwoch','Donnerstag'], ans:1 },
        redm : { ctx:'B√§ckerei: A: Guten Morgen! Was m√∂chten Sie? ‚Äì B: _____', opts:['Ich h√§tte gern zwei Br√∂tchen, bitte.','Die Haltestelle ist dort.','Ich habe Mathe.'], ans:0 }
      },
      // √çtem 3
      {
        vocab: { icon:'fa-clock', q:'Was passt zum Bild?', opts:['die Uhr','der Kalender','die Stra√üe'], ans:0 },
        gram : { text:'Wir ___ seit zwei Jahren in K√∂ln.', opts:['wohnen','wohne','wohnt','haben gewohnt','hat gewohnt','sind gewohnt','bleiben','wohnte','werden wohnen'], ans:0 },
        read : { text:'Aushang: ‚ÄûBibliothek: heute ge√∂ffnet 9‚Äì17 Uhr. R√ºckgabe am Schalter.‚Äú', q:'Wann √∂ffnet die Bibliothek?', opts:['8 Uhr','9 Uhr','10 Uhr'], ans:1 },
        redm : { ctx:'Im Restaurant: A: Sind Sie bereit zu bestellen? ‚Äì B: _____', opts:['Ja, ich nehme die Tomatensuppe.','Ich brauche Batterien.','Der Bus ist versp√§tet.'], ans:0 }
      },
      // √çtem 4
      {
        vocab: { icon:'fa-book', q:'Was passt zum Bild?', opts:['das Buch','die Schule','das Heft'], ans:0 },
        gram : { text:'Um 8 Uhr ___ der Unterricht.', opts:['beginnt','beginnen','begann','hat beginnen','f√§ngt','ist beginnt','wurde beginnen','ist begonnen','hatte beginnt'], ans:0 },
        read : { text:'SMS: ‚ÄûIch komme sp√§ter. Mein Zug hat 10 Minuten Versp√§tung.‚Äú', q:'Wie sp√§t kommt die Person?', opts:['10 Minuten sp√§ter','10 Minuten fr√ºher','p√ºnktlich'], ans:0 },
        redm : { ctx:'In der Schule: A: Hast du die Hausaufgaben dabei? ‚Äì B: _____', opts:['Ja, hier im Heft.','Ich kaufe eine Fahrkarte.','Der Film beginnt um 20 Uhr.'], ans:0 }
      },
      // √çtem 5
      {
        vocab: { icon:'fa-hospital', q:'Was passt zum Bild?', opts:['der Arzt','das Krankenhaus','die Apotheke'], ans:1 },
        gram : { text:'Gestern ___ ich krank.', opts:['war','bin','habe gewesen','ist','waren','hat','wurde sein','hatte','sei'], ans:0 },
        read : { text:'Termin: ‚ÄûPraxis Dr. Klein, Mittwoch 10:20 Uhr. Bitte 10 Minuten fr√ºher kommen.‚Äú', q:'Wann soll man kommen?', opts:['10:30','10:10','10:20'], ans:1 },
        redm : { ctx:'In der Apotheke: A: Was brauchen Sie? ‚Äì B: _____', opts:['Ich brauche Nasentropfen gegen Schnupfen.','Der Zug f√§hrt um 9.','Ich wohne in K√∂ln.'], ans:0 }
      },
      // √çtem 6
      {
        vocab: { icon:'fa-ticket', q:'Was passt zum Bild?', opts:['die Fahrkarte','der Brief','die Quittung'], ans:0 },
        gram : { text:'Wir ___ am Sonntag die Gro√üeltern.', opts:['besuchen','besucht','besuche','habe besucht','besucht haben','gesehen','fahren','treffen wir','besuchtet'], ans:0 },
        read : { text:'Notiz: ‚ÄûTreffen 9:00 am Bahnhof. Regenjacke mitbringen.‚Äú', q:'Wo ist das Treffen?', opts:['in der Schule','am Bahnhof','im Bus'], ans:1 },
        redm : { ctx:'Am Schalter: A: Wohin m√∂chten Sie fahren? ‚Äì B: _____', opts:['Nach Bremen, bitte einfach.','Ich nehme Suppe.','Das Hemd ist zu klein.'], ans:0 }
      },
      // √çtem 7
      {
        vocab: { icon:'fa-school', q:'Was passt zum Bild?', opts:['die Schule','der Park','das Theater'], ans:0 },
        gram : { text:'Wir ___ heute keinen Unterricht.', opts:['haben','hat','sind','hatten','war','bekommen','sein','gibt','gab'], ans:0 },
        read : { text:'Aushang: ‚ÄûSport heute in der Halle, nicht auf dem Platz.‚Äú', q:'Wo ist Sport heute?', opts:['auf dem Platz','in der Halle','im Park'], ans:1 },
        redm : { ctx:'Bus-Haltestelle: A: F√§hrt dieser Bus zum Bahnhof? ‚Äì B: _____', opts:['Ja, Linie 8 f√§hrt direkt.','Ich h√§tte gern eine Suppe.','Der Aufzug ist kaputt.'], ans:0 }
      },
      // √çtem 8
      {
        vocab: { icon:'fa-cheese', q:'Was passt zum Bild?', opts:['die Pizza','der K√§se','der Fisch'], ans:1 },
        gram : { text:'Ich ___ heute keine Zeit.', opts:['habe','hast','hat','bin','sein','hatte','gehabt','habe gehabt','war'], ans:0 },
        read : { text:'Angebot: ‚Äû√Ñpfel 1,99 ‚Ç¨/kg. Heute ge√∂ffnet bis 21 Uhr.‚Äú', q:'Bis wann ge√∂ffnet?', opts:['20 Uhr','21 Uhr','22 Uhr'], ans:1 },
        redm : { ctx:'Im Supermarkt: A: Entschuldigung, was kostet dieses Brot? ‚Äì B: _____', opts:['2,49 Euro, im Angebot.','Ich wohne im zweiten Stock.','Der Zug ist p√ºnktlich.'], ans:0 }
      },
      // √çtem 9
      {
        vocab: { icon:'fa-bicycle', q:'Was passt zum Bild?', opts:['das Fahrrad','das Taxi','der Bus'], ans:0 },
        gram : { text:'Er ___ mit dem Fahrrad zur Arbeit.', opts:['f√§hrt','fahre','fahren','ist gefahren','hat gefahren','l√§uft','ging','geht gefahren','gefahren ist'], ans:0 },
        read : { text:'Nachricht: ‚ÄûIch bin um 18:15 vor dem Kino. Kaufst du die Tickets?‚Äú', q:'Wann kommt die Person an?', opts:['18:15','18:30','18:00'], ans:0 },
        redm : { ctx:'Im Caf√©: A: M√∂chten Sie etwas trinken? ‚Äì B: _____', opts:['Ja, ein stilles Wasser, bitte.','Der Bus f√§hrt um 9.','Ich brauche Pflaster.'], ans:0 }
      },
      // √çtem 10
      {
        vocab: { icon:'fa-house', q:'Was passt zum Bild?', opts:['das Haus','der Stuhl','der Garten'], ans:0 },
        gram : { text:'Die Kinder ___ im Park.', opts:['spielen','spielt','spielte','hat spielen','sind gespielt','laufen','sitzt','sind spielen','spieltet'], ans:0 },
        read : { text:'Zettel: ‚ÄûBitte M√ºll am Dienstagabend rausstellen.‚Äú', q:'Wann soll man den M√ºll rausstellen?', opts:['Montagabend','Dienstagabend','Mittwochmorgen'], ans:1 },
        redm : { ctx:'Auf der Stra√üe: A: Entschuldigung, wo ist die Haltestelle? ‚Äì B: _____', opts:['Geradeaus und dann rechts.','Ich esse Pizza.','Der Aufzug ist defekt.'], ans:0 }
      },
      // √çtem 11
      {
        vocab: { icon:'fa-suitcase', q:'Was passt zum Bild?', opts:['der Brief','der Rucksack','der Kofferraum'], ans:1 },
        gram : { text:'Wir ___ um 7 Uhr in der Schule.', opts:['sind','ist','seid','haben','hatten','war','sein','wurden','w√§re'], ans:0 },
        read : { text:'E-Mail: ‚ÄûB√ºchertausch am Freitag in der Schulbibliothek. Bringt ein gelesenes Buch mit.‚Äú', q:'Was soll man mitbringen?', opts:['Ein Heft','Ein gelesenes Buch','Eine Fahrkarte'], ans:1 },
        redm : { ctx:'In der Postfiliale: A: Wohin geht das Paket? ‚Äì B: _____', opts:['Nach M√ºnchen, bitte versichert.','Ich nehme die Suppe.','Die Umkleide ist links.'], ans:0 }
      },
      // √çtem 12
      {
        vocab: { icon:'fa-film', q:'Was passt zum Bild?', opts:['der Film','das Theater','die Kirche'], ans:0 },
        gram : { text:'Ich ___ nach der Schule Musik.', opts:['h√∂re','h√∂rt','h√∂ren','habe h√∂ren','h√∂rte','bin geh√∂rt','spiele','lese','schreibe'], ans:0 },
        read : { text:'Hinweis Kino: ‚ÄûEinlass ab 18:15. Beginn 18:45. Tickets nur online.‚Äú', q:'Wann beginnt der Film?', opts:['18:45','18:15','19:00'], ans:0 },
        redm : { ctx:'Im Kino: A: F√ºr welchen Film m√∂chten Sie Tickets? ‚Äì B: _____', opts:['F√ºr ‚ÄûSternennacht‚Äú, zwei Karten, bitte.','Ich wohne in K√∂ln.','Der Aufzug ist au√üer Betrieb.'], ans:0 }
      },
      // √çtem 13
      {
        vocab: { icon:'fa-tablets', q:'Was passt zum Bild?', opts:['die Tablette','der Verband','die Spritze'], ans:0 },
        gram : { text:'Bitte ___ Sie die Versicherungskarte mit.', opts:['bringen','bringt','bringen Sie','nimmst','nehmen','hat gebracht','brachten','mitbringen','mitgebracht'], ans:0 },
        read : { text:'Praxis: ‚ÄûNur bis 12 Uhr ge√∂ffnet. Rezepte ab 10 Uhr.‚Äú', q:'Wann gibt es Rezepte?', opts:['ab 12 Uhr','ab 10 Uhr','ganzt√§gig'], ans:1 },
        redm : { ctx:'Anmeldung: A: Haben Sie einen Termin? ‚Äì B: _____', opts:['Ja, um 11 Uhr bei Frau M√ºller.','Ich suche die Umkleide.','Zwei Br√∂tchen, bitte.'], ans:0 }
      },
      // √çtem 14
      {
        vocab: { icon:'fa-person-swimming', q:'Was passt zum Bild?', opts:['das Schwimmbad','der Spielplatz','das Museum'], ans:0 },
        gram : { text:'Im Sommer ___ wir oft im See.', opts:['baden','badet','baden wir','schwimme','schwimmen','hat gebadet','sind gebadet','badeten','gebadet'], ans:0 },
        read : { text:'Aushang: ‚ÄûFamilientag am Sonntag. Kinder zahlen keinen Eintritt.‚Äú', q:'Wer zahlt keinen Eintritt?', opts:['Erwachsene','Kinder','Alle'], ans:1 },
        redm : { ctx:'Im Verein: A: M√∂chten Sie dem Verein beitreten? ‚Äì B: _____', opts:['Ja, wo kann ich das Formular ausf√ºllen?','Ich nehme Kaffee.','Der Zug f√§hrt um 9.'], ans:0 }
      },
      // √çtem 15
      {
        vocab: { icon:'fa-envelope', q:'Was passt zum Bild?', opts:['der Brief','das Paket','der Ausweis'], ans:0 },
        gram : { text:'Ich ___ gestern eine E-Mail geschrieben.', opts:['habe','bin','hat','hatte','war','habe geschrieben','schreibt','schreibte','schreibe'], ans:0 },
        read : { text:'Post: ‚ÄûDie Linie 5 f√§hrt heute nicht. Nutzen Sie Linie 3 oder den Ersatzbus.‚Äú', q:'Welche Linie f√§hrt nicht?', opts:['3','5','7'], ans:1 },
        redm : { ctx:'Am Schalter: A: Brauchen Sie Briefmarken? ‚Äì B: _____', opts:['Ja, zehn St√ºck, bitte.','Ich mag Salat.','Die Bahn hat Versp√§tung.'], ans:0 }
      },
      // √çtem 16
      {
        vocab: { icon:'fa-shirt', q:'Was passt zum Bild?', opts:['das T-Shirt','der Schuh','die Jacke'], ans:0 },
        gram : { text:'Kann ich diese Jacke ___?', opts:['anprobieren','probiere an','anproben','tragen','nehmen','kaufen','anziehen','angezogen','anprobiert'], ans:0 },
        read : { text:'Laden: ‚ÄûKasse 2 geschlossen. Bitte zu Kasse 3.‚Äú', q:'Welche Kasse ist offen?', opts:['Kasse 1','Kasse 3','Kasse 2'], ans:1 },
        redm : { ctx:'Im Gesch√§ft: A: Kann ich die Jacke anprobieren? ‚Äì B: _____', opts:['Ja, die Umkleide ist dort links.','Ich nehme Suppe.','Der Film beginnt.'], ans:0 }
      },
      // √çtem 17
      {
        vocab: { icon:'fa-receipt', q:'Was passt zum Bild?', opts:['die Quittung','die Fahrkarte','die Einladung'], ans:0 },
        gram : { text:'Wie viel ___ das Ticket?', opts:['kostet','kosten','gekostet','kostet es','hat gekostet','kostetet','kostet man','zahlt','bezahlt'], ans:0 },
        read : { text:'Zettel: ‚ÄûHausaufgabe bis Sonntag 20 Uhr in die Plattform hochladen.‚Äú', q:'Wann ist die Abgabe?', opts:['Samstag 20 Uhr','Sonntag 20 Uhr','Montag 8 Uhr'], ans:1 },
        redm : { ctx:'Im Restaurant: A: Hat es Ihnen geschmeckt? ‚Äì B: _____', opts:['Ja, sehr. K√∂nnten wir bitte die Rechnung bekommen?','Ich wohne in K√∂ln.','Der Bus h√§lt da vorne.'], ans:0 }
      },
      // √çtem 18
      {
        vocab: { icon:'fa-user-doctor', q:'Was passt zum Bild?', opts:['der Arzt','die Lehrerin','der Fahrer'], ans:0 },
        gram : { text:'Er ___ heute nicht zur Schule, er ist krank.', opts:['geht','gehe','gegangen','ist gegangen','f√§hrt','bleibt','blieb','geht nicht','ging'], ans:0 },
        read : { text:'Wetter: ‚ÄûVormittags sonnig, nachmittags Regen. Bitte Regenjacke.‚Äú', q:'Wie ist das Wetter am Vormittag?', opts:['Sonnig','Regen','Schnee'], ans:0 },
        redm : { ctx:'Auf der Stra√üe: A: Entschuldigung, wo ist die Bibliothek? ‚Äì B: _____', opts:['Geradeaus und an der Ecke rechts.','Der Aufzug ist kaputt.','Ich brauche Tabletten.'], ans:0 }
      },
      // √çtem 19
      {
        vocab: { icon:'fa-suitcase', q:'Was passt zum Bild?', opts:['der Koffer','die Tasche','der Stuhl'], ans:0 },
        gram : { text:'Wir ___ morgen nach Berlin.', opts:['fahren','fahre','fahrt','sind gefahren','hat gefahren','gehen','laufe','fliege','fuhr'], ans:0 },
        read : { text:'Einladung: ‚ÄûIch feiere am Samstag um 16 Uhr bei mir zu Hause. Bitte etwas zu trinken mitbringen.‚Äú', q:'Wann beginnt die Feier?', opts:['15 Uhr','16 Uhr','17 Uhr'], ans:1 },
        redm : { ctx:'Einladung: A: Hast du am Samstag Zeit? ‚Äì B: _____', opts:['Ja, gern! Um wie viel Uhr soll ich kommen?','Ich kaufe Brot.','Der Bus f√§hrt nicht.'], ans:0 }
      },
      // √çtem 20
      {
        vocab: { icon:'fa-basket-shopping', q:'Was passt zum Bild?', opts:['der Supermarkt','die Metzgerei','das Theater'], ans:0 },
        gram : { text:'Entschuldigung, ich ___ eine Frage.', opts:['habe','hat','bin','habe gehabt','bekomme','frage','habe Frage','war','h√§tte'], ans:0 },
        read : { text:'Aushang Schule: ‚ÄûDer Unterricht findet heute in Raum 105 statt, nicht in Raum 101.‚Äú', q:'Wo ist der Unterricht heute?', opts:['Raum 105','Raum 101','f√§llt aus'], ans:0 },
        redm : { ctx:'Im Caf√©: A: M√∂chten Sie noch etwas? ‚Äì B: _____', opts:['Ja, ein St√ºck Apfelkuchen, bitte.','Ich wohne im zweiten Stock.','Der Bus kommt um 8.'], ans:0 }
      }
    ];

    /* ========= Estado / almacenamiento ========= */
    const TOTAL = ITEMS.length;
    let idx = 0;
    let score = 0;
    // Respuestas del usuario
    const state = ITEMS.map(()=>({v:null, g:null, r:null, d:null, checked:false}));

    // LocalStorage
    const LS_KEY = 'a2_sim_exam_state_v1';
    const LS_HISTORY = 'a2_sim_exam_history_v1';
    function saveState(){
      localStorage.setItem(LS_KEY, JSON.stringify({idx, score, state}));
    }
    function loadState(){
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return false;
      try{
        const obj = JSON.parse(raw);
        if(!obj || !Array.isArray(obj.state) || obj.state.length!==TOTAL) return false;
        idx = Math.max(0, Math.min(TOTAL-1, obj.idx||0));
        score = obj.score||0;
        obj.state.forEach((s,i)=> state[i] = s);
        return true;
      } catch{ return false; }
    }
    function pushHistory(finalScore){
      const raw = localStorage.getItem(LS_HISTORY);
      const list = raw ? JSON.parse(raw) : [];
      list.unshift({ when: new Date().toISOString(), score: finalScore, total: TOTAL*4 });
      localStorage.setItem(LS_HISTORY, JSON.stringify(list.slice(0,20)));
      renderHistory();
    }
    function renderHistory(){
      const ul = byId('ex-history');
      const raw = localStorage.getItem(LS_HISTORY);
      const list = raw ? JSON.parse(raw) : [];
      if(list.length===0){ ul.innerHTML = '<li class="muted">Sin intentos almacenados.</li>'; return; }
      ul.innerHTML = list.map(h=>{
        const d = new Date(h.when);
        const date = d.toLocaleString();
        return `<li><i class="fa-solid fa-check"></i> ${date}: <strong>${h.score}</strong> / ${h.total} puntos</li>`;
      }).join('');
    }

    /* ========= Render de un √≠tem ========= */
    const container = byId('exam-container');
    function render(){
      byId('ex-total').textContent = TOTAL;
      byId('ex-pos').textContent = idx+1;
      byId('ex-score').textContent = score;

      const it = ITEMS[idx];
      const st = state[idx];

      const nameV = `v_${idx}`, nameR = `r_${idx}`, nameD = `d_${idx}`;

      const vocabHTML = `
        <div class="exam-card">
          <div class="title-row"><i class="fa-solid fa-language"></i><strong>1) Wortschatz</strong></div>
          <p class="muted">${highlightGloss(it.vocab.q)}</p>
          <p style="font-size:2rem;"><i class="fa-solid ${it.vocab.icon}"></i></p>
          <ul class="opts">
            ${it.vocab.opts.map((o,i)=>`
              <li><label><input type="radio" name="${nameV}" value="${i}" ${st.v==i?'checked':''}> ${String.fromCharCode(97+i)}) ${highlightGloss(o)}</label></li>
            `).join('')}
          </ul>
          <p id="fb-v" class="muted"></p>
        </div>
      `;

      const gramHTML = `
        <div class="exam-card">
          <div class="title-row"><i class="fa-solid fa-pen-nib"></i><strong>2) Grammatik</strong></div>
          <p class="muted">Toca una opci√≥n de la nube para completar la frase.</p>
          <p class="sentence">${highlightGloss(it.gram.text.replace('___', `<span id="gblank" class="blank">${st.g!=null ? it.gram.opts[st.g] : '&nbsp;'}</span>`))}</p>
          <div class="cloud">
            ${it.gram.opts.map((o,i)=>`
              <button type="button" class="chip ${st.g==i?'active':''}" data-g="${i}">${highlightGloss(o)}</button>
            `).join('')}
            <button type="button" class="btn-ghost" id="g-clear"><i class="fa-solid fa-eraser"></i> Borrar</button>
          </div>
          <p id="fb-g" class="muted"></p>
        </div>
      `;

      const readHTML = `
        <div class="exam-card">
          <div class="title-row"><i class="fa-solid fa-book-open"></i><strong>3) Lesen</strong></div>
          <p>${highlightGloss(it.read.text)}</p>
          <p class="muted" style="margin-top:.4rem;">${highlightGloss(it.read.q)}</p>
          <ul class="opts">
            ${it.read.opts.map((o,i)=>`
              <li><label><input type="radio" name="${nameR}" value="${i}" ${st.r==i?'checked':''}> ${String.fromCharCode(97+i)}) ${highlightGloss(o)}</label></li>
            `).join('')}
          </ul>
          <p id="fb-r" class="muted"></p>
        </div>
      `;

      const redmHTML = `
        <div class="exam-card">
          <div class="title-row"><i class="fa-solid fa-comments"></i><strong>4) Redemittel</strong></div>
          <p>${highlightGloss(it.redm.ctx)}</p>
          <ul class="opts">
            ${it.redm.opts.map((o,i)=>`
              <li><label><input type="radio" name="${nameD}" value="${i}" ${st.d==i?'checked':''}> ${String.fromCharCode(97+i)}) ${highlightGloss(o)}</label></li>
            `).join('')}
          </ul>
          <p id="fb-d" class="muted"></p>
        </div>
      `;

      container.innerHTML = vocabHTML + gramHTML + readHTML + redmHTML + `
        <div class="exam-card">
          <div class="title-row"><i class="fa-solid fa-circle-check"></i><strong>Comprobar este √≠tem</strong></div>
          <p class="muted">Puedes verificar tus respuestas del √≠tem actual. Sumar√° a tu puntaje.</p>
          <button type="button" class="btn-submit" id="check-item">Comprobar √≠tem</button>
          <p id="fb-item" class="muted"></p>
        </div>
      `;

      // Handlers de selecci√≥n
      // Vocabulario
      container.querySelectorAll(`input[name="${nameV}"]`).forEach(r=>{
        r.addEventListener('change', ()=> { state[idx].v = +r.value; saveState(); });
      });
      // Gram√°tica
      container.querySelectorAll('.chip').forEach(ch=>{
        ch.addEventListener('click', ()=>{
          container.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
          ch.classList.add('active');
          const gi = +ch.dataset.g;
          state[idx].g = gi;
          const blank = byId('gblank');
          blank.innerHTML = ch.textContent;
          saveState();
        });
      });
      const gClear = byId('g-clear');
      gClear.addEventListener('click', ()=>{
        state[idx].g = null;
        container.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        byId('gblank').innerHTML = '&nbsp;';
        saveState();
      });

      // Lectura
      container.querySelectorAll(`input[name="${nameR}"]`).forEach(r=>{
        r.addEventListener('change', ()=> { state[idx].r = +r.value; saveState(); });
      });
      // Redemittel
      container.querySelectorAll(`input[name="${nameD}"]`).forEach(r=>{
        r.addEventListener('change', ()=> { state[idx].d = +r.value; saveState(); });
      });

      // Comprobar √≠tem
      byId('check-item').addEventListener('click', ()=>{
        const it = ITEMS[idx], st = state[idx];
        let gained = 0;

        const fbv = byId('fb-v'), fbg = byId('fb-g'), fbr = byId('fb-r'), fbd = byId('fb-d');
        // Vocabulario
        if(st.v==null){ fbv.textContent='(Wortschatz) Selecciona una opci√≥n.'; fbv.className='bad'; }
        else if(st.v===it.vocab.ans){ fbv.textContent='(Wortschatz) ¬°Correcto!'; fbv.className='ok'; gained++; }
        else { fbv.textContent=`(Wortschatz) Incorrecto. Respuesta: ${it.vocab.opts[it.vocab.ans]}`; fbv.className='bad'; }

        // Gram√°tica
        if(st.g==null){ fbg.textContent='(Grammatik) Elige una opci√≥n.'; fbg.className='bad'; }
        else if(st.g===it.gram.ans){ fbg.textContent='(Grammatik) ¬°Correcto!'; fbg.className='ok'; gained++; }
        else { fbg.textContent=`(Grammatik) Incorrecto. Respuesta: ${it.gram.opts[it.gram.ans]}`; fbg.className='bad'; }

        // Lectura
        if(st.r==null){ fbr.textContent='(Lesen) Selecciona una opci√≥n.'; fbr.className='bad'; }
        else if(st.r===it.read.ans){ fbr.textContent='(Lesen) ¬°Correcto!'; fbr.className='ok'; gained++; }
        else { fbr.textContent=`(Lesen) Incorrecto. Respuesta: ${it.read.opts[it.read.ans]}`; fbr.className='bad'; }

        // Redemittel
        if(st.d==null){ fbd.textContent='(Redemittel) Selecciona una opci√≥n.'; fbd.className='bad'; }
        else if(st.d===it.redm.ans){ fbd.textContent='(Redemittel) ¬°Correcto!'; fbd.className='ok'; gained++; }
        else { fbd.textContent=`(Redemittel) Incorrecto. Respuesta: ${it.redm.opts[it.redm.ans]}`; fbd.className='bad'; }

        // actualizar puntaje solo la primera vez que se corrige este √≠tem
        const fbitem = byId('fb-item');
        if(!st.checked){
          score += gained;
          st.checked = true;
          fbitem.textContent = `Puntos obtenidos en este √≠tem: ${gained} / 4.`;
          fbitem.className = gained>=3 ? 'ok' : 'muted';
        } else {
          fbitem.textContent = 'Este √≠tem ya fue calificado. (Puedes revisar las respuestas, pero el puntaje no cambia.)';
          fbitem.className = 'muted';
        }
        byId('ex-score').textContent = score;
        saveState();
      });

      // Activar glosario
      attachGlossHandlers(container);
    }

    /* ========= Navegaci√≥n ========= */
    byId('ex-prev').addEventListener('click', ()=>{ idx = (idx-1+TOTAL)%TOTAL; saveState(); render(); window.scrollTo({top: container.offsetTop-80, behavior:'smooth'}); });
    byId('ex-next').addEventListener('click', ()=>{ idx = (idx+1)%TOTAL; saveState(); render(); window.scrollTo({top: container.offsetTop-80, behavior:'smooth'}); });
    byId('ex-reset').addEventListener('click', ()=>{
      if(!confirm('¬øReiniciar examen? Se borrar√° el progreso guardado.')) return;
      for(let i=0;i<TOTAL;i++) state[i]={v:null,g:null,r:null,d:null,checked:false};
      idx = 0; score = 0; saveState(); render();
    });

    /* ========= Finalizar ========= */
    byId('ex-submit').addEventListener('click', ()=>{
      const max = TOTAL*4;
      const msg = `¬°Examen terminado! Puntaje: ${score} / ${max}`;
      const res = byId('exam-result');
      res.textContent = msg;
      res.style.display = 'block';
      pushHistory(score);
      saveState(); // deja √∫ltima foto del estado
      window.scrollTo({top: res.getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'});
    });

    /* ========= Init ========= */
    // aplicar glosario a la cabecera
    attachGlossHandlers(document.getElementById('simulation'));

    // Cargar estado si existe
    loadState();
    renderHistory();
    render();
  })();
  </script>
</section>


  <script>
    function mostrarSeccion(id) {
      document.querySelectorAll("section").forEach(sec => sec.style.display = "none");
      document.getElementById(id).style.display = "block";
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // Drag and Drop f√ºr Grammatik
    const items = document.querySelectorAll('.dnd-item');
    items.forEach(item => {
      item.addEventListener('dragstart', dragStart);
    });
    const zones = document.querySelectorAll('.dnd-zone');
    zones.forEach(zone => {
      zone.addEventListener('dragover', allowDrop);
      zone.addEventListener('drop', drop);
    });
    function dragStart(event) {
      event.dataTransfer.setData("text", event.target.innerText);
    }
    function allowDrop(event) {
      event.preventDefault();
    }
    function drop(event) {
      event.preventDefault();
      const word = event.dataTransfer.getData("text");
      if (event.target.classList.contains('dnd-zone') && event.target.childElementCount === 0) {
        const item = document.createElement('div');
        item.className = 'dnd-item';
        item.innerText = word;
        event.target.appendChild(item);
        // Remove word from source
        items.forEach(i => {
          if (i.innerText === word) i.style.visibility = 'hidden';
        });
      }
    }
    function checkSentence() {
      const words = [];
      zones.forEach(zone => {
        if (zone.firstChild) words.push(zone.firstChild.textContent);
      });
      const resultElem = document.getElementById('dnd-result');
      if (words.join(' ') === 'ich spiele Fu√üball') {
        resultElem.textContent = 'Richtig! Gut gemacht!';
        resultElem.style.color = 'green';
      } else {
        resultElem.textContent = 'Falsch. Versuche es noch einmal!';
        resultElem.style.color = 'red';
      }
    }

    function checkMC(name, correctValue, resultId) {
      const options = document.getElementsByName(name);
      let selected;
      options.forEach(opt => { if (opt.checked) selected = opt.value; });
      const resultElem = document.getElementById(resultId);
      if (!selected) {
        resultElem.textContent = 'Bitte w√§hle eine Antwort.';
        resultElem.style.color = 'orange';
      } else if (selected === correctValue) {
        resultElem.textContent = 'Richtig!';
        resultElem.style.color = 'green';
      } else {
        resultElem.textContent = 'Falsch.';
        resultElem.style.color = 'red';
      }
    }
    function checkFill(inputId, answer, resultId) {
      const val = document.getElementById(inputId).value.trim().toLowerCase();
      const resultElem = document.getElementById(resultId);
      if (!val) {
        resultElem.textContent = 'Bitte einen Wert eingeben.';
        resultElem.style.color = 'orange';
      } else if (val === answer) {
        resultElem.textContent = 'Richtig!';
        resultElem.style.color = 'green';
      } else {
        resultElem.textContent = 'Falsch.';
        resultElem.style.color = 'red';
      }
    }
    function checkTrueFalse(name, correctBool, resultId) {
      const options = document.getElementsByName(name);
      let selected;
      options.forEach(opt => { if (opt.checked) selected = opt.value; });
      const resultElem = document.getElementById(resultId);
      if (!selected) {
        resultElem.textContent = 'Bitte w√§hle aus.';
        resultElem.style.color = 'orange';
      } else if ((selected === 'true') === correctBool) {
        resultElem.textContent = 'Wahr!';
        resultElem.style.color = 'green';
      } else {
        resultElem.textContent = 'Falsch.';
        resultElem.style.color = 'red';
      }
    }

    function checkQuizAnswers() {
      let score = 0;
      const q1 = document.querySelector('input[name="quizQ1"]:checked');
      const q2 = document.querySelector('input[name="quizQ2"]:checked');
      const q3 = document.querySelector('input[name="quizQ3"]:checked');
      if(q1 && q1.value === 'b') score++;
      if(q2 && q2.value === 'b') score++;
      if(q3 && q3.value === 'false') score++;
      const resultElem = document.getElementById('quiz-result');
      resultElem.textContent = 'Du hast ' + score + ' von 3 Punkten erreicht.';
    }

    // Simulationspr√ºfung
    function submitExam() {
      let total = 0, correct = 0;
      const exam1 = document.querySelector('input[name="exam1"]:checked');
      if (exam1 && exam1.value === 'richtig') correct++;
      total++;
      const exam2 = document.getElementById('exam2').value.trim().toLowerCase();
      if (exam2 === 'geht') correct++;
      total++;
      const exam3 = document.getElementById('exam3').value.trim();
      if (exam3 === '18 Uhr' || exam3 === '18 Uhr.') correct++;
      total++;
      const exam4 = document.getElementById('exam4').value.toLowerCase();
      if (exam4.includes('wie sp√§t')) correct++;
      total++;
      const resultElem = document.getElementById('exam-result');
      resultElem.textContent = 'Dein Ergebnis: ' + correct + ' von ' + total + ' richtig.';
      const history = JSON.parse(localStorage.getItem('examhistory') || '[]');
      history.push({score: correct + '/' + total, date: new Date().toLocaleString()});
      localStorage.setItem('examhistory', JSON.stringify(history));
    }

    // Initial load
    mostrarSeccion('home');
  </script>
</body>
</html>







